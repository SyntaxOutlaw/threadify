(()=>{var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";function t(e,o){return t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},t(e,o)}const o=flarum.core.compat["admin/app"];var r=e.n(o);const a=flarum.core.compat["common/components/Modal"];var n=e.n(a);const i=flarum.core.compat["common/components/Button"];var l=e.n(i);console.log("[Threadify] Admin panel JS loaded");var s=function(e){function o(){return e.apply(this,arguments)||this}var a,n;n=e,(a=o).prototype=Object.create(n.prototype),a.prototype.constructor=a,t(a,n);var i=o.prototype;return i.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1,this.result=null,this.error=null},i.className=function(){return"RebuildConfirmModal Modal--small"},i.title=function(){return this.result?"Rebuild Complete":this.error?"Rebuild Failed":"Rebuild Threadify Database Tables"},i.content=function(){var e=this;if(this.result){var t=this.result.results||{};return[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--success-color, #4caf50)"}},[m("strong","✅ Rebuild completed successfully!")]),m("div",{style:{fontSize:"0.9em",color:"var(--muted-color, #999)",marginBottom:"1rem"}},[m("p",{style:{margin:"0.25rem 0"}},"Threads processed: "+(t.threads_processed||0)),m("p",{style:{margin:"0.25rem 0"}},"Threads cleared: "+(t.threads_cleared||0)),m("p",{style:{margin:"0.25rem 0"}},"Errors: "+(t.threads_errors||0)),void 0!==t.parent_id_updated&&m("p",{style:{margin:"0.25rem 0"}},"Parent IDs updated: "+(t.parent_id_updated||0))])])]),m("div",{className:"Modal-footer"},[l().component({className:"Button Button--primary",onclick:function(){return e.hide()}},"Close")])]}return this.error?[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--alert-color, #f44336)"}},[m("strong","❌ Rebuild failed:")]),m("p",{style:{color:"var(--text-color, #333)"}},this.error)])]),m("div",{className:"Modal-footer"},[l().component({className:"Button Button--primary",onclick:function(){e.error=null,e.loading=!1,m.redraw()}},"Try Again"),l().component({className:"Button",onclick:function(){return e.hide()}},"Close")])]:[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem"}},[m("strong","⚠️ DANGER: "),"This action will rebuild the parent_id and threadify_threads tables from scratch."]),m("p",{style:{marginBottom:"1rem",color:"var(--muted-color, #999)"}},["This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions."]),m("p",{style:{marginBottom:"0",fontWeight:"bold"}},["Are you sure you want to continue?"])])]),m("div",{className:"Modal-footer"},[l().component({className:"Button Button--primary",loading:this.loading,onclick:function(){e.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/threadify/admin/rebuild-parent-ids"}).then(function(t){console.log("Rebuild complete:",t.results),e.result=t,e.loading=!1,m.redraw()}).catch(function(t){e.error=t.message||t,e.loading=!1,m.redraw()})}},"Yes, Rebuild Now"),l().component({className:"Button",onclick:function(){return e.hide()}},"Cancel")])]},o}(n());r().initializers.add("syntaxoutlaw-threadify-admin",function(){r().extensionData.for("syntaxoutlaw-threadify").registerSetting({setting:"syntaxoutlaw-threadify.mode",type:"select",label:"Threadify mode",options:{default:"Thread all discussions",tag:'Thread discussions with secondary tag"'},default:"default"}).registerSetting(function(){return m("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border-color, #ddd)",marginBottom:"2rem",paddingBottom:"1.5rem",borderBottom:"1px solid var(--border-color, #ddd)"}},[m("button",{className:"Button Button--danger",onclick:function(){r().modal.show(s)},disabled:this.loading},this.loading?"Rebuilding...":"Rebuild Threadify Database Tables")])})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map
(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";function e(t,a){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,a)}const a=flarum.core.compat["admin/app"];var o=t.n(a);const r=flarum.core.compat["common/components/Modal"];var s=t.n(r);const n=flarum.core.compat["common/components/Button"];var i=t.n(n);console.log("[Threadify] Admin panel JS loaded");var l=function(t){function a(){return t.apply(this,arguments)||this}var r,s;s=t,(r=a).prototype=Object.create(s.prototype),r.prototype.constructor=r,e(r,s);var n=a.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!1,this.result=null,this.error=null},n.className=function(){return"RebuildConfirmModal Modal--small"},n.title=function(){return this.result?"Rebuild Complete":this.error?"Rebuild Failed":"Rebuild Threadify Database Tables"},n.content=function(){var t=this;if(this.result){var e=this.result.results||{};return[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--success-color, #4caf50)"}},[m("strong","✅ Rebuild completed successfully!")]),m("div",{style:{fontSize:"0.9em",color:"var(--muted-color, #999)",marginBottom:"1rem"}},[m("p",{style:{margin:"0.25rem 0"}},"Threads processed: "+(e.threads_processed||0)),m("p",{style:{margin:"0.25rem 0"}},"Threads cleared: "+(e.threads_cleared||0)),m("p",{style:{margin:"0.25rem 0"}},"Errors: "+(e.threads_errors||0)),void 0!==e.parent_id_updated&&m("p",{style:{margin:"0.25rem 0"}},"Parent IDs updated: "+(e.parent_id_updated||0))])])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",onclick:function(){return t.hide()}},"Close")])]}return this.error?[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--alert-color, #f44336)"}},[m("strong","❌ Rebuild failed:")]),m("p",{style:{color:"var(--text-color, #333)"}},this.error)])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",onclick:function(){t.error=null,t.loading=!1,m.redraw()}},"Try Again"),i().component({className:"Button",onclick:function(){return t.hide()}},"Close")])]:[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem"}},[m("strong","⚠️ DANGER: "),"This action will rebuild the parent_id and threadify_threads tables from scratch."]),m("p",{style:{marginBottom:"1rem",color:"var(--muted-color, #999)"}},["This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions."]),m("p",{style:{marginBottom:"0",fontWeight:"bold"}},["Are you sure you want to continue?"])])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",loading:this.loading,onclick:function(){t.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/threadify/admin/rebuild-parent-ids"}).then(function(e){console.log("Rebuild complete:",e.results),t.result=e,t.loading=!1,m.redraw()}).catch(function(e){t.error=e.message||e,t.loading=!1,m.redraw()})}},"Yes, Rebuild Now"),i().component({className:"Button",onclick:function(){return t.hide()}},"Cancel")])]},a}(s());o().initializers.add("syntaxoutlaw-threadify-admin",function(){var t=function(){return o().forum.attribute("apiUrl")},e={oninit:function(e){var a=this;this.tags=[],this.currentValue="",this.loading=!0,this.savedMessage=!1,this.tagsExtensionEnabled=!1,o().request({method:"GET",url:t()+"/threadify/admin/settings"}).then(function(e){var r=e&&(void 0!==e.threadifyTag?e:e.data||{});return a.currentValue=r&&r.threadifyTag||"",a.tagsExtensionEnabled=!(!r||!r.tagsExtensionEnabled),o().data.settings||(o().data.settings={}),o().data.settings["syntaxoutlaw-threadify.tag"]=a.currentValue,a.tagsExtensionEnabled?o().request({method:"GET",url:t()+"/tags"}):(a.loading=!1,void m.redraw())}).then(function(t){t&&t.data&&(a.tags=t.data),a.loading=!1,m.redraw()}).catch(function(){a.loading=!1,m.redraw()})},view:function(e){var a=this,r=e.attrs.setting,s=void 0!==this.currentValue?this.currentValue:o().data&&o().data.settings&&o().data.settings[r]||"";return this.tagsExtensionEnabled?m("div",{className:"Form-group"},[m("label",{},"Threadify tag"),m("select",{className:"FormControl",value:s,onchange:function(e){var s,n=e.target.value;a.currentValue=n,o().data.settings||(o().data.settings={}),o().data.settings[r]=n,a.savedMessage=!1,o().request({method:"POST",url:t()+"/settings",body:(s={},s[r]=n,s)}).then(function(){a.savedMessage=!0,m.redraw(),setTimeout(function(){a.savedMessage=!1,m.redraw()},3e3)}).catch(function(t){console.error("[Threadify] Failed to save tag setting",t)}),m.redraw()},disabled:this.loading},[m("option",{value:"",selected:""===s},"-- Select a tag --")].concat(this.tags.map(function(t){var e,a,o,r=(null==(e=t.attributes)?void 0:e.slug)||(null==(a=t.attributes)?void 0:a.name)||"",n=(null==(o=t.attributes)?void 0:o.name)||r;return m("option",{value:r,selected:s===r},n)}))),this.savedMessage&&m("p",{className:"helpText",style:{color:"var(--success-color, #4caf50)",marginTop:"0.5rem",fontWeight:"500"}},"Your settings have been saved."),m("p",{className:"helpText"},"Select which tag should enable threading for discussions.")]):m("div",{className:"Form-group"},[m("p",{className:"helpText",style:{color:"var(--muted-color, #999)"}},"Tag-based threading is not available. Enable the Tags extension (flarum/tags) to choose a threadify tag.")])}},a={oninit:function(){var e=this;this.settingsLoaded=!1,this.tagsExtensionEnabled=!1,o().request({method:"GET",url:t()+"/threadify/admin/settings"}).then(function(t){var a=t&&(void 0!==t.threadifyTag?t:t.data||{});e.tagsExtensionEnabled=!(!a||!a.tagsExtensionEnabled),e.settingsLoaded=!0,m.redraw()}).catch(function(){e.settingsLoaded=!0,m.redraw()})},view:function(){if(!this.settingsLoaded)return m("div",{className:"Form-group"},m("p",{className:"helpText"},"Loading…"));if(!this.tagsExtensionEnabled)return m("div",[m("div",{className:"Form-group"},[m("label",{},"Threadify mode"),m("p",{className:"helpText",style:{marginTop:"0.25rem"}},"Thread all discussions.")]),m("div",{className:"Form-group"},[m("label",{},"Threadify tag"),m("p",{className:"helpText",style:{marginTop:"0.25rem"}},"Enable the Tags extension (flarum/tags) to use tag-based threading.")])]);var a=o().data.settings["syntaxoutlaw-threadify.mode"]||"default",r="tag"===a;return m("div",[m("div",{className:"Form-group"},[m("label",{},"Threadify mode"),m("select",{className:"FormControl",value:a,onchange:function(e){var a=e.target.value;o().data.settings||(o().data.settings={}),o().data.settings["syntaxoutlaw-threadify.mode"]=a,o().request({method:"POST",url:t()+"/settings",body:{"syntaxoutlaw-threadify.mode":a}}).catch(function(){}),m.redraw()}},[m("option",{value:"default"},"Thread all discussions"),m("option",{value:"tag"},"Thread discussions with selected tag")])]),m("div",{className:"Form-group"},[m(e,{setting:"syntaxoutlaw-threadify.tag"}),!r&&m("p",{className:"helpText",style:{color:"var(--muted-color, #999)",fontStyle:"italic",marginTop:"0.5rem"}},'Note: This setting only applies when "Thread discussions with selected tag" mode is enabled.')])])}};o().extensionData.for("syntaxoutlaw-threadify").registerSetting(function(){return m(a)}).registerSetting(function(){return m("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border-color, #ddd)",marginBottom:"2rem",paddingBottom:"1.5rem",borderBottom:"1px solid var(--border-color, #ddd)"}},[m("button",{className:"Button Button--danger",onclick:function(){o().modal.show(l)},disabled:this.loading},this.loading?"Rebuilding...":"Rebuild Threadify Database Tables")])})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map
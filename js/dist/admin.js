(()=>{var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var o in a)e.o(a,o)&&!e.o(t,o)&&Object.defineProperty(t,o,{enumerable:!0,get:a[o]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};(()=>{"use strict";function t(e,a){return t=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},t(e,a)}const a=flarum.core.compat["admin/app"];var o=e.n(a);const r=flarum.core.compat["common/components/Modal"];var n=e.n(r);const s=flarum.core.compat["common/components/Button"];var i=e.n(s);console.log("[Threadify] Admin panel JS loaded");var l=function(e){function a(){return e.apply(this,arguments)||this}var r,n;n=e,(r=a).prototype=Object.create(n.prototype),r.prototype.constructor=r,t(r,n);var s=a.prototype;return s.oninit=function(t){e.prototype.oninit.call(this,t),this.loading=!1,this.result=null,this.error=null},s.className=function(){return"RebuildConfirmModal Modal--small"},s.title=function(){return this.result?"Rebuild Complete":this.error?"Rebuild Failed":"Rebuild Threadify Database Tables"},s.content=function(){var e=this;if(this.result){var t=this.result.results||{};return[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--success-color, #4caf50)"}},[m("strong","✅ Rebuild completed successfully!")]),m("div",{style:{fontSize:"0.9em",color:"var(--muted-color, #999)",marginBottom:"1rem"}},[m("p",{style:{margin:"0.25rem 0"}},"Threads processed: "+(t.threads_processed||0)),m("p",{style:{margin:"0.25rem 0"}},"Threads cleared: "+(t.threads_cleared||0)),m("p",{style:{margin:"0.25rem 0"}},"Errors: "+(t.threads_errors||0)),void 0!==t.parent_id_updated&&m("p",{style:{margin:"0.25rem 0"}},"Parent IDs updated: "+(t.parent_id_updated||0))])])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",onclick:function(){return e.hide()}},"Close")])]}return this.error?[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--alert-color, #f44336)"}},[m("strong","❌ Rebuild failed:")]),m("p",{style:{color:"var(--text-color, #333)"}},this.error)])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",onclick:function(){e.error=null,e.loading=!1,m.redraw()}},"Try Again"),i().component({className:"Button",onclick:function(){return e.hide()}},"Close")])]:[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem"}},[m("strong","⚠️ DANGER: "),"This action will rebuild the parent_id and threadify_threads tables from scratch."]),m("p",{style:{marginBottom:"1rem",color:"var(--muted-color, #999)"}},["This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions."]),m("p",{style:{marginBottom:"0",fontWeight:"bold"}},["Are you sure you want to continue?"])])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",loading:this.loading,onclick:function(){e.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/threadify/admin/rebuild-parent-ids"}).then(function(t){console.log("Rebuild complete:",t.results),e.result=t,e.loading=!1,m.redraw()}).catch(function(t){e.error=t.message||t,e.loading=!1,m.redraw()})}},"Yes, Rebuild Now"),i().component({className:"Button",onclick:function(){return e.hide()}},"Cancel")])]},a}(n());o().initializers.add("syntaxoutlaw-threadify-admin",function(){var e=function(){return o().forum.attribute("apiUrl")},t="syntaxoutlaw-threadify.tags",a={oninit:function(){var e=this;this.open=!1,this.searchQuery="",this.dom=null,this.clickOutside=function(t){e.open&&e.dom&&!e.dom.contains(t.target)&&(e.open=!1,e.searchQuery="",m.redraw())}},oncreate:function(e){this.dom=e.dom,document.addEventListener("click",this.clickOutside)},onupdate:function(e){this.dom=e.dom},onremove:function(){document.removeEventListener("click",this.clickOutside)},view:function(e){var t=this,a=e.attrs,r=a.options,n=a.selected,s=a.onToggle,i=a.placeholder,l=a.disabled,d=a.disabledMessage,c=a.getLabel,u=(this.searchQuery||"").toLowerCase().trim(),g=u?r.filter(function(e){return c(e).toLowerCase().includes(u)}):r,p=0===n.length?i||"Select…":1===n.length?c(r.find(function(e){var t,a;return((null==(t=e.attributes)?void 0:t.slug)||(null==(a=e.attributes)?void 0:a.name)||"")===n[0]})||{attributes:{name:n[0]}}):n.length+" tag(s) selected";return m("div",{className:"ThreadifyMultiSelect",style:{position:"relative",marginTop:"0.25rem"}},[m("button",{type:"button",className:"FormControl",style:{textAlign:"left",cursor:l?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"space-between",opacity:l?.6:1},onclick:function(e){e.stopPropagation(),l?d&&o().alerts.show({type:"info"},d):(t.open=!t.open,m.redraw())}},[m("span",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},p),m("span",{style:{marginLeft:"0.5rem",flexShrink:0}},this.open?" ▲":" ▼")]),this.open&&!l&&m("div",{className:"Dropdown-menu",style:{position:"absolute",top:"100%",left:0,right:0,marginTop:"2px",zIndex:1e3,background:"var(--body-bg, #fff)",border:"1px solid var(--border-color, #ddd)",borderRadius:"4px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",maxHeight:"280px",display:"flex",flexDirection:"column"}},[m("div",{style:{padding:"6px",borderBottom:"1px solid var(--border-color, #eee)"}},[m("input",{type:"text",className:"FormControl",placeholder:"Search tags…",value:this.searchQuery,oninput:function(e){t.searchQuery=e.target.value,m.redraw()},onkeydown:function(e){e.stopPropagation()},style:{margin:0}})]),m("div",{style:{overflowY:"auto",maxHeight:"220px",padding:"4px 0"}},0===g.length?m("div",{style:{padding:"8px 12px",color:"var(--muted-color, #999)"}},"No tags match"):g.map(function(e){var t,a,o=(null==(t=e.attributes)?void 0:t.slug)||(null==(a=e.attributes)?void 0:a.name)||"",r=c(e),i=n.includes(o);return m("div",{role:"button",tabindex:0,className:"Dropdown-item",style:{cursor:"pointer",padding:"6px 12px",display:"flex",alignItems:"center",gap:"8px",background:i?"var(--primary-color, #4d698e)":"transparent",color:i?"#fff":"inherit"},onclick:function(e){e.preventDefault(),e.stopPropagation(),s(o,i)},onkeydown:function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),s(o,i))}},[m("span",{style:{flexShrink:0,width:"16px",textAlign:"center"}},i?"✓":""),m("span",{style:{overflow:"hidden",textOverflow:"ellipsis"}},r)])}))])])}},r={oninit:function(a){var r=this;this.tags=[],this.selectedTags=[],this.loading=!0,this.tagsExtensionEnabled=!1,o().request({method:"GET",url:e()+"/threadify/admin/settings"}).then(function(a){var n=a&&(void 0!==a.threadifyTag?a:a.data||{});return r.selectedTags=Array.isArray(n&&n.threadifyTags)?n.threadifyTags:n&&n.threadifyTag?[n.threadifyTag]:["threadify"],r.tagsExtensionEnabled=!(!n||!n.tagsExtensionEnabled),o().data.settings||(o().data.settings={}),o().data.settings[t]=JSON.stringify(r.selectedTags),r.tagsExtensionEnabled?o().request({method:"GET",url:e()+"/tags"}):(r.loading=!1,void m.redraw())}).then(function(e){e&&e.data&&(r.tags=e.data),r.loading=!1,m.redraw()}).catch(function(){r.loading=!1,m.redraw()})},view:function(r){var n=this,s=r.attrs.isTagMode||!1;if(!this.tagsExtensionEnabled)return m("div",{className:"Form-group"},[m("p",{className:"helpText",style:{color:"var(--muted-color, #999)"}},"Tag-based threading is not available. Enable the Tags extension (flarum/tags) to choose threadify tags.")]);var i=Array.isArray(this.selectedTags)?this.selectedTags:[];return m("div",{className:"Form-group"},[m("label",{},"Threadify tag(s)"),m(a,{options:this.tags,selected:i,onToggle:function(a,r){!function(a){var r;n.selectedTags=a;var s=JSON.stringify(a);o().data.settings||(o().data.settings={}),o().data.settings[t]=s,o().request({method:"POST",url:e()+"/settings",body:(r={},r[t]=s,r)}).then(function(){o().alerts.show({type:"success"},"Your settings have been saved."),m.redraw()}).catch(function(e){console.error("[Threadify] Failed to save tag setting",e)}),m.redraw()}(r?i.filter(function(e){return e!==a}):i.concat(a))},placeholder:"Select tag(s)…",disabled:!s||this.loading,disabledMessage:'This setting only applies when "Thread discussions by tag" mode is enabled.',getLabel:function(e){return e.attributes&&(e.attributes.name||e.attributes.slug)||""}}),m("p",{className:"helpText",style:{marginTop:"0.5rem"}},"Select which tag(s) enable threading for discussions. Discussions with any selected tag will be threaded.")])}},n={oninit:function(){var t=this;this.settingsLoaded=!1,this.tagsExtensionEnabled=!1,o().request({method:"GET",url:e()+"/threadify/admin/settings"}).then(function(e){var a=e&&(void 0!==e.threadifyTag?e:e.data||{});t.tagsExtensionEnabled=!(!a||!a.tagsExtensionEnabled),t.settingsLoaded=!0,m.redraw()}).catch(function(){t.settingsLoaded=!0,m.redraw()})},view:function(){if(!this.settingsLoaded)return m("div",{className:"Form-group"},m("p",{className:"helpText"},"Loading…"));if(!this.tagsExtensionEnabled)return m("div",[m("div",{className:"Form-group"},[m("label",{},"Threadify mode"),m("p",{className:"helpText",style:{marginTop:"0.25rem"}},"Thread all discussions.")]),m("div",{className:"Form-group"},[m("label",{},"Threadify tag"),m("p",{className:"helpText",style:{marginTop:"0.25rem"}},"Enable the Tags extension (flarum/tags) to use tag-based threading.")])]);var t=o().data.settings["syntaxoutlaw-threadify.mode"]||"default",a="tag"===t;return m("div",[m("div",{className:"Form-group"},[m("label",{},"Threadify mode"),m("select",{className:"FormControl",value:t,onchange:function(t){var a=t.target.value;o().data.settings||(o().data.settings={}),o().data.settings["syntaxoutlaw-threadify.mode"]=a,o().request({method:"POST",url:e()+"/settings",body:{"syntaxoutlaw-threadify.mode":a}}).then(function(){o().alerts.show({type:"success"},"Your settings have been saved."),m.redraw()}).catch(function(){}),m.redraw()}},[m("option",{value:"default"},"Thread all discussions"),m("option",{value:"tag"},"Thread discussions by tag")])]),m("div",{className:"Form-group"},[m(r,{isTagMode:a})])])}};o().extensionData.for("syntaxoutlaw-threadify").registerSetting(function(){return m(n)}).registerSetting(function(){return m("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border-color, #ddd)",marginBottom:"2rem",paddingBottom:"1.5rem",borderBottom:"1px solid var(--border-color, #ddd)"}},[m("button",{className:"Button Button--danger",onclick:function(){o().modal.show(l)},disabled:this.loading},this.loading?"Rebuilding...":"Rebuild Threadify Database Tables")])})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map
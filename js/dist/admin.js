(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var o in a)t.o(a,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:a[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";function e(t,a){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,a)}const a=flarum.core.compat["admin/app"];var o=t.n(a);const r=flarum.core.compat["common/components/Modal"];var n=t.n(r);const i=flarum.core.compat["common/components/Button"];var s=t.n(i);console.log("[Threadify] Admin panel JS loaded");var l=function(t){function a(){return t.apply(this,arguments)||this}var r,n;n=t,(r=a).prototype=Object.create(n.prototype),r.prototype.constructor=r,e(r,n);var i=a.prototype;return i.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!1,this.result=null,this.error=null},i.className=function(){return"RebuildConfirmModal Modal--small"},i.title=function(){return this.result?"Rebuild Complete":this.error?"Rebuild Failed":"Rebuild Threadify Database Tables"},i.content=function(){var t=this;if(this.result){var e=this.result.results||{};return[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--success-color, #4caf50)"}},[m("strong","✅ Rebuild completed successfully!")]),m("div",{style:{fontSize:"0.9em",color:"var(--muted-color, #999)",marginBottom:"1rem"}},[m("p",{style:{margin:"0.25rem 0"}},"Threads processed: "+(e.threads_processed||0)),m("p",{style:{margin:"0.25rem 0"}},"Threads cleared: "+(e.threads_cleared||0)),m("p",{style:{margin:"0.25rem 0"}},"Errors: "+(e.threads_errors||0)),void 0!==e.parent_id_updated&&m("p",{style:{margin:"0.25rem 0"}},"Parent IDs updated: "+(e.parent_id_updated||0))])])]),m("div",{className:"Modal-footer"},[s().component({className:"Button Button--primary",onclick:function(){return t.hide()}},"Close")])]}return this.error?[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--alert-color, #f44336)"}},[m("strong","❌ Rebuild failed:")]),m("p",{style:{color:"var(--text-color, #333)"}},this.error)])]),m("div",{className:"Modal-footer"},[s().component({className:"Button Button--primary",onclick:function(){t.error=null,t.loading=!1,m.redraw()}},"Try Again"),s().component({className:"Button",onclick:function(){return t.hide()}},"Close")])]:[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem"}},[m("strong","⚠️ DANGER: "),"This action will rebuild the parent_id and threadify_threads tables from scratch."]),m("p",{style:{marginBottom:"1rem",color:"var(--muted-color, #999)"}},["This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions."]),m("p",{style:{marginBottom:"0",fontWeight:"bold"}},["Are you sure you want to continue?"])])]),m("div",{className:"Modal-footer"},[s().component({className:"Button Button--primary",loading:this.loading,onclick:function(){t.loading=!0,o().request({method:"POST",url:o().forum.attribute("apiUrl")+"/threadify/admin/rebuild-parent-ids"}).then(function(e){console.log("Rebuild complete:",e.results),t.result=e,t.loading=!1,m.redraw()}).catch(function(e){t.error=e.message||e,t.loading=!1,m.redraw()})}},"Yes, Rebuild Now"),s().component({className:"Button",onclick:function(){return t.hide()}},"Cancel")])]},a}(n());o().initializers.add("syntaxoutlaw-threadify-admin",function(){var t={oninit:function(t){var e=this;this.tags=[],this.loading=!0,o().request({method:"GET",url:o().forum.attribute("apiUrl")+"/tags"}).then(function(t){e.tags=t.data||[],e.loading=!1,m.redraw()}).catch(function(){e.loading=!1,m.redraw()})},view:function(t){var e=t.attrs.setting,a=o().data&&o().data.settings&&o().data.settings[e]||"";return m("div",{className:"Form-group"},[m("label",{},"Threadify tag"),m("select",{className:"FormControl",value:a,onchange:function(t){var a=t.target.value;o().data.settings||(o().data.settings={}),o().data.settings[e]=a,m.redraw()},disabled:this.loading},[m("option",{value:""},"-- Select a tag --")].concat(this.tags.map(function(t){var e,a,o,r=(null==(e=t.attributes)?void 0:e.slug)||(null==(a=t.attributes)?void 0:a.name)||"",n=(null==(o=t.attributes)?void 0:o.name)||r;return m("option",{value:r},n)}))),m("p",{className:"helpText"},'Select which tag should enable threading for discussions. Only discussions with this tag will be threaded when "Thread by tag" mode is enabled.')])}};o().extensionData.for("syntaxoutlaw-threadify").registerSetting({setting:"syntaxoutlaw-threadify.mode",type:"select",label:"Threadify mode",options:{default:"Thread all discussions",tag:"Thread discussions with selected tag"},default:"default"}).registerSetting({setting:"syntaxoutlaw-threadify.tag",type:"text",label:"Threadify tag",default:"threadify"},function(){var e="tag"===(o().data.settings["syntaxoutlaw-threadify.mode"]||"default");return m("div",{className:"Form-group"},[m(t,{setting:"syntaxoutlaw-threadify.tag"}),!e&&m("p",{className:"helpText",style:{color:"var(--muted-color, #999)",fontStyle:"italic",marginTop:"0.5rem"}},'Note: This setting only applies when "Thread discussions with selected tag" mode is enabled.')])}).registerSetting(function(){return m("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border-color, #ddd)",marginBottom:"2rem",paddingBottom:"1.5rem",borderBottom:"1px solid var(--border-color, #ddd)"}},[m("button",{className:"Button Button--danger",onclick:function(){o().modal.show(l)},disabled:this.loading},this.loading?"Rebuilding...":"Rebuild Threadify Database Tables")])})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map
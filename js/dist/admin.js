(()=>{var t={n:e=>{var a=e&&e.__esModule?()=>e.default:()=>e;return t.d(a,{a}),a},d:(e,a)=>{for(var r in a)t.o(a,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:a[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};(()=>{"use strict";function e(t,a){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},e(t,a)}const a=flarum.core.compat["admin/app"];var r=t.n(a);const o=flarum.core.compat["common/components/Modal"];var s=t.n(o);const n=flarum.core.compat["common/components/Button"];var i=t.n(n);console.log("[Threadify] Admin panel JS loaded");var l=function(t){function a(){return t.apply(this,arguments)||this}var o,s;s=t,(o=a).prototype=Object.create(s.prototype),o.prototype.constructor=o,e(o,s);var n=a.prototype;return n.oninit=function(e){t.prototype.oninit.call(this,e),this.loading=!1,this.result=null,this.error=null},n.className=function(){return"RebuildConfirmModal Modal--small"},n.title=function(){return this.result?"Rebuild Complete":this.error?"Rebuild Failed":"Rebuild Threadify Database Tables"},n.content=function(){var t=this;if(this.result){var e=this.result.results||{};return[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--success-color, #4caf50)"}},[m("strong","✅ Rebuild completed successfully!")]),m("div",{style:{fontSize:"0.9em",color:"var(--muted-color, #999)",marginBottom:"1rem"}},[m("p",{style:{margin:"0.25rem 0"}},"Threads processed: "+(e.threads_processed||0)),m("p",{style:{margin:"0.25rem 0"}},"Threads cleared: "+(e.threads_cleared||0)),m("p",{style:{margin:"0.25rem 0"}},"Errors: "+(e.threads_errors||0)),void 0!==e.parent_id_updated&&m("p",{style:{margin:"0.25rem 0"}},"Parent IDs updated: "+(e.parent_id_updated||0))])])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",onclick:function(){return t.hide()}},"Close")])]}return this.error?[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem",color:"var(--alert-color, #f44336)"}},[m("strong","❌ Rebuild failed:")]),m("p",{style:{color:"var(--text-color, #333)"}},this.error)])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",onclick:function(){t.error=null,t.loading=!1,m.redraw()}},"Try Again"),i().component({className:"Button",onclick:function(){return t.hide()}},"Close")])]:[m("div",{className:"Modal-body"},[m("div",{className:"Form-group"},[m("p",{style:{marginBottom:"1rem"}},[m("strong","⚠️ DANGER: "),"This action will rebuild the parent_id and threadify_threads tables from scratch."]),m("p",{style:{marginBottom:"1rem",color:"var(--muted-color, #999)"}},["This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions."]),m("p",{style:{marginBottom:"0",fontWeight:"bold"}},["Are you sure you want to continue?"])])]),m("div",{className:"Modal-footer"},[i().component({className:"Button Button--primary",loading:this.loading,onclick:function(){t.loading=!0,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/threadify/admin/rebuild-parent-ids"}).then(function(e){console.log("Rebuild complete:",e.results),t.result=e,t.loading=!1,m.redraw()}).catch(function(e){t.error=e.message||e,t.loading=!1,m.redraw()})}},"Yes, Rebuild Now"),i().component({className:"Button",onclick:function(){return t.hide()}},"Cancel")])]},a}(s());r().initializers.add("syntaxoutlaw-threadify-admin",function(){var t={oninit:function(t){var e=this;this.tags=[],this.currentValue="",this.loading=!0,this.savedMessage=!1;var a=r().forum.attribute("apiUrl");Promise.all([r().request({method:"GET",url:a+"/tags"}),r().request({method:"GET",url:a+"/threadify/admin/settings"})]).then(function(t){var a=t[0],o=t[1];e.tags=a.data||[];var s=o&&(void 0!==o.threadifyTag?o:o.data);e.currentValue=s&&s.threadifyTag||"",r().data.settings||(r().data.settings={}),r().data.settings["syntaxoutlaw-threadify.tag"]=e.currentValue,e.loading=!1,m.redraw()}).catch(function(){e.loading=!1,m.redraw()})},view:function(t){var e=this,a=t.attrs.setting,o=void 0!==this.currentValue?this.currentValue:r().data&&r().data.settings&&r().data.settings[a]||"";return m("div",{className:"Form-group"},[m("label",{},"Threadify tag"),m("select",{className:"FormControl",value:o,onchange:function(t){var o,s=t.target.value;e.currentValue=s,r().data.settings||(r().data.settings={}),r().data.settings[a]=s,e.savedMessage=!1,r().request({method:"POST",url:r().forum.attribute("apiUrl")+"/settings",body:(o={},o[a]=s,o)}).then(function(){e.savedMessage=!0,m.redraw(),setTimeout(function(){e.savedMessage=!1,m.redraw()},3e3)}).catch(function(t){console.error("[Threadify] Failed to save tag setting",t)}),m.redraw()},disabled:this.loading},[m("option",{value:"",selected:""===o},"-- Select a tag --")].concat(this.tags.map(function(t){var e,a,r,s=(null==(e=t.attributes)?void 0:e.slug)||(null==(a=t.attributes)?void 0:a.name)||"",n=(null==(r=t.attributes)?void 0:r.name)||s;return m("option",{value:s,selected:o===s},n)}))),this.savedMessage&&m("p",{className:"helpText",style:{color:"var(--success-color, #4caf50)",marginTop:"0.5rem",fontWeight:"500"}},"Your settings have been saved."),m("p",{className:"helpText"},'Select which tag should enable threading for discussions. Only discussions with this tag will be threaded when "Thread by tag" mode is enabled.')])}};r().extensionData.for("syntaxoutlaw-threadify").registerSetting({setting:"syntaxoutlaw-threadify.mode",type:"select",label:"Threadify mode",options:{default:"Thread all discussions",tag:"Thread discussions with selected tag"},default:"default"}).registerSetting(function(){var e="tag"===(r().data.settings["syntaxoutlaw-threadify.mode"]||"default");return m("div",[m(t,{setting:"syntaxoutlaw-threadify.tag"}),!e&&m("p",{className:"helpText",style:{color:"var(--muted-color, #999)",fontStyle:"italic",marginTop:"0.5rem"}},'Note: This setting only applies when "Thread discussions with selected tag" mode is enabled.')])}).registerSetting(function(){return m("div",{style:{marginTop:"2rem",paddingTop:"1.5rem",borderTop:"1px solid var(--border-color, #ddd)",marginBottom:"2rem",paddingBottom:"1.5rem",borderBottom:"1px solid var(--border-color, #ddd)"}},[m("button",{className:"Button Button--danger",onclick:function(){r().modal.show(l)},disabled:this.loading},this.loading?"Rebuilding...":"Rebuild Threadify Database Tables")])})})})(),module.exports={}})();
//# sourceMappingURL=admin.js.map
{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/bootstrap","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/compat get default export","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/define property getters","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/hasOwnProperty shorthand","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['admin/app']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/components/Button']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/admin/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import app from 'flarum/admin/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\n\nconsole.log('[Threadify] Admin panel JS loaded');\n\n// Confirmation modal for rebuild action\nclass RebuildConfirmModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.loading = false;\n    this.result = null;\n    this.error = null;\n  }\n\n  className() {\n    return 'RebuildConfirmModal Modal--small';\n  }\n\n  title() {\n    if (this.result) {\n      return 'Rebuild Complete';\n    }\n    if (this.error) {\n      return 'Rebuild Failed';\n    }\n    return 'Rebuild Threadify Database Tables';\n  }\n\n  content() {\n    // Show success results\n    if (this.result) {\n      const results = this.result.results || {};\n      return [\n        m('div', { className: 'Modal-body' }, [\n          m('div', { className: 'Form-group' }, [\n            m('p', { style: { marginBottom: '1rem', color: 'var(--success-color, #4caf50)' } }, [\n              m('strong', '✅ Rebuild completed successfully!')\n            ]),\n            m('div', { style: { fontSize: '0.9em', color: 'var(--muted-color, #999)', marginBottom: '1rem' } }, [\n              m('p', { style: { margin: '0.25rem 0' } }, `Threads processed: ${results.threads_processed || 0}`),\n              m('p', { style: { margin: '0.25rem 0' } }, `Threads cleared: ${results.threads_cleared || 0}`),\n              m('p', { style: { margin: '0.25rem 0' } }, `Errors: ${results.threads_errors || 0}`),\n              results.parent_id_updated !== undefined && m('p', { style: { margin: '0.25rem 0' } }, `Parent IDs updated: ${results.parent_id_updated || 0}`),\n            ])\n          ])\n        ]),\n        m('div', { className: 'Modal-footer' }, [\n          Button.component({\n            className: 'Button Button--primary',\n            onclick: () => this.hide()\n          }, 'Close')\n        ])\n      ];\n    }\n\n    // Show error\n    if (this.error) {\n      return [\n        m('div', { className: 'Modal-body' }, [\n          m('div', { className: 'Form-group' }, [\n            m('p', { style: { marginBottom: '1rem', color: 'var(--alert-color, #f44336)' } }, [\n              m('strong', '❌ Rebuild failed:')\n            ]),\n            m('p', { style: { color: 'var(--text-color, #333)' } }, this.error)\n          ])\n        ]),\n        m('div', { className: 'Modal-footer' }, [\n          Button.component({\n            className: 'Button Button--primary',\n            onclick: () => {\n              this.error = null;\n              this.loading = false;\n              m.redraw();\n            }\n          }, 'Try Again'),\n          Button.component({\n            className: 'Button',\n            onclick: () => this.hide()\n          }, 'Close')\n        ])\n      ];\n    }\n\n    // Show confirmation\n    return [\n      m('div', { className: 'Modal-body' }, [\n        m('div', { className: 'Form-group' }, [\n          m('p', { style: { marginBottom: '1rem' } }, [\n            m('strong', '⚠️ DANGER: '),\n            'This action will rebuild the parent_id and threadify_threads tables from scratch.'\n          ]),\n          m('p', { style: { marginBottom: '1rem', color: 'var(--muted-color, #999)' } }, [\n            'This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions.'\n          ]),\n          m('p', { style: { marginBottom: '0', fontWeight: 'bold' } }, [\n            'Are you sure you want to continue?'\n          ])\n        ])\n      ]),\n      m('div', { className: 'Modal-footer' }, [\n        Button.component({\n          className: 'Button Button--primary',\n          loading: this.loading,\n          onclick: () => {\n            this.loading = true;\n            app.request({\n              method: 'POST',\n              url: app.forum.attribute('apiUrl') + '/threadify/admin/rebuild-parent-ids',\n            }).then(result => {\n              // Show detailed results in console for debugging\n              console.log('Rebuild complete:', result.results);\n              this.result = result;\n              this.loading = false;\n              m.redraw();\n            }).catch(e => {\n              this.error = e.message || e;\n              this.loading = false;\n              m.redraw();\n            });\n          }\n        }, 'Yes, Rebuild Now'),\n        Button.component({\n          className: 'Button',\n          onclick: () => this.hide()\n        }, 'Cancel')\n      ])\n    ];\n  }\n}\n\napp.initializers.add('syntaxoutlaw-threadify-admin', () => {\n  const apiUrl = () => app.forum.attribute('apiUrl');\n\n  // Load our settings first (includes tagsExtensionEnabled). Only call /tags when Tags extension is enabled.\n  const TagSelectorSetting = {\n    oninit(vnode) {\n      this.tags = [];\n      this.currentValue = '';\n      this.loading = true;\n      this.savedMessage = false;\n      this.tagsExtensionEnabled = false;\n\n      // Load our settings first so we know if Tags is enabled before calling /tags\n      app.request({ method: 'GET', url: apiUrl() + '/threadify/admin/settings' })\n        .then((settingsResponse) => {\n          const body = settingsResponse && (settingsResponse.threadifyTag !== undefined ? settingsResponse : (settingsResponse.data || {}));\n          this.currentValue = (body && body.threadifyTag) || '';\n          this.tagsExtensionEnabled = !!(body && body.tagsExtensionEnabled);\n          if (!app.data.settings) app.data.settings = {};\n          app.data.settings['syntaxoutlaw-threadify.tag'] = this.currentValue;\n\n          if (!this.tagsExtensionEnabled) {\n            this.loading = false;\n            m.redraw();\n            return;\n          }\n          // Only fetch /tags when Tags extension is enabled (avoids 404 when Tags is disabled)\n          return app.request({ method: 'GET', url: apiUrl() + '/tags' });\n        })\n        .then((tagsResponse) => {\n          if (tagsResponse && tagsResponse.data) this.tags = tagsResponse.data;\n          this.loading = false;\n          m.redraw();\n        })\n        .catch(() => {\n          this.loading = false;\n          m.redraw();\n        });\n    },\n\n    view(vnode) {\n      const setting = vnode.attrs.setting;\n      const currentValue = this.currentValue !== undefined ? this.currentValue : (app.data && app.data.settings && app.data.settings[setting]) || '';\n\n      // When Tags extension is disabled, don't render the tag dropdown (avoids 404 and hides tag-only UI)\n      if (!this.tagsExtensionEnabled) {\n        return m('div', { className: 'Form-group' }, [\n          m('p', { className: 'helpText', style: { color: 'var(--muted-color, #999)' } }, 'Tag-based threading is not available. Enable the Tags extension (flarum/tags) to choose a threadify tag.')\n        ]);\n      }\n\n      return m('div', { className: 'Form-group' }, [\n        m('label', {}, 'Threadify tag'),\n        m('select', {\n          className: 'FormControl',\n          value: currentValue,\n          onchange: (e) => {\n            const newValue = e.target.value;\n            this.currentValue = newValue;\n            if (!app.data.settings) app.data.settings = {};\n            app.data.settings[setting] = newValue;\n            this.savedMessage = false;\n            app.request({\n              method: 'POST',\n              url: apiUrl() + '/settings',\n              body: { [setting]: newValue }\n            }).then(() => {\n              this.savedMessage = true;\n              m.redraw();\n              setTimeout(() => { this.savedMessage = false; m.redraw(); }, 3000);\n            }).catch((e) => { console.error('[Threadify] Failed to save tag setting', e); });\n            m.redraw();\n          },\n          disabled: this.loading\n        }, [\n          m('option', { value: '', selected: currentValue === '' }, '-- Select a tag --'),\n          ...this.tags.map(tag => {\n            const slug = tag.attributes?.slug || tag.attributes?.name || '';\n            const name = tag.attributes?.name || slug;\n            return m('option', { value: slug, selected: currentValue === slug }, name);\n          })\n        ]),\n        this.savedMessage && m('p', {\n          className: 'helpText',\n          style: { color: 'var(--success-color, #4caf50)', marginTop: '0.5rem', fontWeight: '500' }\n        }, 'Your settings have been saved.'),\n        m('p', { className: 'helpText' }, 'Select which tag should enable threading for discussions.')\n      ]);\n    }\n  };\n\n  // When Tags is disabled we show only \"Thread all\" and a note; when enabled we show mode + tag dropdown.\n  const ThreadifyModeAndTagSettings = {\n    oninit() {\n      this.settingsLoaded = false;\n      this.tagsExtensionEnabled = false;\n      app.request({ method: 'GET', url: apiUrl() + '/threadify/admin/settings' })\n        .then((res) => {\n          const body = res && (res.threadifyTag !== undefined ? res : (res.data || {}));\n          this.tagsExtensionEnabled = !!(body && body.tagsExtensionEnabled);\n          this.settingsLoaded = true;\n          m.redraw();\n        })\n        .catch(() => { this.settingsLoaded = true; m.redraw(); });\n    },\n    view() {\n      if (!this.settingsLoaded) return m('div', { className: 'Form-group' }, m('p', { className: 'helpText' }, 'Loading…'));\n\n      // Tags disabled: assume \"Thread all\", keep Threadify tag heading, no dropdown, message on separate line\n      if (!this.tagsExtensionEnabled) {\n        return m('div', [\n          m('div', { className: 'Form-group' }, [\n            m('label', {}, 'Threadify mode'),\n            m('p', { className: 'helpText', style: { marginTop: '0.25rem' } }, 'Thread all discussions.')\n          ]),\n          m('div', { className: 'Form-group' }, [\n            m('label', {}, 'Threadify tag'),\n            m('p', { className: 'helpText', style: { marginTop: '0.25rem' } }, 'Enable the Tags extension (flarum/tags) to use tag-based threading.')\n          ])\n        ]);\n      }\n\n      // Tags enabled: show mode dropdown and tag dropdown\n      const mode = app.data.settings['syntaxoutlaw-threadify.mode'] || 'default';\n      const isTagMode = mode === 'tag';\n      return m('div', [\n        m('div', { className: 'Form-group' }, [\n          m('label', {}, 'Threadify mode'),\n          m('select', {\n            className: 'FormControl',\n            value: mode,\n            onchange: (e) => {\n              const v = e.target.value;\n              if (!app.data.settings) app.data.settings = {};\n              app.data.settings['syntaxoutlaw-threadify.mode'] = v;\n              app.request({ method: 'POST', url: apiUrl() + '/settings', body: { 'syntaxoutlaw-threadify.mode': v } }).catch(() => {});\n              m.redraw();\n            }\n          }, [\n            m('option', { value: 'default' }, 'Thread all discussions'),\n            m('option', { value: 'tag' }, 'Thread discussions with selected tag')\n          ])\n        ]),\n        m('div', { className: 'Form-group' }, [\n          m(TagSelectorSetting, { setting: 'syntaxoutlaw-threadify.tag' }),\n          !isTagMode && m('p', {\n            className: 'helpText',\n            style: { color: 'var(--muted-color, #999)', fontStyle: 'italic', marginTop: '0.5rem' }\n          }, 'Note: This setting only applies when \"Thread discussions with selected tag\" mode is enabled.')\n        ])\n      ]);\n    }\n  };\n\n  app.extensionData\n    .for('syntaxoutlaw-threadify')\n    // Mode + tag settings: when Tags disabled, show only \"Thread all\" and a note; when enabled, show mode select + tag select\n    .registerSetting(function() {\n      return m(ThreadifyModeAndTagSettings);\n    })\n    // Existing dangerous rebuild action\n    .registerSetting(function () {\n      return m('div', {\n        style: {\n          marginTop: '2rem',\n          paddingTop: '1.5rem',\n          borderTop: '1px solid var(--border-color, #ddd)',\n          marginBottom: '2rem',\n          paddingBottom: '1.5rem',\n          borderBottom: '1px solid var(--border-color, #ddd)',\n        }\n      }, [\n        m('button', {\n          className: 'Button Button--danger',\n          onclick: () => {\n            app.modal.show(RebuildConfirmModal);\n          },\n          disabled: this.loading\n        }, this.loading ? 'Rebuilding...' : 'Rebuild Threadify Database Tables')\n      ]);\n    });\n});\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","flarum","core","compat","console","log","RebuildConfirmModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","loading","result","error","className","title","content","_this","results","m","style","marginBottom","color","fontSize","margin","threads_processed","threads_cleared","threads_errors","undefined","parent_id_updated","Button","onclick","hide","redraw","fontWeight","app","method","url","attribute","then","message","Modal","add","apiUrl","TagSelectorSetting","_this2","tags","currentValue","savedMessage","tagsExtensionEnabled","settingsResponse","body","threadifyTag","data","settings","tagsResponse","view","_this3","setting","attrs","value","onchange","_body","newValue","target","setTimeout","disabled","selected","concat","map","tag","_tag$attributes","_tag$attributes2","_tag$attributes3","slug","attributes","name","marginTop","ThreadifyModeAndTagSettings","_this4","settingsLoaded","res","mode","isTagMode","v","fontStyle","registerSetting","paddingTop","borderTop","paddingBottom","borderBottom","show"],"ignoreList":[],"sourceRoot":""}
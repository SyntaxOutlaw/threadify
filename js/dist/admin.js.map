{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/bootstrap","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/compat get default export","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/define property getters","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/hasOwnProperty shorthand","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['admin/app']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/components/Button']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/admin/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import app from 'flarum/admin/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\n\nconsole.log('[Threadify] Admin panel JS loaded');\n\n// Confirmation modal for rebuild action\nclass RebuildConfirmModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.loading = false;\n    this.result = null;\n    this.error = null;\n  }\n\n  className() {\n    return 'RebuildConfirmModal Modal--small';\n  }\n\n  title() {\n    if (this.result) {\n      return 'Rebuild Complete';\n    }\n    if (this.error) {\n      return 'Rebuild Failed';\n    }\n    return 'Rebuild Threadify Database Tables';\n  }\n\n  content() {\n    // Show success results\n    if (this.result) {\n      const results = this.result.results || {};\n      return [\n        m('div', { className: 'Modal-body' }, [\n          m('div', { className: 'Form-group' }, [\n            m('p', { style: { marginBottom: '1rem', color: 'var(--success-color, #4caf50)' } }, [\n              m('strong', '✅ Rebuild completed successfully!')\n            ]),\n            m('div', { style: { fontSize: '0.9em', color: 'var(--muted-color, #999)', marginBottom: '1rem' } }, [\n              m('p', { style: { margin: '0.25rem 0' } }, `Threads processed: ${results.threads_processed || 0}`),\n              m('p', { style: { margin: '0.25rem 0' } }, `Threads cleared: ${results.threads_cleared || 0}`),\n              m('p', { style: { margin: '0.25rem 0' } }, `Errors: ${results.threads_errors || 0}`),\n              results.parent_id_updated !== undefined && m('p', { style: { margin: '0.25rem 0' } }, `Parent IDs updated: ${results.parent_id_updated || 0}`),\n            ])\n          ])\n        ]),\n        m('div', { className: 'Modal-footer' }, [\n          Button.component({\n            className: 'Button Button--primary',\n            onclick: () => this.hide()\n          }, 'Close')\n        ])\n      ];\n    }\n\n    // Show error\n    if (this.error) {\n      return [\n        m('div', { className: 'Modal-body' }, [\n          m('div', { className: 'Form-group' }, [\n            m('p', { style: { marginBottom: '1rem', color: 'var(--alert-color, #f44336)' } }, [\n              m('strong', '❌ Rebuild failed:')\n            ]),\n            m('p', { style: { color: 'var(--text-color, #333)' } }, this.error)\n          ])\n        ]),\n        m('div', { className: 'Modal-footer' }, [\n          Button.component({\n            className: 'Button Button--primary',\n            onclick: () => {\n              this.error = null;\n              this.loading = false;\n              m.redraw();\n            }\n          }, 'Try Again'),\n          Button.component({\n            className: 'Button',\n            onclick: () => this.hide()\n          }, 'Close')\n        ])\n      ];\n    }\n\n    // Show confirmation\n    return [\n      m('div', { className: 'Modal-body' }, [\n        m('div', { className: 'Form-group' }, [\n          m('p', { style: { marginBottom: '1rem' } }, [\n            m('strong', '⚠️ DANGER: '),\n            'This action will rebuild the parent_id and threadify_threads tables from scratch.'\n          ]),\n          m('p', { style: { marginBottom: '1rem', color: 'var(--muted-color, #999)' } }, [\n            'This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions.'\n          ]),\n          m('p', { style: { marginBottom: '0', fontWeight: 'bold' } }, [\n            'Are you sure you want to continue?'\n          ])\n        ])\n      ]),\n      m('div', { className: 'Modal-footer' }, [\n        Button.component({\n          className: 'Button Button--primary',\n          loading: this.loading,\n          onclick: () => {\n            this.loading = true;\n            app.request({\n              method: 'POST',\n              url: app.forum.attribute('apiUrl') + '/threadify/admin/rebuild-parent-ids',\n            }).then(result => {\n              // Show detailed results in console for debugging\n              console.log('Rebuild complete:', result.results);\n              this.result = result;\n              this.loading = false;\n              m.redraw();\n            }).catch(e => {\n              this.error = e.message || e;\n              this.loading = false;\n              m.redraw();\n            });\n          }\n        }, 'Yes, Rebuild Now'),\n        Button.component({\n          className: 'Button',\n          onclick: () => this.hide()\n        }, 'Cancel')\n      ])\n    ];\n  }\n}\n\napp.initializers.add('syntaxoutlaw-threadify-admin', () => {\n  app.extensionData\n    .for('syntaxoutlaw-threadify')\n    // Threading mode setting: thread all discussions by default, or only those with the \"threadify\" tag\n    .registerSetting({\n      setting: 'syntaxoutlaw-threadify.mode',\n      type: 'select',\n      label: 'Threadify mode',\n      options: {\n        default: 'Thread all discussions',\n        tag: 'Thread discussions with secondary tag\"',\n      },\n      default: 'default',\n    })\n    // Existing dangerous rebuild action\n    .registerSetting(function () {\n      return m('div', {\n        style: {\n          marginTop: '2rem',\n          paddingTop: '1.5rem',\n          borderTop: '1px solid var(--border-color, #ddd)',\n          marginBottom: '2rem',\n          paddingBottom: '1.5rem',\n          borderBottom: '1px solid var(--border-color, #ddd)',\n        }\n      }, [\n        m('button', {\n          className: 'Button Button--danger',\n          onclick: () => {\n            app.modal.show(RebuildConfirmModal);\n          },\n          disabled: this.loading\n        }, this.loading ? 'Rebuilding...' : 'Rebuild Threadify Database Tables')\n      ]);\n    });\n});\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","flarum","core","compat","console","log","RebuildConfirmModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","loading","result","error","className","title","content","_this","results","m","style","marginBottom","color","fontSize","margin","threads_processed","threads_cleared","threads_errors","undefined","parent_id_updated","Button","onclick","hide","redraw","fontWeight","app","method","url","attribute","then","message","Modal","add","registerSetting","setting","type","label","options","default","tag","marginTop","paddingTop","borderTop","paddingBottom","borderBottom","show","disabled"],"ignoreList":[],"sourceRoot":""}
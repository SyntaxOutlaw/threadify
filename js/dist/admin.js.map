{"version":3,"file":"admin.js","mappings":"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","sources":["webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/bootstrap","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/compat get default export","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/define property getters","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/hasOwnProperty shorthand","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['admin/app']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/components/Button']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/admin/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","function _setPrototypeOf(t, e) {\n  return _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function (t, e) {\n    return t.__proto__ = e, t;\n  }, _setPrototypeOf(t, e);\n}\nexport { _setPrototypeOf as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['admin/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","import app from 'flarum/admin/app';\nimport Modal from 'flarum/common/components/Modal';\nimport Button from 'flarum/common/components/Button';\n\nconsole.log('[Threadify] Admin panel JS loaded');\n\n// Confirmation modal for rebuild action\nclass RebuildConfirmModal extends Modal {\n  oninit(vnode) {\n    super.oninit(vnode);\n    this.loading = false;\n    this.result = null;\n    this.error = null;\n  }\n\n  className() {\n    return 'RebuildConfirmModal Modal--small';\n  }\n\n  title() {\n    if (this.result) {\n      return 'Rebuild Complete';\n    }\n    if (this.error) {\n      return 'Rebuild Failed';\n    }\n    return 'Rebuild Threadify Database Tables';\n  }\n\n  content() {\n    // Show success results\n    if (this.result) {\n      const results = this.result.results || {};\n      return [\n        m('div', { className: 'Modal-body' }, [\n          m('div', { className: 'Form-group' }, [\n            m('p', { style: { marginBottom: '1rem', color: 'var(--success-color, #4caf50)' } }, [\n              m('strong', '✅ Rebuild completed successfully!')\n            ]),\n            m('div', { style: { fontSize: '0.9em', color: 'var(--muted-color, #999)', marginBottom: '1rem' } }, [\n              m('p', { style: { margin: '0.25rem 0' } }, `Threads processed: ${results.threads_processed || 0}`),\n              m('p', { style: { margin: '0.25rem 0' } }, `Threads cleared: ${results.threads_cleared || 0}`),\n              m('p', { style: { margin: '0.25rem 0' } }, `Errors: ${results.threads_errors || 0}`),\n              results.parent_id_updated !== undefined && m('p', { style: { margin: '0.25rem 0' } }, `Parent IDs updated: ${results.parent_id_updated || 0}`),\n            ])\n          ])\n        ]),\n        m('div', { className: 'Modal-footer' }, [\n          Button.component({\n            className: 'Button Button--primary',\n            onclick: () => this.hide()\n          }, 'Close')\n        ])\n      ];\n    }\n\n    // Show error\n    if (this.error) {\n      return [\n        m('div', { className: 'Modal-body' }, [\n          m('div', { className: 'Form-group' }, [\n            m('p', { style: { marginBottom: '1rem', color: 'var(--alert-color, #f44336)' } }, [\n              m('strong', '❌ Rebuild failed:')\n            ]),\n            m('p', { style: { color: 'var(--text-color, #333)' } }, this.error)\n          ])\n        ]),\n        m('div', { className: 'Modal-footer' }, [\n          Button.component({\n            className: 'Button Button--primary',\n            onclick: () => {\n              this.error = null;\n              this.loading = false;\n              m.redraw();\n            }\n          }, 'Try Again'),\n          Button.component({\n            className: 'Button',\n            onclick: () => this.hide()\n          }, 'Close')\n        ])\n      ];\n    }\n\n    // Show confirmation\n    return [\n      m('div', { className: 'Modal-body' }, [\n        m('div', { className: 'Form-group' }, [\n          m('p', { style: { marginBottom: '1rem' } }, [\n            m('strong', '⚠️ DANGER: '),\n            'This action will rebuild the parent_id and threadify_threads tables from scratch.'\n          ]),\n          m('p', { style: { marginBottom: '1rem', color: 'var(--muted-color, #999)' } }, [\n            'This process may take a while on large forums. All existing thread relationships will be recalculated based on post mentions.'\n          ]),\n          m('p', { style: { marginBottom: '0', fontWeight: 'bold' } }, [\n            'Are you sure you want to continue?'\n          ])\n        ])\n      ]),\n      m('div', { className: 'Modal-footer' }, [\n        Button.component({\n          className: 'Button Button--primary',\n          loading: this.loading,\n          onclick: () => {\n            this.loading = true;\n            app.request({\n              method: 'POST',\n              url: app.forum.attribute('apiUrl') + '/threadify/admin/rebuild-parent-ids',\n            }).then(result => {\n              // Show detailed results in console for debugging\n              console.log('Rebuild complete:', result.results);\n              this.result = result;\n              this.loading = false;\n              m.redraw();\n            }).catch(e => {\n              this.error = e.message || e;\n              this.loading = false;\n              m.redraw();\n            });\n          }\n        }, 'Yes, Rebuild Now'),\n        Button.component({\n          className: 'Button',\n          onclick: () => this.hide()\n        }, 'Cancel')\n      ])\n    ];\n  }\n}\n\napp.initializers.add('syntaxoutlaw-threadify-admin', () => {\n  // Custom tag selector component that loads tags and integrates with Flarum's settings\n  const TagSelectorSetting = {\n    oninit(vnode) {\n      this.tags = [];\n      this.loading = true;\n      \n      // Load tags from the API\n      app.request({\n        method: 'GET',\n        url: app.forum.attribute('apiUrl') + '/tags',\n      }).then(response => {\n        this.tags = response.data || [];\n        this.loading = false;\n        m.redraw();\n      }).catch(() => {\n        this.loading = false;\n        m.redraw();\n      });\n    },\n    \n    view(vnode) {\n      const setting = vnode.attrs.setting;\n      // Get the current value from Flarum's settings data\n      // app.data.settings is populated by Flarum when the settings page loads\n      const currentValue = (app.data && app.data.settings && app.data.settings[setting]) || '';\n      \n      return m('div', { className: 'Form-group' }, [\n        m('label', {}, 'Threadify tag'),\n        m('select', {\n          className: 'FormControl',\n          value: currentValue,\n          onchange: (e) => {\n            // Update the setting value in app.data.settings so it's included when form is saved\n            const newValue = e.target.value;\n            if (!app.data.settings) {\n              app.data.settings = {};\n            }\n            app.data.settings[setting] = newValue;\n            \n            // Trigger a redraw to update the UI\n            m.redraw();\n          },\n          disabled: this.loading\n        }, [\n          m('option', { value: '' }, '-- Select a tag --'),\n          ...this.tags.map(tag => {\n            const slug = tag.attributes?.slug || tag.attributes?.name || '';\n            const name = tag.attributes?.name || slug;\n            return m('option', { value: slug }, name);\n          })\n        ]),\n        m('p', { className: 'helpText' }, 'Select which tag should enable threading for discussions. Only discussions with this tag will be threaded when \"Thread by tag\" mode is enabled.')\n      ]);\n    }\n  };\n\n  app.extensionData\n    .for('syntaxoutlaw-threadify')\n    // Threading mode setting: thread all discussions by default, or only those with a selected tag\n    .registerSetting({\n      setting: 'syntaxoutlaw-threadify.mode',\n      type: 'select',\n      label: 'Threadify mode',\n      options: {\n        default: 'Thread all discussions',\n        tag: 'Thread discussions with selected tag',\n      },\n      default: 'default',\n    })\n    // Tag selector setting (always visible, but only used when mode is \"tag\")\n    .registerSetting({\n      setting: 'syntaxoutlaw-threadify.tag',\n      type: 'text',\n      label: 'Threadify tag',\n      default: 'threadify',\n    }, function() {\n      // Custom render function - show our custom tag selector instead of text input\n      const mode = app.data.settings['syntaxoutlaw-threadify.mode'] || 'default';\n      const isTagMode = mode === 'tag';\n      \n      return m('div', { className: 'Form-group' }, [\n        m(TagSelectorSetting, {\n          setting: 'syntaxoutlaw-threadify.tag'\n        }),\n        !isTagMode && m('p', {\n          className: 'helpText',\n          style: { color: 'var(--muted-color, #999)', fontStyle: 'italic', marginTop: '0.5rem' }\n        }, 'Note: This setting only applies when \"Thread discussions with selected tag\" mode is enabled.')\n      ]);\n    })\n    // Existing dangerous rebuild action\n    .registerSetting(function () {\n      return m('div', {\n        style: {\n          marginTop: '2rem',\n          paddingTop: '1.5rem',\n          borderTop: '1px solid var(--border-color, #ddd)',\n          marginBottom: '2rem',\n          paddingBottom: '1.5rem',\n          borderBottom: '1px solid var(--border-color, #ddd)',\n        }\n      }, [\n        m('button', {\n          className: 'Button Button--danger',\n          onclick: () => {\n            app.modal.show(RebuildConfirmModal);\n          },\n          disabled: this.loading\n        }, this.loading ? 'Rebuilding...' : 'Rebuild Threadify Database Tables')\n      ]);\n    });\n});\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nfunction _inheritsLoose(t, o) {\n  t.prototype = Object.create(o.prototype), t.prototype.constructor = t, setPrototypeOf(t, o);\n}\nexport { _inheritsLoose as default };"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","_setPrototypeOf","t","e","setPrototypeOf","bind","__proto__","flarum","core","compat","console","log","RebuildConfirmModal","_Modal","apply","arguments","create","constructor","_proto","oninit","vnode","this","loading","result","error","className","title","content","_this","results","m","style","marginBottom","color","fontSize","margin","threads_processed","threads_cleared","threads_errors","undefined","parent_id_updated","Button","onclick","hide","redraw","fontWeight","app","method","url","attribute","then","message","Modal","add","TagSelectorSetting","_this2","tags","response","data","view","setting","attrs","currentValue","settings","value","onchange","newValue","target","disabled","concat","map","tag","_tag$attributes","_tag$attributes2","_tag$attributes3","slug","attributes","name","registerSetting","type","label","options","default","isTagMode","fontStyle","marginTop","paddingTop","borderTop","paddingBottom","borderBottom","show"],"ignoreList":[],"sourceRoot":""}
{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regenerator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/OverloadYield.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/regenerator/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorDefine.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/typeof.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorValues.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorKeys.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsync.js","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/bootstrap","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/compat get default export","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/define property getters","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/hasOwnProperty shorthand","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/app']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/extend']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/Post']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadsApi.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadOrderPrefetch.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/SimplifiedThreadDepth.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/ReplyComposer']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/DomReorderMode.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/components/ThreadedReplyComposer.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/components/ThreadedPost.js"],"sourcesContent":["var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Post'];","/**\n * threads-order API 轻量层\n * - 负责预取并缓存：Map<postId, { order, depth, parentId }>\n * - 暴露读取与监听工具\n */\n\nconst _cache = new Map(); // did -> { ready: Promise<void>, map: Map<number,{order,depth,parentId}> }\n\nexport function prefetchThreadsOrder(discussionId) {\n  const did = Number(discussionId);\n  if (!did) return Promise.resolve();\n\n  const hit = _cache.get(did);\n  if (hit && hit.ready) return hit.ready;\n\n  const entry = { ready: null, map: new Map() };\n  _cache.set(did, entry);\n\n  entry.ready = app.request({\n    method: 'GET',\n    url: `${app.forum.attribute('apiUrl')}/discussions/${did}/threads-order`,\n  }).then((res) => {\n    const map = new Map();\n    (res.order || []).forEach(({ postId, order, depth, parentPostId }) => {\n      map.set(Number(postId), {\n        order: Number(order),\n        depth: Number.isFinite(depth) ? Number(depth) : 0,\n        parentId: parentPostId ? Number(parentPostId) : null,\n      });\n    });\n    entry.map = map;\n\n    // 通知前端其它模块（可选）\n    try {\n      window.dispatchEvent(new CustomEvent('threadify:order-ready', { detail: { discussionId: did } }));\n    } catch (e) {}\n  }).catch((e) => {\n    console.warn('[Threadify] threads-order prefetch failed', e);\n  });\n\n  return entry.ready;\n}\n\nexport function getOrderRecord(discussionId, postId) {\n  const entry = _cache.get(Number(discussionId));\n  if (!entry) return undefined;\n  return entry.map.get(Number(postId));\n}\n\nexport function getPrefetchedDepth(discussionId, postId) {\n  const rec = getOrderRecord(discussionId, postId);\n  return rec ? rec.depth : undefined;\n}\n\nexport function hasOrderFor(discussionId) {\n  const entry = _cache.get(Number(discussionId));\n  return !!(entry && entry.map && entry.map.size);\n}\n\n// 供 SimplifiedThreadDepth 使用：把预取到的元数据回传给“加类名”逻辑\nexport function getPostThreadMetadata(post) {\n  if (!post) return null;\n  const discussion = post.discussion && post.discussion();\n  const did = discussion && discussion.id && discussion.id();\n  if (!did) return null;\n\n  const rec = getOrderRecord(did, post.id());\n  if (!rec) return null;\n\n  // 注意：rootPostId/descendantCount 这类聚合值由服务端负责；此处仅返回前端需要的 depth/parent\n  return {\n    depth: rec.depth,\n    threadPath: null,\n    isRoot: !rec.parentId,\n    childCount: 0,\n    descendantCount: 0,\n    rootPostId: null,\n  };\n}\n","/**\n * 轻量顺序预取：/discussions/:id/threads-order\n *\n * 暴露：\n *  - prefetchThreadOrder(did, { force?: boolean }) -> Promise<void>\n *  - getOrderIndex(did, postId) -> number|undefined\n *  - getDepthPrefetched(did, postId) -> number|undefined\n *  - getParentPrefetched(did, postId) -> number|undefined\n *  - getCachedOrderMap(did) -> Map|undefined  （新增：同步读缓存给其它模块复用）\n *  - waitOrderMap(did) -> Promise<Map>        （新增：等待就绪并拿 Map）\n *  - hasFreshOrder(did) -> boolean            （新增：是否在 TTL 内）\n *  - invalidateThreadOrder(did)               （新增：使某讨论缓存失效）\n *  - clearAllThreadOrderCache()               （新增：清空所有缓存）\n *\n * 事件：\n *  - window.dispatchEvent(new CustomEvent('threadify:order-ready', { detail: { discussionId } }))\n */\n\nconst _cache = new Map(); // did -> { map: Map<postId,Rec>, inflight: Promise<void>|null, ts: number }\nconst TTL_MS = 10_000;\nconst EVT_READY = 'threadify:order-ready';\n\n/**\n * @param {number|string} discussionId\n * @param {{force?: boolean}} opts\n */\nexport function prefetchThreadOrder(discussionId, opts = {}) {\n  const did = _coerceDid(discussionId);\n  if (!did) return Promise.resolve();\n\n  const now = Date.now();\n  const entry = _cache.get(did) || { map: new Map(), inflight: null, ts: 0 };\n  _cache.set(did, entry);\n\n  // 命中新鲜缓存：直接复用最后一次 inflight（若有），否则返回已完成的 resolved\n  if (!opts.force && (now - entry.ts) < TTL_MS) {\n    return entry.inflight || Promise.resolve();\n  }\n\n  // 已有请求在路上，且不强制：直接复用\n  if (entry.inflight && !opts.force) return entry.inflight;\n\n  // 发起新请求\n  const bust = now; // 避免中间层缓存\n  entry.inflight = app.request({\n    method: 'GET',\n    url: `${app.forum.attribute('apiUrl')}/discussions/${did}/threads-order?bust=${bust}`,\n  }).then((res) => {\n    const map = new Map();\n    (res && res.order ? res.order : []).forEach(({ postId, order, depth, parentPostId }) => {\n      postId = Number(postId);\n      map.set(postId, {\n        order: Number(order),\n        depth: Number.isFinite(depth) ? Number(depth) : 0,\n        parentId: parentPostId ? Number(parentPostId) : null,\n      });\n    });\n\n    entry.map = map;\n    entry.ts = Date.now();\n\n    // 广播就绪\n    try {\n      window.dispatchEvent(new CustomEvent(EVT_READY, { detail: { discussionId: Number(did) } }));\n    } catch {}\n  }).catch((e) => {\n    console.warn('[Threadify] order prefetch failed', e);\n  }).finally(() => {\n    // 标记无在途请求\n    // 注意：保留 entry.map 与 entry.ts\n    entry.inflight = null;\n  });\n\n  return entry.inflight;\n}\n\n/**\n * @param {number|string} discussionId\n * @param {number|string} postId\n * @returns {number|undefined}\n */\nexport function getOrderIndex(discussionId, postId) {\n  const map = getCachedOrderMap(discussionId);\n  const rec = map && map.get(Number(postId));\n  return rec ? rec.order : undefined;\n}\n\n/**\n * @param {number|string} discussionId\n * @param {number|string} postId\n * @returns {number|undefined}\n */\nexport function getDepthPrefetched(discussionId, postId) {\n  const map = getCachedOrderMap(discussionId);\n  const rec = map && map.get(Number(postId));\n  return rec ? rec.depth : undefined;\n}\n\n/**\n * @param {number|string} discussionId\n * @param {number|string} postId\n * @returns {number|undefined}\n */\nexport function getParentPrefetched(discussionId, postId) {\n  const map = getCachedOrderMap(discussionId);\n  const rec = map && map.get(Number(postId));\n  return rec ? rec.parentId : undefined;\n}\n\n/**\n * 同步读取缓存 Map（若不存在返回 undefined）\n * @param {number|string} discussionId\n * @returns {Map<number,{order:number,depth:number,parentId:number|null}>|undefined}\n */\nexport function getCachedOrderMap(discussionId) {\n  const did = _coerceDid(discussionId);\n  if (!did) return undefined;\n  const entry = _cache.get(did);\n  return entry ? entry.map : undefined;\n}\n\n/**\n * 等待 Map 可用并返回\n * 若缓存新鲜则立即 resolve；否则等待在途请求或触发一次预取\n * @param {number|string} discussionId\n * @returns {Promise<Map<number,{order:number,depth:number,parentId:number|null}>>}\n */\nexport function waitOrderMap(discussionId) {\n  const did = _coerceDid(discussionId);\n  if (!did) return Promise.resolve(new Map());\n\n  const now = Date.now();\n  const entry = _cache.get(did) || { map: new Map(), inflight: null, ts: 0 };\n  _cache.set(did, entry);\n\n  if ((now - entry.ts) < TTL_MS && entry.map && entry.map.size >= 0) {\n    return Promise.resolve(entry.map);\n  }\n\n  const p = entry.inflight || prefetchThreadOrder(did);\n  return p.then(() => getCachedOrderMap(did) || new Map());\n}\n\n/**\n * 缓存是否在 TTL 内新鲜\n * @param {number|string} discussionId\n */\nexport function hasFreshOrder(discussionId) {\n  const did = _coerceDid(discussionId);\n  if (!did) return false;\n  const entry = _cache.get(did);\n  if (!entry) return false;\n  return (Date.now() - (entry.ts || 0)) < TTL_MS;\n}\n\n/**\n * 使单个讨论的缓存失效（下一次 wait/prefetch 会重新拉取）\n * @param {number|string} discussionId\n */\nexport function invalidateThreadOrder(discussionId) {\n  const did = _coerceDid(discussionId);\n  if (!did) return;\n  const entry = _cache.get(did);\n  if (entry) entry.ts = 0;\n}\n\n/** 清空所有讨论的线程顺序缓存 */\nexport function clearAllThreadOrderCache() {\n  _cache.clear();\n}\n\n/* ---------------- 内部工具 ---------------- */\n\nfunction _coerceDid(discussionId) {\n  if (discussionId == null) return null;\n  const n = Number(discussionId);\n  return Number.isFinite(n) && n > 0 ? String(n) : null;\n}\n","/**\n * Simplified Thread Depth Utilities (fixed)\n *\n * 优先级：\n *  1) /threads-order 预取的 depth\n *  2) /threads 元数据里的 _threadDepth\n *  3) 本地沿 parent_id 向上爬链计算\n *\n * 始终返回 0..MAX_DISPLAY_DEPTH，且不会抛错。\n */\n\nimport { getPostThreadMetadata } from './ThreadsApi';\nimport { getDepthPrefetched, getParentPrefetched } from './ThreadOrderPrefetch';\n\nconst MAX_DISPLAY_DEPTH = 10;\n\n/** ---- helpers ---- */\nfunction clampDepth(n) {\n  const x = Number(n);\n  return Number.isFinite(x) ? Math.max(0, Math.min(MAX_DISPLAY_DEPTH, x)) : 0;\n}\n\nfunction walkDepthByParentChain(post) {\n  // 沿 parent_id 向上爬；即便父帖未加载也能给出“已知最大深度”\n  let depth = 0;\n  let guard = 0;\n  const seen = new Set();\n\n  let current = post;\n  while (current && guard < 100) {\n    const pid = current.attribute ? current.attribute('parent_id') : null;\n    if (!pid) break;\n\n    // 循环保护\n    if (seen.has(pid)) {\n      console.warn('[Threadify] cycle detected while walking parents of', post && post.id && post.id());\n      depth = 0;\n      break;\n    }\n    seen.add(pid);\n\n    depth += 1;\n    // 试着从 store 取父贴，取不到就以当前深度作准（父贴可能尚未加载）\n    const parent = app.store.getById('posts', String(pid));\n    if (!parent) break;\n\n    current = parent;\n    guard++;\n    if (depth >= MAX_DISPLAY_DEPTH) break;\n  }\n  return clampDepth(depth);\n}\n\n/** ---- public API ---- */\n\n/**\n * Get thread depth for a post (0=root)\n */\nexport function getThreadDepth(post) {\n  if (!post || typeof post.id !== 'function') return 0;\n\n  // 1) 预取顺序里的 depth（最快、最稳定）\n  try {\n    const did =\n      (post.discussion && typeof post.discussion === 'function' && post.discussion() && post.discussion().id && post.discussion().id()) ||\n      null;\n    if (did != null) {\n      const d = getDepthPrefetched(did, post.id());\n      if (Number.isInteger(d)) return clampDepth(d);\n    }\n  } catch (_) {\n    // ignore\n  }\n\n  // 2) /threads 元数据（若前端曾调用过 loadDiscussionThreads）\n  try {\n    const md = getPostThreadMetadata(post);\n    if (md && Number.isInteger(md.depth)) return clampDepth(md.depth);\n  } catch (_) {\n    // ignore\n  }\n\n  // 3) 本地按 parent_id 向上爬链\n  return walkDepthByParentChain(post);\n}\n\n/**\n * CSS classes for a post based on its thread depth.\n * 统一使用：threaded-post / thread-root / thread-depth-N / thread-deep / thread-very-deep\n */\nexport function getThreadCssClasses(post) {\n  const depth = getThreadDepth(post);\n  const classes = [];\n\n  if (depth > 0) {\n    classes.push('threaded-post');\n    classes.push(`thread-depth-${depth}`);\n    if (depth >= 3) classes.push('thread-deep');\n    if (depth >= 5) classes.push('thread-very-deep');\n  } else {\n    classes.push('thread-root');\n  }\n\n  // 尽量从预取或元数据补充“根/父”信息（可选）\n  try {\n    const did =\n      (post.discussion && typeof post.discussion === 'function' && post.discussion() && post.discussion().id && post.discussion().id()) ||\n      null;\n    const prefParent = did != null ? getParentPrefetched(did, post.id()) : undefined;\n    const md = getPostThreadMetadata(post);\n\n    const isRoot =\n      (prefParent === null || prefParent === undefined) ?\n        (!post.attribute || !post.attribute('parent_id')) :\n        (prefParent == null);\n\n    if (isRoot) classes.push('thread-root-confirmed');\n\n    // 可根据 md.childCount / md.descendantCount 再加细化类名（没有就跳过）\n    if (md && Number.isInteger(md.childCount) && md.childCount > 0) {\n      classes.push('has-children', `child-count-${Math.min(md.childCount, 10)}`);\n    }\n    if (md && Number.isInteger(md.descendantCount) && md.descendantCount > 0) {\n      classes.push('has-descendants');\n    }\n  } catch (_) {\n    // 忽略补充信息失败\n  }\n\n  return classes;\n}\n\n/** convenience helpers */\nexport function isRootPost(post) {\n  return getThreadDepth(post) === 0;\n}\n\nexport function getThreadRootId(/* post */) {\n  // 若后续需要，可接入预取 map 里的 rootId；当前仅用于样式则不强制实现\n  return null;\n}\n\nexport function getChildCount(post) {\n  const md = getPostThreadMetadata(post);\n  return md && Number.isInteger(md.childCount) ? md.childCount : 0;\n}\n\nexport function getDescendantCount(post) {\n  const md = getPostThreadMetadata(post);\n  return md && Number.isInteger(md.descendantCount) ? md.descendantCount : 0;\n}\n\nexport function getThreadPath(post) {\n  const md = getPostThreadMetadata(post);\n  return md ? md.threadPath || null : null;\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ReplyComposer'];","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","// js/src/forum/utils/DomReorderMode.js\n// 重排策略：Phase1 评论（同窗 + 子树一致）→ Phase2 事件帖（按时间就位）→ Phase3 locked 黏连 → DOM 应用\n// Realtime 兼容：检测新增 → 合并一帧 → 强刷顺序表 → 立即重排\n// 作者侧半水合：监听 data-id/class → 强刷 + 重排 +（限时重试）补齐缩进类\n// 缩进类即时修补：重排后直接给 .Post 打 thread-depth-* 等类（无需等组件重渲染）\n// 锚点复核避免 insertBefore NotFoundError；轻量 redraw 保障 Post.prototype.classes 的后续一致化\n\nimport app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport { waitOrderMap, prefetchThreadOrder, invalidateThreadOrder } from '../utils/ThreadOrderPrefetch';\n\nconst BIG = 10_000_000;\n\n/* ---------- mithril redraw throttle ---------- */\nlet redrawScheduled = false;\nfunction scheduleRedraw() {\n  if (redrawScheduled) return;\n  redrawScheduled = true;\n  try {\n    requestAnimationFrame(() => {\n      redrawScheduled = false;\n      if (typeof m === 'function' && typeof m.redraw === 'function') m.redraw();\n    });\n  } catch { redrawScheduled = false; }\n}\n\n/* ---------- DOM helpers ---------- */\nfunction getDidFromComponent(ps){ try{ return ps?.stream?.discussion?.id?.() ?? null; }catch{ return null; } }\nfunction getContainer(ps){\n  if (ps?.element?.classList?.contains('PostStream')) return ps.element;\n  return ps?.element?.querySelector?.('.PostStream') || document.querySelector('.PostStream') || null;\n}\nfunction isPostItem(el){ return el && el.nodeType===1 && el.matches('.PostStream-item[data-id]'); }\nfunction findPostsRange(container){\n  const kids = Array.from(container?.children || []);\n  if (!kids.length) return { posts: [], anchor: null };\n  let L = kids.findIndex(isPostItem); if (L<0) return { posts: [], anchor: kids[0] || null };\n  let R = kids.length-1 - [...kids].reverse().findIndex(isPostItem); if (R<L) R = L;\n  const posts = kids.slice(L, R+1).filter(isPostItem);\n  const anchor = kids[R+1] || null;\n  return { posts, anchor };\n}\nfunction sameOrder(a,b){ if (a.length!==b.length) return false; for(let i=0;i<a.length;i++) if(a[i]!==b[i]) return false; return true; }\n\n/* ---------- model helpers ---------- */\nfunction getModel(id){ try{ return app.store.getById('posts', String(id)); }catch{ return null; } }\nfunction getNumber(m){ try{ const n=m?.number?.(); return Number.isFinite(n)?n:null; }catch{ return null; } }\nfunction getCreatedTs(m){ try{ const d=m?.createdAt?.(); return d instanceof Date ? +d : null; }catch{ return null; } }\nfunction getContentType(m){\n  try{\n    if (!m) return null;\n    if (typeof m.contentType==='function') return m.contentType();\n    if (typeof m.attribute==='function') return m.attribute('contentType') ?? null;\n  }catch{}\n  return null;\n}\nfunction isEventPostByEl(el, m){\n  const ct = getContentType(m);\n  if (ct && ct !== 'comment') return true;\n  if (el?.classList?.contains('EventPost') || el?.classList?.contains('Post-event')) return true;\n  if (el?.querySelector?.('.EventPost, .Post-event, .EventPost-icon')) return true;\n  return false;\n}\n\n/* ---------- order keys ---------- */\nfunction orderKey(rec, m, id){\n  if (rec && Number.isFinite(rec.order)) return Number(rec.order);\n  const n=getNumber(m); if(n!=null) return n;\n  const t=getCreatedTs(m); if(t!=null) return BIG/2 + t;\n  return BIG + Number(id);\n}\nfunction linearKey(m, id){\n  const t=getCreatedTs(m); if(t!=null) return t;\n  const n=getNumber(m);   if(n!=null) return BIG/2 + n;\n  return BIG + Number(id);\n}\n\n/* ---------- eligibility ---------- */\nfunction computeEligibility(posts, orderMap){\n  const present = new Set(posts.map(el => Number(el.dataset.id)));\n  const models  = new Map(posts.map(el => [Number(el.dataset.id), getModel(Number(el.dataset.id))]));\n\n  const parentOf = new Map();\n  for (const el of posts){\n    const id = Number(el.dataset.id);\n    const rec = orderMap.get(id);\n    const m   = models.get(id);\n    const pid = rec ? rec.parentId : (m?.attribute ? m.attribute('parent_id') : null);\n    parentOf.set(id, pid == null ? null : Number(pid));\n  }\n\n  const events = new Set();\n  for (const el of posts){\n    const id = Number(el.dataset.id);\n    if (isEventPostByEl(el, models.get(id))) events.add(id);\n  }\n\n  const eligible = new Set();\n  for (const el of posts){\n    const id = Number(el.dataset.id);\n    if (events.has(id)) continue;\n    if (parentOf.get(id) == null) eligible.add(id);\n  }\n\n  let changed = true;\n  while (changed){\n    changed = false;\n    for (const el of posts){\n      const id = Number(el.dataset.id);\n      if (eligible.has(id) || events.has(id)) continue;\n      const pid = parentOf.get(id);\n      if (pid == null) continue;\n      if (!present.has(pid)) continue;\n      if (!eligible.has(pid)) continue;\n      eligible.add(id); changed = true;\n    }\n  }\n\n  return { eligible, events, models, parentOf, present };\n}\n\n/* ---------- build phases ---------- */\nfunction buildBaseTarget(posts, eligible, events, orderMap, models){\n  const eligList = posts.filter(el => eligible.has(Number(el.dataset.id)));\n  const sortedElig = eligList.slice().sort((a,b)=>{\n    const ida=Number(a.dataset.id), idb=Number(b.dataset.id);\n    const ka=orderKey(orderMap.get(ida), models.get(ida), ida);\n    const kb=orderKey(orderMap.get(idb), models.get(idb), idb);\n    return ka===kb ? ida-idb : ka-kb;\n  });\n\n  const base=[]; let j=0;\n  for (const el of posts){\n    const id=Number(el.dataset.id);\n    base.push(eligible.has(id) ? sortedElig[j++] : el);\n  }\n\n  const withoutEvents = base.filter(el => !events.has(Number(el.dataset.id)));\n  const evtList = posts.filter(el => events.has(Number(el.dataset.id))).sort((a,b)=>{\n    const ida=Number(a.dataset.id), idb=Number(b.dataset.id);\n    const ka=linearKey(models.get(ida), ida), kb=linearKey(models.get(idb), idb);\n    return ka===kb ? ida-idb : ka-kb;\n  });\n\n  const out = withoutEvents.slice();\n  const commentKey = (el)=> linearKey(models.get(Number(el.dataset.id)), Number(el.dataset.id));\n\n  for (const evEl of evtList){\n    const eid=Number(evEl.dataset.id);\n    const ek =linearKey(models.get(eid), eid);\n    let insertAt=-1;\n    for (let i=0;i<out.length;i++){ if (commentKey(out[i]) > ek) { insertAt=i; break; } }\n    if (insertAt===-1) out.push(evEl); else out.splice(insertAt,0,evEl);\n  }\n  return out;\n}\n\nfunction applyLockedCohesion(sequence, eligible, events, models, parentOf){\n  const presentIds = sequence.map(el => Number(el.dataset.id));\n  const present    = new Set(presentIds);\n  const locked     = new Set(presentIds.filter(id => !events.has(id) && !eligible.has(id)));\n  if (!locked.size) return sequence;\n\n  function nearestVisibleLockedAncestor(id){\n    let cur=id;\n    for (let g=0; g<100; g++){\n      const pid = parentOf.get(cur);\n      if (pid == null) return null;\n      if (!present.has(pid)) return null;\n      if (locked.has(pid)) return pid;\n      cur = pid;\n    }\n    return null;\n  }\n\n  const groups = new Map();\n  for (const id of locked){\n    const root = nearestVisibleLockedAncestor(id);\n    if (root == null || root === id) continue;\n    if (!groups.has(root)) groups.set(root, new Set());\n    groups.get(root).add(id);\n  }\n  if (!groups.size) return sequence;\n\n  const out = sequence.slice();\n  const indexOfId = new Map(out.map((el,idx)=>[Number(el.dataset.id), idx]));\n  const sortedRoots = Array.from(groups.keys()).sort((a,b)=> indexOfId.get(a)-indexOfId.get(b));\n\n  function extractMembers(ids){\n    const set = new Set(ids); const picked=[];\n    for (let i=0;i<out.length;i++){\n      const id=Number(out[i].dataset.id);\n      if (set.has(id)){ picked.push(out[i]); out.splice(i,1); i--; }\n    }\n    return picked;\n  }\n\n  for (const rootId of sortedRoots){\n    const rootIdx = out.findIndex(el => Number(el.dataset.id)===rootId);\n    if (rootIdx < 0) continue;\n    const memberIds = Array.from(groups.get(rootId)).sort((a,b)=>{\n      const ka=linearKey(models.get(a),a), kb=linearKey(models.get(b),b);\n      return ka===kb ? a-b : ka-kb;\n    });\n    const membersEls = extractMembers(memberIds);\n    out.splice(rootIdx+1, 0, ...membersEls);\n  }\n  return out;\n}\n\n/* ---------- depth class patch ---------- */\nfunction ensureDepthClassesForWindow(container, orderMap){\n  const posts = Array.from(container.querySelectorAll('.PostStream-item[data-id]'));\n  if (!posts.length) return false;\n\n  const models  = new Map(posts.map(el => [Number(el.dataset.id), getModel(Number(el.dataset.id))]));\n  const parentOf= new Map(posts.map(el=>{\n    const id=Number(el.dataset.id);\n    const rec=orderMap.get(id);\n    const m =models.get(id);\n    const pid= rec ? rec.parentId : (m?.attribute ? m.attribute('parent_id') : null);\n    return [id, pid==null ? null : Number(pid)];\n  }));\n\n  const MAX_DEPTH=10;\n  const clamp=(n)=>Number.isFinite(n)?Math.max(0,Math.min(MAX_DEPTH,n)):0;\n\n  function computeDepth(id){\n    const rec=orderMap.get(id);\n    if (rec && Number.isInteger(rec.depth)) return clamp(rec.depth);\n    let depth=0, guard=0, cur=id; const seen=new Set([id]);\n    while (guard++<100){\n      const pid=parentOf.get(cur);\n      if (!pid) break;\n      if (seen.has(pid)) { depth=0; break; }\n      seen.add(pid); depth++; cur=pid;\n      if (depth>=MAX_DEPTH) break;\n    }\n    return clamp(depth);\n  }\n\n  function applyDepthClasses(itemEl, depth, isEvent){\n    const postEl = itemEl.querySelector('.Post') || itemEl;\n    const toRemove=[];\n    postEl.classList.forEach(c => { if (/^(thread-(root|ed-post|depth-\\d+|deep|very-deep))$/.test(c)) toRemove.push(c); });\n    toRemove.forEach(c => postEl.classList.remove(c));\n    if (isEvent){ postEl.classList.add('thread-root'); return true; }\n    if (depth>0){\n      postEl.classList.add('threaded-post', `thread-depth-${depth}`);\n      if (depth>=3) postEl.classList.add('thread-deep');\n      if (depth>=5) postEl.classList.add('thread-very-deep');\n    } else {\n      postEl.classList.add('thread-root');\n    }\n    return true;\n  }\n\n  let changed=false;\n  for (const item of posts){\n    const id=Number(item.dataset.id);\n    const m =models.get(id);\n    const event = isEventPostByEl(item, m);\n    const depth = event ? 0 : computeDepth(id);\n    changed = applyDepthClasses(item, depth, event) || changed;\n  }\n  return changed;\n}\n\n/* ---------- one-shot pipeline ---------- */\nasync function reorderOnce(container, did){\n  const orderMap = (await waitOrderMap(did)) || new Map();\n  const { posts } = findPostsRange(container);\n  if (!posts.length) return;\n\n  const { eligible, events, models, parentOf } = computeEligibility(posts, orderMap);\n  const base   = buildBaseTarget(posts, eligible, events, orderMap, models);\n  const target = applyLockedCohesion(base, eligible, events, models, parentOf);\n\n  if (!sameOrder(posts, target)){\n    const latest = findPostsRange(container);\n    const anchor = (latest.anchor && latest.anchor.parentNode===container) ? latest.anchor : null;\n    try {\n      for (const el of target){\n        if (anchor && anchor.parentNode===container) container.insertBefore(el, anchor);\n        else container.appendChild(el);\n      }\n    } catch(e){ console.warn('[Threadify] reorder failed (will retry)', e); }\n  }\n\n  ensureDepthClassesForWindow(container, orderMap);\n  scheduleRedraw();\n}\n\n/* ---------- lifecycle with realtime + hydration + removal deferral + scroll idle gate ---------- */\nexport function installDomReorderMode(){\n  extend(PostStream.prototype, 'oncreate', function (){\n    const did = getDidFromComponent(this);\n    const container = getContainer(this);\n    if (!did || !container) return;\n\n    // per-instance state\n    const state = {\n      isReordering: false,\n      coalesceTimer: null,\n      repairTimer: null,\n      removalTimer: null,\n      pauseUntil: 0,\n      scrollBusy: false,\n      scrollIdleTimer: null,\n    };\n    this.__threadify = state;\n\n    // scroll idle detector (window级，Flarum通常用window滚动)\n    const onScroll = () => {\n      state.scrollBusy = true;\n      clearTimeout(state.scrollIdleTimer);\n      state.scrollIdleTimer = setTimeout(() => { state.scrollBusy = false; }, 120);\n    };\n    try { window.addEventListener('scroll', onScroll, { passive: true }); } catch {}\n\n    const safeReorder = async () => {\n      if (state.isReordering) return;\n      const now = Date.now();\n      if (now < state.pauseUntil) return;\n      if (state.scrollBusy) return; // 等滚动空闲\n      state.isReordering = true;\n      try { await reorderOnce(container, did); }\n      finally { state.isReordering = false; }\n    };\n\n    // 初始重排\n    reorderOnce(container, did);\n\n    const observer = new MutationObserver((muts) => {\n      const childListMuts = muts.filter(m => m.type === 'childList');\n\n      /* 新增（Realtime/分页） */\n      const added = childListMuts\n        .flatMap(m => Array.from(m.addedNodes || []))\n        .filter(n => n && n.nodeType===1 && n.matches && n.matches('.PostStream-item[data-id]'));\n      if (added.length){\n        clearTimeout(state.coalesceTimer);\n        state.coalesceTimer = setTimeout(async () => {\n          if (state.isReordering) return;\n          state.isReordering = true;\n          try {\n            const map = (await waitOrderMap(did)) || new Map();\n            const missing = added.some(el => !map.has(Number(el.dataset.id)));\n            if (missing){ invalidateThreadOrder(did); await prefetchThreadOrder(did, { force: true }); }\n            await reorderOnce(container, did);\n          } catch(e){ console.warn('[Threadify] realtime reorder failed', e); }\n          finally { state.isReordering = false; }\n        }, 16);\n        return;\n      }\n\n      /* 作者侧半水合 */\n      const hydrationHit = muts.some((m) => {\n        if (m.type !== 'attributes') return false;\n        const el = m.target;\n        if (!el?.matches?.('.PostStream-item')) return false;\n        if (m.attributeName === 'data-id') return !!el.getAttribute('data-id');\n        if (m.attributeName === 'class'){\n          const prev = m.oldValue || ''; const now = el.className || '';\n          return /PostStream-item/.test(now) && /Post--saving/.test(prev) && !/Post--saving/.test(now);\n        }\n        return false;\n      });\n      if (hydrationHit){\n        clearTimeout(state.coalesceTimer);\n        state.coalesceTimer = setTimeout(async () => {\n          if (state.isReordering) return;\n          state.isReordering = true;\n          try {\n            invalidateThreadOrder(did);\n            await prefetchThreadOrder(did, { force: true });\n            await reorderOnce(container, did);\n            // 限时重试（缩进类修补）\n            let tries = 0;\n            clearInterval(state.repairTimer);\n            state.repairTimer = setInterval(async () => {\n              tries++;\n              const map = (await waitOrderMap(did)) || new Map();\n              const changed = ensureDepthClassesForWindow(container, map);\n              if (changed || tries >= 10){ clearInterval(state.repairTimer); scheduleRedraw(); }\n            }, 150);\n          } catch(e){ console.warn('[Threadify] hydration reorder failed', e); }\n          finally { state.isReordering = false; }\n        }, 16);\n        return;\n      }\n\n      /* 仅移除（删除/隐藏）：延后 + 等滚动空闲 + 双 rAF */\n      const removed = childListMuts\n        .flatMap(m => Array.from(m.removedNodes || []))\n        .filter(n => n && n.nodeType===1 && n.matches && n.matches('.PostStream-item, .EventPost, .Post'));\n      if (removed.length){\n        const loadingHint = container.querySelector('.LoadingIndicator, .PostStream-loading, .Post--loading');\n        const baseDelay = loadingHint ? 160 : 96;\n        state.pauseUntil = Date.now() + baseDelay + 100; // onupdate 期间暂停重排\n\n        clearTimeout(state.removalTimer);\n        const kick = () => {\n          // 等滚动空闲\n          if (state.scrollBusy || Date.now() < state.pauseUntil){\n            state.removalTimer = setTimeout(kick, 48);\n            return;\n          }\n          requestAnimationFrame(() => {\n            requestAnimationFrame(async () => { await safeReorder(); });\n          });\n        };\n        state.removalTimer = setTimeout(kick, baseDelay);\n        return;\n      }\n\n      /* 其它变化：轻量归一化（滚动忙时跳过） */\n      requestAnimationFrame(() => safeReorder());\n    });\n\n    observer.observe(container, {\n      childList: true,\n      attributes: true,\n      attributeOldValue: true,\n      attributeFilter: ['data-id', 'class'],\n      subtree: true,\n    });\n\n    this.__threadifyDomObserver = observer;\n\n    // 清理\n    this.__threadifyCleanup = () => {\n      try { observer.disconnect(); } catch {}\n      try { window.removeEventListener('scroll', onScroll, { passive: true }); } catch {}\n      clearTimeout(state.coalesceTimer);\n      clearTimeout(state.removalTimer);\n      clearInterval(state.repairTimer);\n    };\n  });\n\n  extend(PostStream.prototype, 'onupdate', function (){\n    const did = getDidFromComponent(this);\n    const container = getContainer(this);\n    if (!did || !container) return;\n    const state = this.__threadify;\n    // 删帖/分页后的冷却或滚动忙时，跳过本次重排\n    if (state && (Date.now() < state.pauseUntil || state.scrollBusy || state.isReordering)) return;\n    reorderOnce(container, did);\n  });\n\n  extend(PostStream.prototype, 'onremove', function (){\n    if (this.__threadifyCleanup) { try{ this.__threadifyCleanup(); }catch{} this.__threadifyCleanup=null; }\n    if (this.__threadify) this.__threadify=null;\n  });\n\n  try { window.addEventListener('threadify:order-ready', () => scheduleRedraw()); } catch {}\n}\n","import app from 'flarum/forum/app'; \nimport { extend } from 'flarum/common/extend';\n\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\n\nimport { initThreadedPost } from './components/ThreadedPost';\nimport { initThreadedReplyComposer } from './components/ThreadedReplyComposer';\n\nimport { installDomReorderMode } from './utils/DomReorderMode';\nimport { prefetchThreadOrder } from './utils/ThreadOrderPrefetch'; // 你已有的轻量预取，可继续用来提升首屏命中\n\n// 可选：控制 Threadify 日志的开/关（保持你之前的实现）\n(function setupThreadifyLoggingToggle() {\n  const NS = '[Threadify]';\n  const KEY = 'threadify:logs';\n  const methods = ['log', 'info', 'warn', 'debug', 'error'];\n\n  if (!window.__threadifyConsoleOriginal) {\n    window.__threadifyConsoleOriginal = {};\n    methods.forEach((name) => {\n      window.__threadifyConsoleOriginal[name] =\n        console[name] ? console[name].bind(console) : () => {};\n    });\n  }\n\n  const persisted = typeof localStorage !== 'undefined' ? localStorage.getItem(KEY) : null;\n  let enabled = persisted === '1';\n\n  function applyWrap() {\n    methods.forEach((name) => {\n      const original = window.__threadifyConsoleOriginal[name];\n      console[name] = (...args) => {\n        const first = args && args[0];\n        const isThreadifyMsg = typeof first === 'string' && first.indexOf(NS) === 0;\n        if (isThreadifyMsg && !enabled) return;\n        return original(...args);\n      };\n    });\n  }\n\n  function setEnabled(v) {\n    enabled = !!v;\n    if (typeof localStorage !== 'undefined') {\n      localStorage.setItem(KEY, enabled ? '1' : '0');\n    }\n  }\n\n  window.threadifyLogs = {\n    enable() { setEnabled(true); return 'Threadify logs: ON'; },\n    disable() { setEnabled(false); return 'Threadify logs: OFF'; },\n    toggle() { setEnabled(!enabled); return `Threadify logs: ${enabled ? 'ON' : 'OFF'}`; },\n    status() { return enabled; },\n  };\n\n  applyWrap();\n})();\n\napp.initializers.add('syntaxoutlaw-threadify', () => {\n  // 1) 提交时自动带上 parent_id（你的已有逻辑）\n  initThreadedReplyComposer();\n\n  // 2) 给帖子组件加深度类（可留可去；不会影响 Scrubber）\n  initThreadedPost();\n\n  // 3) 安装“DOM 物理重排 + 观察器”模式（核心）\n  installDomReorderMode();\n\n  // 4) 提前预取顺序（优化首屏命中）\n  extend(DiscussionPage.prototype, 'oninit', function () {\n    const did =\n      (this.discussion && typeof this.discussion.id === 'function' && this.discussion.id()) ||\n      (this.discussion && this.discussion.id) ||\n      null;\n    if (did) prefetchThreadOrder(did);\n  });\n\n  // 5) 在讨论列表悬停/触摸即预取\n  extend(DiscussionListItem.prototype, 'oncreate', function () {\n    const discussion = this.attrs.discussion;\n    if (!discussion) return;\n    const did = discussion.id();\n    const handler = () => prefetchThreadOrder(did);\n    if (this.element) {\n      this.element.addEventListener('mouseenter', handler, { once: true });\n      this.element.addEventListener('touchstart', handler, { once: true, passive: true });\n    }\n  });\n});\n","/**\n * Threaded Reply Composer Extensions\n * \n * Handles ReplyComposer component extensions for threading functionality.\n * This module is responsible for:\n * - Extracting parent_id from post mentions in reply content\n * - Adding parent_id to the reply data before submission\n * - Integrating with Flarum's mentions extension for seamless threading\n * \n * The threading system works by detecting post mentions in the format:\n * @\"Display Name\"#p123 where 123 is the post ID that becomes the parent_id\n * \n * @author Threadify Extension\n */\n\nimport { extend } from 'flarum/common/extend';\nimport ReplyComposer from 'flarum/forum/components/ReplyComposer';\n\n/**\n * Initialize ReplyComposer component extensions for threading\n * \n * Sets up hooks to automatically detect and add parent_id relationships\n * when users reply to specific posts using the mentions system.\n */\nexport function initThreadedReplyComposer() {\n  // Hook into reply submission to add parent_id\n  extend(ReplyComposer.prototype, 'data', function(data) {\n    const parentId = extractParentIdFromContent(data.content);\n    \n    if (parentId) {\n      // Add parent_id directly to the data object\n      data.parent_id = parentId;\n      console.log('[Threadify] Reply threading to post', parentId);\n    }\n    \n    return data;\n  });\n}\n\n/**\n * Extract parent post ID from reply content\n * \n * Parses the reply content for post mentions from the mentions extension\n * and extracts the post ID to use as parent_id for threading.\n * \n * Supported mention formats:\n * - @\"Display Name\"#p123 (standard post mention)\n * - Multiple mentions (uses the first one found)\n * \n * @param {string} content - The reply content to parse\n * @returns {number|null} - The parent post ID or null if none found\n */\nexport function extractParentIdFromContent(content) {\n  if (!content || typeof content !== 'string') {\n    return null;\n  }\n  \n  // Parse the content for post mentions from the mentions extension\n  // Format: @\"Display Name\"#p123 where 123 is the post ID\n  const postMentionMatch = content.match(/@\"[^\"]*\"#p(\\d+)/);\n  \n  if (postMentionMatch && postMentionMatch[1]) {\n    const parentId = parseInt(postMentionMatch[1], 10);\n    \n    // Validate that it's a valid number\n    if (!isNaN(parentId) && parentId > 0) {\n      return parentId;\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Extract all mentioned post IDs from content\n * \n * Gets all post mentions from the content, not just the first one.\n * Useful for analytics or advanced threading features.\n * \n * @param {string} content - The reply content to parse\n * @returns {number[]} - Array of mentioned post IDs\n */\nexport function extractAllMentionedPostIds(content) {\n  if (!content || typeof content !== 'string') {\n    return [];\n  }\n  \n  const postMentionRegex = /@\"[^\"]*\"#p(\\d+)/g;\n  const matches = [];\n  let match;\n  \n  while ((match = postMentionRegex.exec(content)) !== null) {\n    const postId = parseInt(match[1], 10);\n    if (!isNaN(postId) && postId > 0) {\n      matches.push(postId);\n    }\n  }\n  \n  return matches;\n}\n\n/**\n * Check if content contains post mentions\n * \n * @param {string} content - The content to check\n * @returns {boolean} - True if content contains post mentions\n */\nexport function hasPostMentions(content) {\n  return extractParentIdFromContent(content) !== null;\n}\n\n/**\n * Get threading context from reply content\n * \n * Extracts comprehensive threading information from reply content,\n * including the primary parent and any additional mentioned posts.\n * \n * @param {string} content - The reply content to analyze\n * @returns {Object} - Threading context object\n */\nexport function getThreadingContext(content) {\n  const primaryParentId = extractParentIdFromContent(content);\n  const allMentionedIds = extractAllMentionedPostIds(content);\n  \n  return {\n    primaryParentId: primaryParentId,\n    allMentionedPostIds: allMentionedIds,\n    hasMentions: allMentionedIds.length > 0,\n    mentionCount: allMentionedIds.length,\n    isThreadedReply: primaryParentId !== null\n  };\n}\n\n/**\n * Validate threading data before submission\n * \n * Performs validation on the threading data to ensure it's valid\n * before the reply is submitted to the server.\n * \n * @param {Object} data - The reply data object\n * @returns {Object} - Validation result with isValid boolean and any error messages\n */\nexport function validateThreadingData(data) {\n  const result = {\n    isValid: true,\n    errors: [],\n    warnings: []\n  };\n  \n  // Check if parent_id is present and valid\n  if (data.parent_id !== undefined) {\n    if (typeof data.parent_id !== 'number' || data.parent_id <= 0) {\n      result.isValid = false;\n      result.errors.push('Invalid parent_id: must be a positive number');\n    }\n  }\n  \n  // Check for potential threading issues\n  if (data.content && hasPostMentions(data.content)) {\n    const context = getThreadingContext(data.content);\n    \n    if (!data.parent_id && context.isThreadedReply) {\n      result.warnings.push('Content contains post mentions but no parent_id was set');\n    }\n    \n    if (context.mentionCount > 1) {\n      result.warnings.push(`Multiple post mentions found (${context.mentionCount}), only first will be used for threading`);\n    }\n  }\n  \n  return result;\n}\n\n/**\n * Clean threading data for submission\n * \n * Ensures threading data is properly formatted and cleaned before\n * being sent to the server.\n * \n * @param {Object} data - The reply data object\n * @returns {Object} - Cleaned data object\n */\nexport function cleanThreadingData(data) {\n  const cleanedData = { ...data };\n  \n  // Ensure parent_id is a proper integer or remove it\n  if (cleanedData.parent_id !== undefined) {\n    const parentId = parseInt(cleanedData.parent_id, 10);\n    if (!isNaN(parentId) && parentId > 0) {\n      cleanedData.parent_id = parentId;\n    } else {\n      delete cleanedData.parent_id;\n    }\n  }\n  \n  return cleanedData;\n} ","/**\n * Threaded Post Component Extensions\n * \n * Handles Post component extensions for threading functionality.\n * This module is responsible for:\n * - Adding threading CSS classes to posts based on their depth\n * - Managing post-specific threading visual elements\n * - Integrating with the ThreadDepth utility for depth calculations\n * \n * @author Threadify Extension\n */\n\nimport { extend } from 'flarum/common/extend';\nimport Post from 'flarum/forum/components/Post';\nimport { getThreadCssClasses } from '../utils/SimplifiedThreadDepth';\n\n/**\n * Initialize Post component extensions for threading\n * \n * Sets up all the necessary hooks and extensions for the Post component\n * to display threading information properly.\n */\nexport function initThreadedPost() {\n  // Hook into Post component to add threading CSS classes\n  extend(Post.prototype, 'classes', function(classes) {\n    const post = this.attrs.post;\n    \n    // Skip processing if we don't have a valid post\n    if (!post) {\n      console.warn('[Threadify] No post in ThreadedPost.classes');\n      return classes;\n    }\n    \n    // Get threading CSS classes from simplified utility\n    const threadClasses = getThreadCssClasses(post);\n    console.log(`[Threadify] Adding classes to post ${post.id()}: ${threadClasses.join(', ')}`);\n    \n    threadClasses.forEach(className => {\n      classes.push(className);\n    });\n    \n    return classes;\n  });\n}\n\n/**\n * Get thread metadata for a post\n * \n * Extracts useful threading metadata from a post that can be used\n * by other components or for debugging purposes.\n * \n * @param {Post} post - The post to extract metadata from\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {Object} - Thread metadata object\n */\nexport function getPostThreadMetadata(post, allPosts) {\n  if (!post) return null;\n  \n  const parentId = post.attribute('parent_id');\n  const parentPost = parentId ? allPosts.find(p => p && p.id() == parentId) : null;\n  \n  // Find direct children of this post\n  const children = allPosts.filter(p => \n    p && p.attribute('parent_id') == post.id()\n  );\n  \n  // Calculate some thread statistics\n  const descendants = getDescendantCount(post, allPosts);\n  \n  return {\n    postId: post.id(),\n    parentId: parentId,\n    hasParent: !!parentPost,\n    parentPost: parentPost,\n    directChildren: children,\n    childrenCount: children.length,\n    descendantCount: descendants,\n    isRootPost: !parentId,\n    threadClasses: getThreadCssClasses(post, allPosts)\n  };\n}\n\n/**\n * Count all descendants (children, grandchildren, etc.) of a post\n * \n * @param {Post} post - The post to count descendants for\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {number} - Total number of descendants\n */\nfunction getDescendantCount(post, allPosts) {\n  const directChildren = allPosts.filter(p => \n    p && p.attribute('parent_id') == post.id()\n  );\n  \n  let count = directChildren.length;\n  \n  // Recursively count descendants of each child\n  directChildren.forEach(child => {\n    count += getDescendantCount(child, allPosts);\n  });\n  \n  return count;\n}\n\n/**\n * Check if a post is part of a specific thread branch\n * \n * Determines if a post is either a descendant or ancestor of another post.\n * Useful for highlighting related posts or collapsing thread branches.\n * \n * @param {Post} post1 - First post\n * @param {Post} post2 - Second post  \n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {boolean} - True if posts are in the same thread branch\n */\nexport function arePostsInSameBranch(post1, post2, allPosts) {\n  if (!post1 || !post2 || post1.id() === post2.id()) {\n    return false;\n  }\n  \n  // Check if post1 is an ancestor of post2\n  let currentPost = post2;\n  while (currentPost) {\n    const parentId = currentPost.attribute('parent_id');\n    if (!parentId) break;\n    \n    if (parentId == post1.id()) {\n      return true; // post1 is an ancestor of post2\n    }\n    \n    currentPost = allPosts.find(p => p && p.id() == parentId);\n  }\n  \n  // Check if post2 is an ancestor of post1\n  currentPost = post1;\n  while (currentPost) {\n    const parentId = currentPost.attribute('parent_id');\n    if (!parentId) break;\n    \n    if (parentId == post2.id()) {\n      return true; // post2 is an ancestor of post1\n    }\n    \n    currentPost = allPosts.find(p => p && p.id() == parentId);\n  }\n  \n  return false;\n}\n\n/**\n * Get the root post of a thread branch\n * \n * Traces back through parent relationships to find the root post\n * of the thread branch that contains the given post.\n * \n * @param {Post} post - The post to find the root for\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {Post|null} - The root post of the thread branch\n */\nexport function getThreadRoot(post, allPosts) {\n  if (!post) return null;\n  \n  let currentPost = post;\n  let rootPost = post;\n  \n  // Trace back through parents until we find a post with no parent\n  while (currentPost) {\n    const parentId = currentPost.attribute('parent_id');\n    if (!parentId) {\n      rootPost = currentPost;\n      break;\n    }\n    \n    const parentPost = allPosts.find(p => p && p.id() == parentId);\n    if (!parentPost) {\n      // Parent not found, current post becomes the effective root\n      rootPost = currentPost;\n      break;\n    }\n    \n    rootPost = parentPost;\n    currentPost = parentPost;\n  }\n  \n  return rootPost;\n} \n"],"names":["OverloadYield","require","regenerator","regeneratorAsync","regeneratorAsyncGen","regeneratorAsyncIterator","regeneratorKeys","regeneratorValues","_regeneratorRuntime","r","e","m","t","Object","getPrototypeOf","__proto__","constructor","n","displayName","name","o","a","stop","v","abrupt","delegateYield","resultName","d","finish","f","_t","p","prev","next","sent","call","this","module","exports","wrap","w","reverse","isGeneratorFunction","mark","awrap","AsyncIterator","async","u","keys","values","__esModule","regeneratorDefine","_regenerator","Symbol","iterator","toStringTag","i","c","prototype","Generator","create","y","G","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","setPrototypeOf","k","resolve","then","asyncIterator","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","Promise","_regeneratorDefine","defineProperty","_invoke","enumerable","configurable","writable","_typeof","isNaN","unshift","pop","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","definition","key","get","obj","prop","hasOwnProperty","flarum","core","compat","_cache","Map","getPostThreadMetadata","post","discussion","did","id","rec","discussionId","postId","entry","Number","map","getOrderRecord","depth","threadPath","isRoot","parentId","childCount","descendantCount","rootPostId","prefetchThreadOrder","opts","_coerceDid","now","Date","inflight","ts","set","force","bust","app","request","method","url","forum","attribute","res","order","forEach","_ref","parentPostId","isFinite","window","dispatchEvent","CustomEvent","detail","_unused","console","warn","getCachedOrderMap","waitOrderMap","size","invalidateThreadOrder","String","clampDepth","x","Math","max","min","getThreadCssClasses","isInteger","_","md","guard","seen","Set","current","pid","has","add","parent","store","getById","walkDepthByParentChain","getThreadDepth","classes","push","prefParent","asyncGeneratorStep","_asyncToGenerator","arguments","apply","_next","_throw","BIG","redrawScheduled","scheduleRedraw","requestAnimationFrame","redraw","getDidFromComponent","ps","_ps$stream$discussion","_ps$stream","stream","_unused2","getContainer","_ps$element","_ps$element2","element","classList","contains","querySelector","document","isPostItem","el","nodeType","matches","findPostsRange","container","kids","Array","from","children","posts","anchor","L","findIndex","R","concat","slice","filter","sameOrder","b","getModel","_unused3","getNumber","number","_unused4","getCreatedTs","createdAt","_unused5","isEventPostByEl","_el$classList","_el$classList2","ct","_m$attribute","contentType","_unused6","getContentType","orderKey","linearKey","computeEligibility","orderMap","_step","present","dataset","models","parentOf","_iterator","_createForOfIteratorHelperLoose","_step2","events","_iterator2","_step3","eligible","_iterator3","changed","_step4","_iterator4","buildBaseTarget","_step5","eligList","sortedElig","sort","ida","idb","ka","kb","base","j","_iterator5","_step6","withoutEvents","evtList","out","commentKey","_iterator6","evEl","eid","ek","insertAt","splice","applyLockedCohesion","sequence","presentIds","locked","nearestVisibleLockedAncestor","cur","g","_step7","groups","_iterator7","root","_step8","indexOfId","idx","_loop","rootId","rootIdx","membersEls","ids","picked","extractMembers","_iterator8","ensureDepthClassesForWindow","querySelectorAll","clamp","computeDepth","applyDepthClasses","itemEl","isEvent","postEl","toRemove","test","remove","_i","_posts","item","event","reorderOnce","_x","_x2","_reorderOnce","_callee6","_findPostsRange","_computeEligibility","target","latest","_iterator9","_step9","_t5","_context6","parentNode","insertBefore","appendChild","KEY","methods","__threadifyConsoleOriginal","enabled","localStorage","getItem","setEnabled","setItem","threadifyLogs","enable","disable","toggle","status","original","_len","args","_key","first","indexOf","extend","ReplyComposer","data","content","postMentionMatch","match","parseInt","extractParentIdFromContent","parent_id","log","Post","attrs","threadClasses","join","className","PostStream","state","isReordering","coalesceTimer","repairTimer","removalTimer","pauseUntil","scrollBusy","scrollIdleTimer","__threadify","onScroll","clearTimeout","setTimeout","addEventListener","passive","_unused7","safeReorder","_callee","_context","observer","MutationObserver","muts","childListMuts","type","added","flatMap","addedNodes","_callee2","_t2","_context2","some","attributeName","getAttribute","oldValue","_callee4","tries","_t4","_context4","clearInterval","setInterval","_callee3","_t3","_context3","removedNodes","baseDelay","kick","_callee5","_context5","observe","childList","attributes","attributeOldValue","attributeFilter","subtree","__threadifyDomObserver","__threadifyCleanup","disconnect","_unused8","removeEventListener","_unused9","_unused0","_unused1","installDomReorderMode","DiscussionPage","DiscussionListItem","handler","once"],"sourceRoot":""}
{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regenerator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/OverloadYield.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/regenerator/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorDefine.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/typeof.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorValues.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorKeys.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsync.js","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/bootstrap","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/compat get default export","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/define property getters","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/hasOwnProperty shorthand","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/app']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/extend']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/Post']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/ReplyComposer']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadOrderPrefetch.ts","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/SimplifiedThreadDepth.ts","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/DomReorderMode.ts","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/index.ts","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/components/ThreadedReplyComposer.ts"],"sourcesContent":["var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Post'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ReplyComposer'];","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","import app from 'flarum/forum/app';\n\ninterface OrderRecord {\n  order: number;\n  depth: number;\n  parentId: number | null;\n}\n\ninterface CacheEntry {\n  map: Map<number, OrderRecord>;\n  inflight: Promise<void> | null;\n  ts: number;\n}\n\nconst cache = new Map<string, CacheEntry>();\nconst TTL_MS = 10_000;\nconst EVT_READY = 'threadify:order-ready';\n\nfunction coerceDid(discussionId: number | string | null | undefined): string | null {\n  if (discussionId == null) return null;\n  const n = Number(discussionId);\n  return Number.isFinite(n) && n > 0 ? String(n) : null;\n}\n\nexport function prefetchThreadOrder(\n  discussionId: number | string,\n  opts: { force?: boolean } = {}\n): Promise<void> {\n  const did = coerceDid(discussionId);\n  if (!did) return Promise.resolve();\n\n  const now = Date.now();\n  let entry = cache.get(did);\n  if (!entry) {\n    entry = { map: new Map(), inflight: null, ts: 0 };\n    cache.set(did, entry);\n  }\n\n  if (!opts.force && now - entry.ts < TTL_MS) {\n    return entry.inflight || Promise.resolve();\n  }\n\n  if (entry.inflight && !opts.force) {\n    return entry.inflight;\n  }\n\n  const bust = now;\n  entry.inflight = app\n    .request<{ order?: Array<{ postId: number; order: number; depth: number; parentPostId: number | null }> }>({\n      method: 'GET',\n      url: `${app.forum.attribute('apiUrl')}/discussions/${did}/threads-order?bust=${bust}`,\n    })\n    .then((res) => {\n      const map = new Map<number, OrderRecord>();\n      const orders = res?.order || [];\n      for (const { postId, order, depth, parentPostId } of orders) {\n        map.set(Number(postId), {\n          order: Number(order),\n          depth: Number.isFinite(depth) ? Number(depth) : 0,\n          parentId: parentPostId ? Number(parentPostId) : null,\n        });\n      }\n\n      entry!.map = map;\n      entry!.ts = Date.now();\n\n      try {\n        window.dispatchEvent(\n          new CustomEvent(EVT_READY, { detail: { discussionId: Number(did) } })\n        );\n      } catch {\n        // ignore\n      }\n    })\n    .catch((e) => {\n      console.warn('[Threadify] order prefetch failed', e);\n    })\n    .finally(() => {\n      entry!.inflight = null;\n    });\n\n  return entry.inflight;\n}\n\nexport function getOrderIndex(discussionId: number | string, postId: number | string): number | undefined {\n  const map = getCachedOrderMap(discussionId);\n  const rec = map?.get(Number(postId));\n  return rec?.order;\n}\n\nexport function getDepthPrefetched(discussionId: number | string, postId: number | string): number | undefined {\n  const map = getCachedOrderMap(discussionId);\n  const rec = map?.get(Number(postId));\n  return rec?.depth;\n}\n\nexport function getParentPrefetched(discussionId: number | string, postId: number | string): number | null | undefined {\n  const map = getCachedOrderMap(discussionId);\n  const rec = map?.get(Number(postId));\n  return rec?.parentId;\n}\n\nexport function getCachedOrderMap(discussionId: number | string): Map<number, OrderRecord> | undefined {\n  const did = coerceDid(discussionId);\n  if (!did) return undefined;\n  const entry = cache.get(did);\n  return entry?.map;\n}\n\nexport async function waitOrderMap(discussionId: number | string): Promise<Map<number, OrderRecord>> {\n  const did = coerceDid(discussionId);\n  if (!did) return new Map();\n\n  const now = Date.now();\n  let entry = cache.get(did);\n  if (!entry) {\n    entry = { map: new Map(), inflight: null, ts: 0 };\n    cache.set(did, entry);\n  }\n\n  if (now - entry.ts < TTL_MS && entry.map.size >= 0) {\n    return entry.map;\n  }\n\n  const p = entry.inflight || prefetchThreadOrder(did);\n  await p;\n  return getCachedOrderMap(did) || new Map();\n}\n\nexport function hasFreshOrder(discussionId: number | string): boolean {\n  const did = coerceDid(discussionId);\n  if (!did) return false;\n  const entry = cache.get(did);\n  if (!entry) return false;\n  return Date.now() - (entry.ts || 0) < TTL_MS;\n}\n\nexport function invalidateThreadOrder(discussionId: number | string): void {\n  const did = coerceDid(discussionId);\n  if (!did) return;\n  const entry = cache.get(did);\n  if (entry) entry.ts = 0;\n}\n\nexport function clearAllThreadOrderCache(): void {\n  cache.clear();\n}\n","import app from 'flarum/forum/app';\nimport { getDepthPrefetched } from './ThreadOrderPrefetch';\n\nconst MAX_DISPLAY_DEPTH = 10;\n\ninterface Post {\n  id(): number;\n  discussion(): { id(): number } | null;\n  attribute(name: string): unknown;\n}\n\nfunction clampDepth(n: number): number {\n  const x = Number(n);\n  return Number.isFinite(x) ? Math.max(0, Math.min(MAX_DISPLAY_DEPTH, x)) : 0;\n}\n\nfunction walkDepthByParentChain(post: Post): number {\n  let depth = 0;\n  let guard = 0;\n  const seen = new Set<number>();\n\n  let current: Post | null = post;\n  while (current && guard < 100) {\n    const pid = current.attribute('parent_id') as number | null;\n    if (!pid) break;\n\n    if (seen.has(pid)) {\n      console.warn('[Threadify] cycle detected while walking parents of', post?.id?.());\n      depth = 0;\n      break;\n    }\n    seen.add(pid);\n\n    depth += 1;\n    const parent = app.store.getById<Post>('posts', String(pid));\n    if (!parent) break;\n\n    current = parent;\n    guard++;\n    if (depth >= MAX_DISPLAY_DEPTH) break;\n  }\n  return clampDepth(depth);\n}\n\nexport function getThreadDepth(post: Post | null | undefined): number {\n  if (!post || typeof post.id !== 'function') return 0;\n\n  try {\n    const discussion = post.discussion?.();\n    const did = discussion?.id?.() ?? null;\n    if (did != null) {\n      const d = getDepthPrefetched(did, post.id());\n      if (Number.isInteger(d)) return clampDepth(d!);\n    }\n  } catch {\n    // ignore\n  }\n\n  return walkDepthByParentChain(post);\n}\n\nexport function getThreadCssClasses(post: Post | null | undefined): string[] {\n  const depth = getThreadDepth(post);\n  const classes: string[] = [];\n\n  if (depth > 0) {\n    classes.push('threaded-post');\n    classes.push(`thread-depth-${depth}`);\n    if (depth >= 3) classes.push('thread-deep');\n    if (depth >= 5) classes.push('thread-very-deep');\n  } else {\n    classes.push('thread-root');\n  }\n\n  return classes;\n}\n\nexport function isRootPost(post: Post | null | undefined): boolean {\n  return getThreadDepth(post) === 0;\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport PostStream from 'flarum/forum/components/PostStream';\nimport {\n  waitOrderMap,\n  prefetchThreadOrder,\n  invalidateThreadOrder,\n} from './ThreadOrderPrefetch';\nimport { getThreadDepth } from './SimplifiedThreadDepth';\n\ndeclare const m: { redraw(): void };\n\ninterface OrderRecord {\n  order: number;\n  depth: number;\n  parentId: number | null;\n}\n\ninterface PostModel {\n  id(): number;\n  number?(): number;\n  createdAt?(): Date;\n  contentType?(): string;\n  attribute?(name: string): unknown;\n}\n\ninterface PostStreamComponent {\n  stream?: {\n    discussion?: {\n      id(): number;\n    };\n  };\n  element?: HTMLElement;\n  __threadifyDomObserver?: MutationObserver;\n}\n\nconst BIG = 10_000_000;\n\nlet redrawScheduled = false;\nfunction scheduleRedraw(): void {\n  if (redrawScheduled) return;\n  redrawScheduled = true;\n  try {\n    requestAnimationFrame(() => {\n      redrawScheduled = false;\n      if (typeof m === 'object' && typeof m.redraw === 'function') m.redraw();\n    });\n  } catch {\n    redrawScheduled = false;\n  }\n}\n\nfunction getDidFromComponent(ps: PostStreamComponent): number | null {\n  try {\n    return ps?.stream?.discussion?.id?.() ?? null;\n  } catch {\n    return null;\n  }\n}\n\nfunction getContainer(ps: PostStreamComponent): HTMLElement | null {\n  if (ps?.element?.classList?.contains('PostStream')) return ps.element;\n  return ps?.element?.querySelector?.('.PostStream') || document.querySelector('.PostStream') || null;\n}\n\nfunction isPostItem(el: Element): el is HTMLElement {\n  return el?.nodeType === 1 && el.matches('.PostStream-item[data-id]');\n}\n\nfunction findPostsRange(container: HTMLElement | null): { posts: HTMLElement[]; anchor: HTMLElement | null } {\n  const kids = Array.from(container?.children || []) as HTMLElement[];\n  if (!kids.length) return { posts: [], anchor: null };\n  let L = kids.findIndex(isPostItem);\n  if (L < 0) return { posts: [], anchor: kids[0] || null };\n  let R = kids.length - 1 - [...kids].reverse().findIndex(isPostItem);\n  if (R < L) R = L;\n  const posts = kids.slice(L, R + 1).filter(isPostItem);\n  const anchor = kids[R + 1] || null;\n  return { posts, anchor };\n}\n\nfunction sameOrder(a: HTMLElement[], b: HTMLElement[]): boolean {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i++) if (a[i] !== b[i]) return false;\n  return true;\n}\n\nfunction getModel(id: number): PostModel | null {\n  try {\n    return app.store.getById('posts', String(id)) as PostModel | null;\n  } catch {\n    return null;\n  }\n}\n\nfunction getNumber(model: PostModel | null): number | null {\n  try {\n    const n = model?.number?.();\n    return Number.isFinite(n) ? n! : null;\n  } catch {\n    return null;\n  }\n}\n\nfunction getCreatedTs(model: PostModel | null): number | null {\n  try {\n    const d = model?.createdAt?.();\n    return d instanceof Date ? +d : null;\n  } catch {\n    return null;\n  }\n}\n\nfunction getContentType(model: PostModel | null): string | null {\n  try {\n    if (!model) return null;\n    if (typeof model.contentType === 'function') return model.contentType();\n    if (typeof model.attribute === 'function') return (model.attribute('contentType') as string) ?? null;\n  } catch {\n    // ignore\n  }\n  return null;\n}\n\nfunction isEventPostByEl(el: HTMLElement, model: PostModel | null): boolean {\n  const ct = getContentType(model);\n  if (ct && ct !== 'comment') return true;\n  if (el?.classList?.contains('EventPost') || el?.classList?.contains('Post-event')) return true;\n  if (el?.querySelector?.('.EventPost, .Post-event, .EventPost-icon')) return true;\n  return false;\n}\n\nfunction orderKey(orderRec: OrderRecord | undefined, model: PostModel | null, id: number): number {\n  if (orderRec && Number.isFinite(orderRec.order)) return Number(orderRec.order);\n  const n = getNumber(model);\n  if (n != null) return n;\n  const t = getCreatedTs(model);\n  if (t != null) return BIG / 2 + t;\n  return BIG + Number(id);\n}\n\nfunction linearKey(model: PostModel | null, id: number): number {\n  const t = getCreatedTs(model);\n  if (t != null) return t;\n  const n = getNumber(model);\n  if (n != null) return BIG / 2 + n;\n  return BIG + Number(id);\n}\n\ninterface EligibilityResult {\n  eligible: Set<number>;\n  events: Set<number>;\n  models: Map<number, PostModel | null>;\n  parentOf: Map<number, number | null>;\n  present: Set<number>;\n}\n\nfunction computeEligibility(posts: HTMLElement[], orderMap: Map<number, OrderRecord>): EligibilityResult {\n  const present = new Set(posts.map((el) => Number(el.dataset.id)));\n  const models = new Map<number, PostModel | null>(\n    posts.map((el) => [Number(el.dataset.id), getModel(Number(el.dataset.id))])\n  );\n\n  const parentOf = new Map<number, number | null>();\n  for (const el of posts) {\n    const id = Number(el.dataset.id);\n    const rec = orderMap.get(id);\n    const m = models.get(id);\n    const pid = rec ? rec.parentId : (m?.attribute?.('parent_id') as number | null);\n    parentOf.set(id, pid == null ? null : Number(pid));\n  }\n\n  const events = new Set<number>();\n  for (const el of posts) {\n    const id = Number(el.dataset.id);\n    if (isEventPostByEl(el, models.get(id)!)) events.add(id);\n  }\n\n  const eligible = new Set<number>();\n  for (const el of posts) {\n    const id = Number(el.dataset.id);\n    if (events.has(id)) continue;\n    if (parentOf.get(id) == null) eligible.add(id);\n  }\n\n  let changed = true;\n  while (changed) {\n    changed = false;\n    for (const el of posts) {\n      const id = Number(el.dataset.id);\n      if (eligible.has(id) || events.has(id)) continue;\n      const pid = parentOf.get(id);\n      if (pid == null) continue;\n      if (!present.has(pid)) continue;\n      if (!eligible.has(pid)) continue;\n      eligible.add(id);\n      changed = true;\n    }\n  }\n\n  return { eligible, events, models, parentOf, present };\n}\n\nfunction buildBaseTarget(\n  posts: HTMLElement[],\n  eligible: Set<number>,\n  events: Set<number>,\n  orderMap: Map<number, OrderRecord>,\n  models: Map<number, PostModel | null>\n): HTMLElement[] {\n  const eligList = posts.filter((el) => eligible.has(Number(el.dataset.id)));\n  const sortedElig = eligList.slice().sort((a, b) => {\n    const ida = Number(a.dataset.id);\n    const idb = Number(b.dataset.id);\n    const ka = orderKey(orderMap.get(ida), models.get(ida)!, ida);\n    const kb = orderKey(orderMap.get(idb), models.get(idb)!, idb);\n    return ka === kb ? ida - idb : ka - kb;\n  });\n\n  const base: HTMLElement[] = [];\n  let j = 0;\n  for (const el of posts) {\n    const id = Number(el.dataset.id);\n    base.push(eligible.has(id) ? sortedElig[j++] : el);\n  }\n\n  const withoutEvents = base.filter((el) => !events.has(Number(el.dataset.id)));\n  const evtList = posts\n    .filter((el) => events.has(Number(el.dataset.id)))\n    .sort((a, b) => {\n      const ida = Number(a.dataset.id);\n      const idb = Number(b.dataset.id);\n      const ka = linearKey(models.get(ida)!, ida);\n      const kb = linearKey(models.get(idb)!, idb);\n      return ka === kb ? ida - idb : ka - kb;\n    });\n\n  const out = withoutEvents.slice();\n  const commentKey = (el: HTMLElement) => linearKey(models.get(Number(el.dataset.id))!, Number(el.dataset.id));\n\n  for (const evEl of evtList) {\n    const eid = Number(evEl.dataset.id);\n    const ek = linearKey(models.get(eid)!, eid);\n    let insertAt = -1;\n    for (let i = 0; i < out.length; i++) {\n      if (commentKey(out[i]) > ek) {\n        insertAt = i;\n        break;\n      }\n    }\n    if (insertAt === -1) out.push(evEl);\n    else out.splice(insertAt, 0, evEl);\n  }\n\n  return out;\n}\n\nfunction applyLockedCohesion(\n  sequence: HTMLElement[],\n  eligible: Set<number>,\n  events: Set<number>,\n  models: Map<number, PostModel | null>,\n  parentOf: Map<number, number | null>\n): HTMLElement[] {\n  const presentIds = sequence.map((el) => Number(el.dataset.id));\n  const present = new Set(presentIds);\n  const locked = new Set(presentIds.filter((id) => !events.has(id) && !eligible.has(id)));\n  if (!locked.size) return sequence;\n\n  function nearestVisibleLockedAncestor(id: number): number | null {\n    let cur = id;\n    for (let g = 0; g < 100; g++) {\n      const pid = parentOf.get(cur);\n      if (pid == null) return null;\n      if (!present.has(pid)) return null;\n      if (locked.has(pid)) return pid;\n      cur = pid;\n    }\n    return null;\n  }\n\n  const groups = new Map<number, Set<number>>();\n  for (const id of locked) {\n    const root = nearestVisibleLockedAncestor(id);\n    if (root == null || root === id) continue;\n    if (!groups.has(root)) groups.set(root, new Set());\n    groups.get(root)!.add(id);\n  }\n  if (!groups.size) return sequence;\n\n  const out = sequence.slice();\n  const indexOfId = new Map(out.map((el, idx) => [Number(el.dataset.id), idx]));\n  const sortedRoots = Array.from(groups.keys()).sort((a, b) => indexOfId.get(a)! - indexOfId.get(b)!);\n\n  function extractMembers(ids: number[]): HTMLElement[] {\n    const set = new Set(ids);\n    const picked: HTMLElement[] = [];\n    for (let i = 0; i < out.length; i++) {\n      const id = Number(out[i].dataset.id);\n      if (set.has(id)) {\n        picked.push(out[i]);\n        out.splice(i, 1);\n        i--;\n      }\n    }\n    return picked;\n  }\n\n  for (const rootId of sortedRoots) {\n    const rootIdx = out.findIndex((el) => Number(el.dataset.id) === rootId);\n    if (rootIdx < 0) continue;\n\n    const memberIds = Array.from(groups.get(rootId)!).sort((a, b) => {\n      const ka = linearKey(models.get(a)!, a);\n      const kb = linearKey(models.get(b)!, b);\n      return ka === kb ? a - b : ka - kb;\n    });\n    const membersEls = extractMembers(memberIds);\n    out.splice(rootIdx + 1, 0, ...membersEls);\n  }\n\n  return out;\n}\n\nfunction ensureDepthClassesForWindow(container: HTMLElement, orderMap: Map<number, OrderRecord>): boolean {\n  const posts = Array.from(container.querySelectorAll('.PostStream-item[data-id]')) as HTMLElement[];\n  if (!posts.length) return false;\n\n  const models = new Map<number, PostModel | null>(\n    posts.map((el) => [Number(el.dataset.id), getModel(Number(el.dataset.id))])\n  );\n\n  const MAX_DEPTH = 10;\n\n  function applyDepthClasses(itemEl: HTMLElement, depth: number, isEvent: boolean): boolean {\n    const postEl = (itemEl.querySelector('.Post') as HTMLElement) || itemEl;\n    const toRemove: string[] = [];\n    postEl.classList.forEach((c) => {\n      if (/^(thread-(root|ed-post|depth-\\d+|deep|very-deep))$/.test(c)) toRemove.push(c);\n    });\n    toRemove.forEach((c) => postEl.classList.remove(c));\n\n    if (isEvent) {\n      postEl.classList.add('thread-root');\n      return true;\n    }\n\n    if (depth > 0) {\n      postEl.classList.add('threaded-post', `thread-depth-${Math.min(depth, MAX_DEPTH)}`);\n      if (depth >= 3) postEl.classList.add('thread-deep');\n      if (depth >= 5) postEl.classList.add('thread-very-deep');\n    } else {\n      postEl.classList.add('thread-root');\n    }\n    return true;\n  }\n\n  let changed = false;\n  for (const item of posts) {\n    const id = Number(item.dataset.id);\n    const m = models.get(id);\n    const event = isEventPostByEl(item, m!);\n    const depth = event ? 0 : getThreadDepth(m as any);\n    changed = applyDepthClasses(item, depth, event) || changed;\n  }\n  return changed;\n}\n\nasync function reorderOnce(container: HTMLElement, did: number): Promise<void> {\n  const orderMap = (await waitOrderMap(did)) || new Map();\n  const { posts } = findPostsRange(container);\n  if (!posts.length) return;\n\n  const { eligible, events, models, parentOf } = computeEligibility(posts, orderMap);\n  const base = buildBaseTarget(posts, eligible, events, orderMap, models);\n  const target = applyLockedCohesion(base, eligible, events, models, parentOf);\n\n  const domOrderChanged = !sameOrder(posts, target);\n\n  if (domOrderChanged) {\n    const latest = findPostsRange(container);\n    const anchor = latest.anchor?.parentNode === container ? latest.anchor : null;\n    try {\n      for (const el of target) {\n        if (anchor && anchor.parentNode === container) container.insertBefore(el, anchor);\n        else container.appendChild(el);\n      }\n    } catch (e) {\n      console.warn('[Threadify] reorder failed (will retry)', e);\n    }\n  }\n\n  const classesChanged = ensureDepthClassesForWindow(container, orderMap);\n\n  if (domOrderChanged || classesChanged) {\n    scheduleRedraw();\n  }\n}\n\nexport function installDomReorderMode(): void {\n  extend(PostStream.prototype, 'oncreate', function (this: PostStreamComponent) {\n    const did = getDidFromComponent(this);\n    const container = getContainer(this);\n    if (!did || !container) return;\n\n    reorderOnce(container, did);\n\n    let isReordering = false;\n    let coalesceTimer: ReturnType<typeof setTimeout> | null = null;\n    let repairTimer: ReturnType<typeof setInterval> | null = null;\n\n    const observer = new MutationObserver((muts) => {\n      const added = muts\n        .filter((m) => m.type === 'childList')\n        .flatMap((m) => Array.from(m.addedNodes || []))\n        .filter((n): n is HTMLElement => n?.nodeType === 1 && (n as Element).matches?.('.PostStream-item[data-id]'));\n\n      if (added.length) {\n        if (isReordering) return;\n        if (coalesceTimer) clearTimeout(coalesceTimer);\n        coalesceTimer = setTimeout(async () => {\n          isReordering = true;\n          try {\n            const map = (await waitOrderMap(did)) || new Map();\n            const missing = added.some((el) => !map.has(Number(el.dataset.id)));\n            if (missing) {\n              invalidateThreadOrder(did);\n              await prefetchThreadOrder(did, { force: true });\n            }\n            await reorderOnce(container, did);\n          } catch (e) {\n            console.warn('[Threadify] realtime reorder failed', e);\n          } finally {\n            isReordering = false;\n          }\n        }, 16);\n        return;\n      }\n\n      const hydrationHit = muts.some((m) => {\n        if (m.type !== 'attributes') return false;\n        const el = m.target as Element;\n        if (!el?.matches?.('.PostStream-item')) return false;\n        if (m.attributeName === 'data-id') return !!el.getAttribute('data-id');\n        if (m.attributeName === 'class') {\n          const prev = m.oldValue || '';\n          const now = el.className || '';\n          return /PostStream-item/.test(now) && /Post--saving/.test(prev) && !/Post--saving/.test(now);\n        }\n        return false;\n      });\n\n      if (hydrationHit) {\n        if (isReordering) return;\n        if (coalesceTimer) clearTimeout(coalesceTimer);\n        coalesceTimer = setTimeout(async () => {\n          isReordering = true;\n          try {\n            invalidateThreadOrder(did);\n            await prefetchThreadOrder(did, { force: true });\n            await reorderOnce(container, did);\n\n            let tries = 0;\n            if (repairTimer) clearInterval(repairTimer);\n            repairTimer = setInterval(async () => {\n              tries++;\n              const map = (await waitOrderMap(did)) || new Map();\n              const changed = ensureDepthClassesForWindow(container, map);\n              if (changed || tries >= 10) {\n                if (repairTimer) clearInterval(repairTimer);\n                scheduleRedraw();\n              }\n            }, 150);\n          } catch (e) {\n            console.warn('[Threadify] hydration reorder failed', e);\n          } finally {\n            isReordering = false;\n          }\n        }, 16);\n        return;\n      }\n    });\n\n    observer.observe(container, {\n      childList: true,\n      attributes: true,\n      attributeOldValue: true,\n      attributeFilter: ['data-id', 'class'],\n      subtree: true,\n    });\n\n    this.__threadifyDomObserver = observer;\n  });\n\n  extend(PostStream.prototype, 'onremove', function (this: PostStreamComponent) {\n    if (this.__threadifyDomObserver) {\n      try {\n        this.__threadifyDomObserver.disconnect();\n      } catch {\n        // ignore\n      }\n      this.__threadifyDomObserver = undefined;\n    }\n  });\n\n  try {\n    window.addEventListener('threadify:order-ready', () => scheduleRedraw());\n  } catch {\n    // ignore\n  }\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\n\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\nimport Post from 'flarum/forum/components/Post';\n\nimport { initThreadedReplyComposer } from './components/ThreadedReplyComposer';\nimport { installDomReorderMode } from './utils/DomReorderMode';\nimport { prefetchThreadOrder, getDepthPrefetched } from './utils/ThreadOrderPrefetch';\n\ninterface PostAttrs {\n  className?: string;\n}\n\ninterface PostComponent {\n  attrs: {\n    post?: {\n      id(): number;\n      discussion(): { id(): number } | null;\n    };\n  };\n}\n\ninterface DiscussionPageComponent {\n  discussion?: {\n    id(): number;\n  } | {\n    id: number;\n  };\n}\n\ninterface DiscussionListItemComponent {\n  attrs: {\n    discussion?: {\n      id(): number;\n    };\n  };\n  element?: HTMLElement;\n}\n\napp.initializers.add('syntaxoutlaw-threadify', () => {\n  initThreadedReplyComposer();\n\n  extend(Post.prototype, 'elementAttrs', function (this: PostComponent, attrs: PostAttrs) {\n    const post = this.attrs.post;\n    if (!post) return;\n\n    const discussion = post.discussion?.();\n    const did = discussion?.id?.() ?? null;\n    if (!did) return;\n\n    const depth = getDepthPrefetched(did, post.id());\n\n    if (Number.isInteger(depth) && depth! > 0) {\n      const safeDepth = Math.min(depth!, 10);\n      const classes = ['threaded-post', `thread-depth-${safeDepth}`];\n      if (safeDepth >= 3) classes.push('thread-deep');\n      if (safeDepth >= 5) classes.push('thread-very-deep');\n\n      attrs.className = (attrs.className || '') + ' ' + classes.join(' ');\n    }\n  });\n\n  installDomReorderMode();\n\n  extend(DiscussionPage.prototype, 'oninit', function (this: DiscussionPageComponent) {\n    const did =\n      (this.discussion && typeof (this.discussion as any).id === 'function' && (this.discussion as any).id()) ||\n      (this.discussion && (this.discussion as any).id) ||\n      null;\n    if (did) prefetchThreadOrder(did);\n  });\n\n  extend(DiscussionListItem.prototype, 'oncreate', function (this: DiscussionListItemComponent) {\n    const discussion = this.attrs.discussion;\n    if (!discussion) return;\n    const did = discussion.id();\n    const handler = () => prefetchThreadOrder(did);\n    if (this.element) {\n      this.element.addEventListener('mouseenter', handler, { once: true });\n      this.element.addEventListener('touchstart', handler, { once: true, passive: true });\n    }\n  });\n});\n","import { extend } from 'flarum/common/extend';\nimport ReplyComposer from 'flarum/forum/components/ReplyComposer';\n\ninterface ReplyData {\n  content?: string;\n  parent_id?: number;\n}\n\ninterface ThreadingContext {\n  primaryParentId: number | null;\n  allMentionedPostIds: number[];\n  hasMentions: boolean;\n  mentionCount: number;\n  isThreadedReply: boolean;\n}\n\nexport function initThreadedReplyComposer(): void {\n  extend(ReplyComposer.prototype, 'data', function (data: ReplyData) {\n    const parentId = extractParentIdFromContent(data.content);\n\n    if (parentId) {\n      data.parent_id = parentId;\n    }\n\n    return data;\n  });\n}\n\nexport function extractParentIdFromContent(content: string | undefined): number | null {\n  if (!content || typeof content !== 'string') {\n    return null;\n  }\n\n  const postMentionMatch = content.match(/@\"[^\"]*\"#p(\\d+)/);\n\n  if (postMentionMatch?.[1]) {\n    const parentId = parseInt(postMentionMatch[1], 10);\n\n    if (!isNaN(parentId) && parentId > 0) {\n      return parentId;\n    }\n  }\n\n  return null;\n}\n\nexport function extractAllMentionedPostIds(content: string | undefined): number[] {\n  if (!content || typeof content !== 'string') {\n    return [];\n  }\n\n  const postMentionRegex = /@\"[^\"]*\"#p(\\d+)/g;\n  const matches: number[] = [];\n  let match: RegExpExecArray | null;\n\n  while ((match = postMentionRegex.exec(content)) !== null) {\n    const postId = parseInt(match[1], 10);\n    if (!isNaN(postId) && postId > 0) {\n      matches.push(postId);\n    }\n  }\n\n  return matches;\n}\n\nexport function hasPostMentions(content: string | undefined): boolean {\n  return extractParentIdFromContent(content) !== null;\n}\n\nexport function getThreadingContext(content: string | undefined): ThreadingContext {\n  const primaryParentId = extractParentIdFromContent(content);\n  const allMentionedIds = extractAllMentionedPostIds(content);\n\n  return {\n    primaryParentId,\n    allMentionedPostIds: allMentionedIds,\n    hasMentions: allMentionedIds.length > 0,\n    mentionCount: allMentionedIds.length,\n    isThreadedReply: primaryParentId !== null,\n  };\n}\n\nexport function cleanThreadingData(data: ReplyData): ReplyData {\n  const cleanedData = { ...data };\n\n  if (cleanedData.parent_id !== undefined) {\n    const parentId = Number(cleanedData.parent_id);\n    if (!isNaN(parentId) && parentId > 0) {\n      cleanedData.parent_id = parentId;\n    } else {\n      delete cleanedData.parent_id;\n    }\n  }\n\n  return cleanedData;\n}\n"],"names":["OverloadYield","require","regenerator","regeneratorAsync","regeneratorAsyncGen","regeneratorAsyncIterator","regeneratorKeys","regeneratorValues","_regeneratorRuntime","r","e","m","t","Object","getPrototypeOf","__proto__","constructor","n","displayName","name","o","a","stop","v","abrupt","delegateYield","resultName","d","finish","f","_t","p","prev","next","sent","call","this","module","exports","wrap","w","reverse","isGeneratorFunction","mark","awrap","AsyncIterator","async","u","keys","values","__esModule","regeneratorDefine","_regenerator","Symbol","iterator","toStringTag","i","c","prototype","Generator","create","y","G","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","setPrototypeOf","k","resolve","then","asyncIterator","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","Promise","_regeneratorDefine","defineProperty","_invoke","enumerable","configurable","writable","_typeof","isNaN","unshift","pop","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","definition","key","get","obj","prop","hasOwnProperty","flarum","core","compat","asyncGeneratorStep","_asyncToGenerator","arguments","apply","_next","_throw","cache","Map","coerceDid","discussionId","Number","isFinite","String","prefetchThreadOrder","opts","did","now","Date","entry","map","inflight","ts","set","force","bust","app","method","url","attribute","res","_step","_iterator","_createForOfIteratorHelperLoose","order","_step$value","postId","depth","parentPostId","parentId","window","dispatchEvent","CustomEvent","detail","_unused","console","warn","getDepthPrefetched","getCachedOrderMap","rec","waitOrderMap","_x","_waitOrderMap","_callee","_context","size","invalidateThreadOrder","clampDepth","x","Math","max","min","getThreadDepth","post","id","_discussion$id","discussion","isInteger","guard","seen","Set","current","pid","has","add","parent","getById","walkDepthByParentChain","BIG","redrawScheduled","scheduleRedraw","requestAnimationFrame","redraw","isPostItem","el","nodeType","matches","findPostsRange","container","kids","Array","from","children","posts","anchor","L","findIndex","R","concat","slice","filter","sameOrder","b","getModel","_unused3","getNumber","model","number","_unused4","getCreatedTs","createdAt","_unused5","isEventPostByEl","_el$classList","_el$classList2","ct","_ref","contentType","_unused6","getContentType","classList","contains","querySelector","orderKey","orderRec","linearKey","computeEligibility","orderMap","present","dataset","models","parentOf","_step2","events","_iterator2","_step3","eligible","_iterator3","changed","_step4","_iterator4","buildBaseTarget","_step5","eligList","sortedElig","sort","ida","idb","ka","kb","base","j","_iterator5","push","_step6","withoutEvents","evtList","out","commentKey","_iterator6","evEl","eid","ek","insertAt","splice","applyLockedCohesion","sequence","presentIds","locked","nearestVisibleLockedAncestor","cur","g","_step7","groups","_iterator7","root","_step8","indexOfId","idx","_loop","rootId","rootIdx","membersEls","ids","picked","extractMembers","_iterator8","ensureDepthClassesForWindow","querySelectorAll","applyDepthClasses","itemEl","isEvent","postEl","toRemove","forEach","test","remove","_i","_posts","item","event","reorderOnce","_x2","_reorderOnce","_callee4","_findPostsRange","_computeEligibility","target","domOrderChanged","_latest$anchor","latest","_iterator9","_step9","classesChanged","_t5","_context4","parentNode","insertBefore","appendChild","extend","ReplyComposer","data","content","postMentionMatch","match","parseInt","extractParentIdFromContent","parent_id","Post","attrs","safeDepth","classes","className","join","PostStream","ps","_ps$element","_ps$element2","_ps$stream$discussion","_ps$stream","stream","_unused2","getDidFromComponent","element","document","isReordering","coalesceTimer","repairTimer","observer","MutationObserver","muts","added","type","flatMap","addedNodes","clearTimeout","setTimeout","_t2","some","attributeName","getAttribute","oldValue","_callee3","tries","_t4","_context3","clearInterval","setInterval","_callee2","_context2","observe","childList","attributes","attributeOldValue","attributeFilter","subtree","__threadifyDomObserver","disconnect","_unused7","addEventListener","_unused8","installDomReorderMode","DiscussionPage","DiscussionListItem","handler","once","passive"],"ignoreList":[],"sourceRoot":""}
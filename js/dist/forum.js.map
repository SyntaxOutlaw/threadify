{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorRuntime.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regenerator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/OverloadYield.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsyncIterator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/regenerator/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsyncGen.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorDefine.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/typeof.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorValues.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorKeys.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/regeneratorAsync.js","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/bootstrap","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/compat get default export","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/define property getters","webpack://@syntaxoutlaw/flarum-ext-threadify/webpack/runtime/hasOwnProperty shorthand","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/app']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['common/extend']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/DiscussionPage']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/DiscussionListItem']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/Post']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadsApi.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/ReplyComposer']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js","webpack://@syntaxoutlaw/flarum-ext-threadify/external root \"flarum.core.compat['forum/components/PostStream']\"","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadTree.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadDepth.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/PostLoader.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/ThreadOrderPrefetch.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/components/ThreadedPostStream.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/index.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/components/ThreadedPost.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/utils/SimplifiedThreadDepth.js","webpack://@syntaxoutlaw/flarum-ext-threadify/./src/forum/components/ThreadedReplyComposer.js"],"sourcesContent":["var OverloadYield = require(\"./OverloadYield.js\");\nvar regenerator = require(\"./regenerator.js\");\nvar regeneratorAsync = require(\"./regeneratorAsync.js\");\nvar regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nvar regeneratorKeys = require(\"./regeneratorKeys.js\");\nvar regeneratorValues = require(\"./regeneratorValues.js\");\nfunction _regeneratorRuntime() {\n  \"use strict\";\n\n  var r = regenerator(),\n    e = r.m(_regeneratorRuntime),\n    t = (Object.getPrototypeOf ? Object.getPrototypeOf(e) : e.__proto__).constructor;\n  function n(r) {\n    var e = \"function\" == typeof r && r.constructor;\n    return !!e && (e === t || \"GeneratorFunction\" === (e.displayName || e.name));\n  }\n  var o = {\n    \"throw\": 1,\n    \"return\": 2,\n    \"break\": 3,\n    \"continue\": 3\n  };\n  function a(r) {\n    var e, t;\n    return function (n) {\n      e || (e = {\n        stop: function stop() {\n          return t(n.a, 2);\n        },\n        \"catch\": function _catch() {\n          return n.v;\n        },\n        abrupt: function abrupt(r, e) {\n          return t(n.a, o[r], e);\n        },\n        delegateYield: function delegateYield(r, o, a) {\n          return e.resultName = o, t(n.d, regeneratorValues(r), a);\n        },\n        finish: function finish(r) {\n          return t(n.f, r);\n        }\n      }, t = function t(r, _t, o) {\n        n.p = e.prev, n.n = e.next;\n        try {\n          return r(_t, o);\n        } finally {\n          e.next = n.n;\n        }\n      }), e.resultName && (e[e.resultName] = n.v, e.resultName = void 0), e.sent = n.v, e.next = n.n;\n      try {\n        return r.call(this, e);\n      } finally {\n        n.p = e.prev, n.n = e.next;\n      }\n    };\n  }\n  return (module.exports = _regeneratorRuntime = function _regeneratorRuntime() {\n    return {\n      wrap: function wrap(e, t, n, o) {\n        return r.w(a(e), t, n, o && o.reverse());\n      },\n      isGeneratorFunction: n,\n      mark: r.m,\n      awrap: function awrap(r, e) {\n        return new OverloadYield(r, e);\n      },\n      AsyncIterator: regeneratorAsyncIterator,\n      async: function async(r, e, t, o, u) {\n        return (n(e) ? regeneratorAsyncGen : regeneratorAsync)(a(r), e, t, o, u);\n      },\n      keys: regeneratorKeys,\n      values: regeneratorValues\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regeneratorRuntime, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction _regenerator() {\n  /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */\n  var e,\n    t,\n    r = \"function\" == typeof Symbol ? Symbol : {},\n    n = r.iterator || \"@@iterator\",\n    o = r.toStringTag || \"@@toStringTag\";\n  function i(r, n, o, i) {\n    var c = n && n.prototype instanceof Generator ? n : Generator,\n      u = Object.create(c.prototype);\n    return regeneratorDefine(u, \"_invoke\", function (r, n, o) {\n      var i,\n        c,\n        u,\n        f = 0,\n        p = o || [],\n        y = !1,\n        G = {\n          p: 0,\n          n: 0,\n          v: e,\n          a: d,\n          f: d.bind(e, 4),\n          d: function d(t, r) {\n            return i = t, c = 0, u = e, G.n = r, a;\n          }\n        };\n      function d(r, n) {\n        for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) {\n          var o,\n            i = p[t],\n            d = G.p,\n            l = i[2];\n          r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0));\n        }\n        if (o || r > 1) return a;\n        throw y = !0, n;\n      }\n      return function (o, p, l) {\n        if (f > 1) throw TypeError(\"Generator is already running\");\n        for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) {\n          i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u);\n          try {\n            if (f = 2, i) {\n              if (c || (o = \"next\"), t = i[o]) {\n                if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\");\n                if (!t.done) return t;\n                u = t.value, c < 2 && (c = 0);\n              } else 1 === c && (t = i[\"return\"]) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1);\n              i = e;\n            } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break;\n          } catch (t) {\n            i = e, c = 1, u = t;\n          } finally {\n            f = 1;\n          }\n        }\n        return {\n          value: t,\n          done: y\n        };\n      };\n    }(r, o, i), !0), u;\n  }\n  var a = {};\n  function Generator() {}\n  function GeneratorFunction() {}\n  function GeneratorFunctionPrototype() {}\n  t = Object.getPrototypeOf;\n  var c = [][n] ? t(t([][n]())) : (regeneratorDefine(t = {}, n, function () {\n      return this;\n    }), t),\n    u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c);\n  function f(e) {\n    return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, regeneratorDefine(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e;\n  }\n  return GeneratorFunction.prototype = GeneratorFunctionPrototype, regeneratorDefine(u, \"constructor\", GeneratorFunctionPrototype), regeneratorDefine(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", regeneratorDefine(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), regeneratorDefine(u), regeneratorDefine(u, o, \"Generator\"), regeneratorDefine(u, n, function () {\n    return this;\n  }), regeneratorDefine(u, \"toString\", function () {\n    return \"[object Generator]\";\n  }), (module.exports = _regenerator = function _regenerator() {\n    return {\n      w: i,\n      m: f\n    };\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports)();\n}\nmodule.exports = _regenerator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _OverloadYield(e, d) {\n  this.v = e, this.k = d;\n}\nmodule.exports = _OverloadYield, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var OverloadYield = require(\"./OverloadYield.js\");\nvar regeneratorDefine = require(\"./regeneratorDefine.js\");\nfunction AsyncIterator(t, e) {\n  function n(r, o, i, f) {\n    try {\n      var c = t[r](o),\n        u = c.value;\n      return u instanceof OverloadYield ? e.resolve(u.v).then(function (t) {\n        n(\"next\", t, i, f);\n      }, function (t) {\n        n(\"throw\", t, i, f);\n      }) : e.resolve(u).then(function (t) {\n        c.value = t, i(c);\n      }, function (t) {\n        return n(\"throw\", t, i, f);\n      });\n    } catch (t) {\n      f(t);\n    }\n  }\n  var r;\n  this.next || (regeneratorDefine(AsyncIterator.prototype), regeneratorDefine(AsyncIterator.prototype, \"function\" == typeof Symbol && Symbol.asyncIterator || \"@asyncIterator\", function () {\n    return this;\n  })), regeneratorDefine(this, \"_invoke\", function (t, o, i) {\n    function f() {\n      return new e(function (e, r) {\n        n(t, i, e, r);\n      });\n    }\n    return r = r ? r.then(f, f) : f();\n  }, !0);\n}\nmodule.exports = AsyncIterator, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// TODO(Babel 8): Remove this file.\n\nvar runtime = require(\"../helpers/regeneratorRuntime\")();\nmodule.exports = runtime;\n\n// Copied from https://github.com/facebook/regenerator/blob/main/packages/runtime/runtime.js#L736=\ntry {\n  regeneratorRuntime = runtime;\n} catch (accidentalStrictMode) {\n  if (typeof globalThis === \"object\") {\n    globalThis.regeneratorRuntime = runtime;\n  } else {\n    Function(\"r\", \"regeneratorRuntime = r\")(runtime);\n  }\n}\n","var regenerator = require(\"./regenerator.js\");\nvar regeneratorAsyncIterator = require(\"./regeneratorAsyncIterator.js\");\nfunction _regeneratorAsyncGen(r, e, t, o, n) {\n  return new regeneratorAsyncIterator(regenerator().w(r, e, t, o), n || Promise);\n}\nmodule.exports = _regeneratorAsyncGen, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorDefine(e, r, n, t) {\n  var i = Object.defineProperty;\n  try {\n    i({}, \"\", {});\n  } catch (e) {\n    i = 0;\n  }\n  module.exports = _regeneratorDefine = function regeneratorDefine(e, r, n, t) {\n    function o(r, n) {\n      _regeneratorDefine(e, r, function (e) {\n        return this._invoke(r, n, e);\n      });\n    }\n    r ? i ? i(e, r, {\n      value: n,\n      enumerable: !t,\n      configurable: !t,\n      writable: !t\n    }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2));\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _regeneratorDefine(e, r, n, t);\n}\nmodule.exports = _regeneratorDefine, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _typeof(o) {\n  \"@babel/helpers - typeof\";\n\n  return module.exports = _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) {\n    return typeof o;\n  } : function (o) {\n    return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o;\n  }, module.exports.__esModule = true, module.exports[\"default\"] = module.exports, _typeof(o);\n}\nmodule.exports = _typeof, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var _typeof = require(\"./typeof.js\")[\"default\"];\nfunction _regeneratorValues(e) {\n  if (null != e) {\n    var t = e[\"function\" == typeof Symbol && Symbol.iterator || \"@@iterator\"],\n      r = 0;\n    if (t) return t.call(e);\n    if (\"function\" == typeof e.next) return e;\n    if (!isNaN(e.length)) return {\n      next: function next() {\n        return e && r >= e.length && (e = void 0), {\n          value: e && e[r++],\n          done: !e\n        };\n      }\n    };\n  }\n  throw new TypeError(_typeof(e) + \" is not iterable\");\n}\nmodule.exports = _regeneratorValues, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","function _regeneratorKeys(e) {\n  var n = Object(e),\n    r = [];\n  for (var t in n) r.unshift(t);\n  return function e() {\n    for (; r.length;) if ((t = r.pop()) in n) return e.value = t, e.done = !1, e;\n    return e.done = !0, e;\n  };\n}\nmodule.exports = _regeneratorKeys, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","var regeneratorAsyncGen = require(\"./regeneratorAsyncGen.js\");\nfunction _regeneratorAsync(n, e, r, t, o) {\n  var a = regeneratorAsyncGen(n, e, r, t, o);\n  return a.next().then(function (n) {\n    return n.done ? n.value : a.next();\n  });\n}\nmodule.exports = _regeneratorAsync, module.exports.__esModule = true, module.exports[\"default\"] = module.exports;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/DiscussionListItem'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Post'];","/**\n * Threads API Utilities\n * \n * Simple API interface for loading threaded post data from the new\n * threadify_threads table. This replaces the complex dynamic threading\n * logic with efficient pre-computed thread structures.\n * \n * @author Threadify Extension\n */\n\n/**\n * Load all threads for a discussion\n * \n * Makes a single API call to get complete thread structure with all\n * posts in proper threaded order. No complex post loading or tree\n * building needed on the frontend.\n * \n * @param {number} discussionId - The discussion ID to load threads for\n * @returns {Promise<Object[]>} - Promise resolving to array of thread objects\n */\nexport function loadDiscussionThreads(discussionId) {\n  console.log(`[Threadify] Loading threads for discussion ${discussionId}`);\n  \n  // Use Flarum's request method to call our custom API endpoint\n  return app.request({\n    method: 'GET',\n    url: app.forum.attribute('apiUrl') + '/discussions/' + discussionId + '/threads'\n  }).then(response => {\n    console.log(`[Threadify] Loaded ${response.data.length} thread entries`);\n    \n    // Process included data first to populate the store\n    if (response.included) {\n      console.log(`[Threadify] Processing ${response.included.length} included items`);\n      response.included.forEach(item => {\n        console.log(`[Threadify] Including ${item.type}:${item.id}`);\n        app.store.pushObject(item);\n      });\n    }\n    \n    // Convert thread data to posts with threading metadata\n    const threadedPosts = response.data.map(threadData => {\n      // Find the post in Flarum's store\n      const postId = threadData.attributes.postId;\n      let post = app.store.getById('posts', postId);\n      \n      if (post) {\n        // Debug: Check if post has user relationship\n        console.log(`[Threadify] Post ${postId} found, user:`, post.user ? post.user() : 'NO USER');\n        \n        // Add threading metadata to the post\n        post._threadDepth = threadData.attributes.depth;\n        post._threadPath = threadData.attributes.threadPath;\n        post._isRoot = threadData.attributes.isRoot;\n        post._childCount = threadData.attributes.childCount;\n        post._descendantCount = threadData.attributes.descendantCount;\n        post._rootPostId = threadData.attributes.rootPostId;\n        post._parentPostId = threadData.attributes.parentPostId;\n        \n        console.log(`[Threadify] Post ${postId} depth: ${post._threadDepth}, path: ${post._threadPath}`);\n      } else {\n        console.warn(`[Threadify] Post ${postId} not found in store`);\n      }\n      \n      return post;\n    }).filter(post => post !== null); // Filter out any null posts\n    \n    console.log(`[Threadify] Processed ${threadedPosts.length} threaded posts`);\n    \n    return threadedPosts;\n  }).catch(error => {\n    console.error('[Threadify] Failed to load discussion threads:', error);\n    \n    // Fallback: return empty array - existing PostStream will handle this gracefully\n    return [];\n  });\n}\n\n/**\n * Check if threads API is available for a discussion\n * \n * @param {Discussion} discussion - The discussion to check\n * @returns {boolean} - True if threads API should be used\n */\nexport function shouldUseThreadsApi(discussion) {\n  // For now, always try to use the threads API\n  // In the future, this could be configurable or based on discussion settings\n  return true;\n}\n\n/**\n * Get thread metadata for a post\n * \n * Extracts threading information that was added by loadDiscussionThreads\n * \n * @param {Post} post - The post to get metadata for\n * @returns {Object|null} - Thread metadata or null if not available\n */\nexport function getPostThreadMetadata(post) {\n  if (!post || typeof post._threadDepth === 'undefined') {\n    return null;\n  }\n  \n  return {\n    depth: post._threadDepth,\n    threadPath: post._threadPath,\n    isRoot: post._isRoot,\n    childCount: post._childCount,\n    descendantCount: post._descendantCount,\n    rootPostId: post._rootPostId\n  };\n}\n\n/**\n * Check if a post has threading metadata\n * \n * @param {Post} post - The post to check\n * @returns {boolean} - True if post has threading metadata\n */\nexport function hasThreadMetadata(post) {\n  return post && typeof post._threadDepth !== 'undefined';\n} ","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/ReplyComposer'];","function asyncGeneratorStep(n, t, e, r, o, a, c) {\n  try {\n    var i = n[a](c),\n      u = i.value;\n  } catch (n) {\n    return void e(n);\n  }\n  i.done ? t(u) : Promise.resolve(u).then(r, o);\n}\nfunction _asyncToGenerator(n) {\n  return function () {\n    var t = this,\n      e = arguments;\n    return new Promise(function (r, o) {\n      var a = n.apply(t, e);\n      function _next(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n);\n      }\n      function _throw(n) {\n        asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n);\n      }\n      _next(void 0);\n    });\n  };\n}\nexport { _asyncToGenerator as default };","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/PostStream'];","/**\n * Thread Tree Utilities\n * \n * Handles building and flattening thread tree structures from Flarum posts.\n * This module is responsible for:\n * - Building hierarchical thread structures from flat post arrays\n * - Flattening thread trees back to linear arrays in threaded order\n * - Maintaining parent-child relationships between posts\n * \n * @author Threadify Extension\n */\n\n/**\n * Build a threaded tree structure from posts\n * \n * Takes a flat array of posts and organizes them into a hierarchical tree\n * structure based on their parent_id attributes. Posts without a parent_id\n * become root posts, while posts with parent_id become children of their\n * respective parents.\n * \n * @param {Post[]} posts - All posts in the discussion\n * @returns {Post[]} - Array of root posts with _threadChildren attached\n */\nexport function buildThreadTree(posts) {\n  const tree = [];\n  const postMap = new Map();\n  const childrenMap = new Map();\n  \n  // First pass: create post map and initialize children arrays\n  posts.forEach(post => {\n    if (!post) return;\n    \n    const postId = post.id();\n    postMap.set(postId, post);\n    childrenMap.set(postId, []);\n  });\n  \n  // Second pass: organize posts by parent-child relationships\n  posts.forEach(post => {\n    if (!post) return;\n    \n    const postId = post.id();\n    const parentId = post.attribute('parent_id');\n    \n    if (parentId && postMap.has(String(parentId))) {\n      // This post has a parent, add it to parent's children\n      childrenMap.get(String(parentId)).push(post);\n    } else {\n      // This is a root post (no parent or parent not found)\n      tree.push(post);\n    }\n  });\n  \n  // Third pass: attach children to posts for easy access\n  posts.forEach(post => {\n    if (!post) return;\n    post._threadChildren = childrenMap.get(post.id()) || [];\n  });\n  \n  return tree;\n}\n\n/**\n * Flatten thread tree back to linear array in threaded order\n * \n * Takes a hierarchical tree of posts and flattens it back to a linear array\n * while maintaining the threaded order (parent followed by all its children\n * recursively). This preserves the threading visual structure when posts\n * are rendered linearly.\n * \n * @param {Post[]} rootPosts - Root posts with their children attached via _threadChildren\n * @returns {Post[]} - Flattened array in threaded order\n */\nexport function flattenThreadTree(rootPosts) {\n  const result = [];\n  \n  /**\n   * Recursively add a post and all its children to the result array\n   * @param {Post} post - The post to add\n   * @param {number} depth - Current nesting depth (for potential future use)\n   */\n  function addPostAndChildren(post, depth = 0) {\n    if (!post) return;\n    \n    result.push(post);\n    \n    // Get children and sort them chronologically within each thread level\n    const children = post._threadChildren || [];\n    children.sort((a, b) => {\n      const timeA = a.createdAt ? a.createdAt().getTime() : 0;\n      const timeB = b.createdAt ? b.createdAt().getTime() : 0;\n      return timeA - timeB;\n    });\n    \n    // Recursively add all children\n    children.forEach(child => {\n      addPostAndChildren(child, depth + 1);\n    });\n  }\n  \n  // Sort root posts chronologically to maintain discussion flow\n  rootPosts.sort((a, b) => {\n    const timeA = a.createdAt ? a.createdAt().getTime() : 0;\n    const timeB = b.createdAt ? b.createdAt().getTime() : 0;\n    return timeA - timeB;\n  });\n  \n  // Add each root post and its entire thread branch\n  rootPosts.forEach(rootPost => {\n    addPostAndChildren(rootPost);\n  });\n  \n  return result;\n}\n\n/**\n * Create a threaded post array from flat posts\n * \n * Convenience function that combines buildThreadTree and flattenThreadTree\n * to convert a flat array of posts directly into threaded order.\n * \n * @param {Post[]} posts - Flat array of posts\n * @returns {Post[]} - Posts reordered in threaded structure\n */\nexport function createThreadedPosts(posts) {\n  const threadTree = buildThreadTree(posts);\n  return flattenThreadTree(threadTree);\n} ","/**\n * Thread Depth Calculator\n * \n * Handles calculating and caching thread depth for posts.\n * Thread depth determines how many levels deep a post is in a thread\n * (0 = root post, 1 = direct reply, 2 = reply to reply, etc.)\n * \n * Uses caching to avoid expensive recalculations and includes cycle detection\n * to prevent infinite loops in case of malformed parent relationships.\n * \n * @author Threadify Extension\n */\n\n// Cache for thread depth calculations to avoid recalculating\nconst threadDepthCache = new Map();\n\n// Maximum allowed thread depth to prevent excessive UI indentation\nconst MAX_THREAD_DEPTH = 10;\n\n/**\n * Calculate the thread depth of a post\n * \n * Determines how many levels deep a post is in the thread hierarchy.\n * Uses caching for performance and includes cycle detection for safety.\n * \n * @param {Post} post - The post to calculate depth for\n * @param {Post[]} allPosts - All posts in the discussion (for parent lookup)\n * @returns {number} - The depth (0 = root, 1 = direct reply, etc.)\n */\nexport function calculateThreadDepth(post, allPosts) {\n  const postId = post.id();\n  \n  // Check cache first for performance\n  if (threadDepthCache.has(postId)) {\n    return threadDepthCache.get(postId);\n  }\n  \n  // If no parent_id, this is a root post (depth 0)\n  const parentId = post.attribute('parent_id');\n  if (!parentId) {\n    threadDepthCache.set(postId, 0);\n    return 0;\n  }\n  \n  // Find the parent post\n  const parentPost = allPosts.find(p => p && p.id() == parentId);\n  if (!parentPost) {\n    // Parent not found, treat as root\n    threadDepthCache.set(postId, 0);\n    return 0;\n  }\n  \n  // Cycle detection: if we're calculating depth for a post that's already\n  // in our calculation chain, we have a cycle\n  const visited = new Set();\n  const depth = calculateDepthRecursive(post, allPosts, visited);\n  \n  // Cache and return the calculated depth\n  threadDepthCache.set(postId, depth);\n  return depth;\n}\n\n/**\n * Recursive helper for depth calculation with cycle detection\n * @param {Post} post - Current post\n * @param {Post[]} allPosts - All posts for parent lookup\n * @param {Set} visited - Set of visited post IDs to detect cycles\n * @returns {number} - Calculated depth\n */\nfunction calculateDepthRecursive(post, allPosts, visited) {\n  const postId = post.id();\n  \n  // Cycle detection\n  if (visited.has(postId)) {\n    console.warn(`[Threadify] Cycle detected for post ${postId}`);\n    return 0; // Treat cyclic posts as root to break the cycle\n  }\n  \n  // Check cache\n  if (threadDepthCache.has(postId)) {\n    return threadDepthCache.get(postId);\n  }\n  \n  // If no parent, this is root level\n  const parentId = post.attribute('parent_id');\n  if (!parentId) {\n    return 0;\n  }\n  \n  // Find parent post\n  const parentPost = allPosts.find(p => p && p.id() == parentId);\n  if (!parentPost) {\n    return 0; // Parent not found, treat as root\n  }\n  \n  // Add current post to visited set\n  visited.add(postId);\n  \n  // Recursively calculate parent's depth\n  const parentDepth = calculateDepthRecursive(parentPost, allPosts, visited);\n  const depth = parentDepth + 1;\n  \n  // Remove from visited set (backtrack)\n  visited.delete(postId);\n  \n  // Apply maximum depth limit to prevent excessive UI indentation\n  return Math.min(depth, MAX_THREAD_DEPTH);\n}\n\n/**\n * Clear the thread depth cache\n * \n * Should be called when posts are updated, removed, or when switching discussions\n * to ensure fresh calculations.\n */\nexport function clearThreadDepthCache() {\n  threadDepthCache.clear();\n}\n\n/**\n * Get CSS classes for a post based on its thread depth\n * \n * Generates appropriate CSS classes for styling threaded posts.\n * \n * @param {Post} post - The post to generate classes for\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {string[]} - Array of CSS classes\n */\nexport function getThreadCssClasses(post, allPosts) {\n  const threadDepth = calculateThreadDepth(post, allPosts);\n  const classes = [];\n  \n  if (threadDepth > 0) {\n    classes.push('Post--threaded');\n    classes.push(`Post--thread-depth-${threadDepth}`);\n  }\n  \n  return classes;\n}\n\n/**\n * Check if a post is a root post (no parent)\n * @param {Post} post - The post to check\n * @returns {boolean} - True if the post is a root post\n */\nexport function isRootPost(post) {\n  return !post.attribute('parent_id');\n}\n\n/**\n * Check if a post is a direct reply (depth 1)\n * @param {Post} post - The post to check\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {boolean} - True if the post is a direct reply\n */\nexport function isDirectReply(post, allPosts) {\n  return calculateThreadDepth(post, allPosts) === 1;\n} ","/**\n * Post Loader Utilities (fixed for Flarum 1.8)\n *\n * \n * 1)  ID number/string \n * 2)  postStream.discussion  postStream.stream.discussion\n * 3)  mergeUniquePostsById \n */\n\nimport app from 'flarum/forum/app';\n\n/** -------------------- Helpers -------------------- **/\n\nfunction toStrId(x) {\n  return x == null ? '' : String(x);\n}\n\nfunction getDiscussionFrom(postStream) {\n  // \n  return postStream?.discussion || postStream?.stream?.discussion || null;\n}\n\nfunction mergeUniquePostsById(basePosts, extraPosts) {\n  const map = new Map();\n  basePosts.filter(Boolean).forEach((p) => map.set(toStrId(p.id()), p));\n  extraPosts.filter(Boolean).forEach((p) => map.set(toStrId(p.id()), p));\n  return Array.from(map.values());\n}\n\nfunction loadPostsByIds(postIds) {\n  const ids = (postIds || []).map(toStrId).filter(Boolean);\n  if (ids.length === 0) return Promise.resolve([]);\n\n  return app.store.find('posts', {\n    filter: { id: ids.join(',') },\n    // page: { limit: ids.length } // \n  });\n}\n\n/** -------------------- Public APIs -------------------- **/\n\n/**\n * \n * -  currentPosts parent_id \n * - \n */\nexport function loadMissingParentPosts(postStream, currentPosts) {\n  const posts = (currentPosts || []).filter(Boolean);\n  const currentIdSet = new Set(posts.map((p) => toStrId(p.id())));\n  const missingParentIds = [];\n\n  posts.forEach((p) => {\n    const pid = toStrId(p?.attribute?.('parent_id'));\n    if (pid && !currentIdSet.has(pid)) missingParentIds.push(pid);\n  });\n\n  const uniqueMissing = Array.from(new Set(missingParentIds));\n  if (uniqueMissing.length === 0) {\n    return Promise.resolve(posts);\n  }\n\n  return loadPostsByIds(uniqueMissing)\n    .then((loadedParents) => {\n      const merged = mergeUniquePostsById(posts, loadedParents);\n      // \n      return loadMissingParentPosts(postStream, merged);\n    })\n    .catch((err) => {\n      console.warn('[Threadify] Failed to load parent posts:', err);\n      // \n      return posts;\n    });\n}\n\n/**\n * \n * -  postId  5~10\n * -  parent_id \n * - \n */\nexport function loadMinimalChildren(postStream, currentPosts) {\n  const discussion = getDiscussionFrom(postStream);\n  const posts = (currentPosts || []).filter(Boolean);\n  const currentIdSet = new Set(posts.map((p) => toStrId(p.id())));\n\n  if (!discussion || typeof discussion.postIds !== 'function') {\n    return Promise.resolve(posts);\n  }\n\n  const discussionPostIds = (discussion.postIds() || []).map(toStrId);\n  const unloadedIds = discussionPostIds.filter((id) => id && !currentIdSet.has(id));\n\n  if (unloadedIds.length === 0) {\n    return Promise.resolve(posts);\n  }\n\n  const sampleSize = Math.min(10, unloadedIds.length); // \n  const recentUnloaded = unloadedIds.slice(-sampleSize);\n\n  return loadPostsByIds(recentUnloaded)\n    .then((loadedSample) => {\n      // \n      const actualChildren = (loadedSample || []).filter((p) => {\n        const pid = toStrId(p?.attribute?.('parent_id'));\n        return pid && currentIdSet.has(pid);\n      });\n\n      if (actualChildren.length === 0) {\n        return posts;\n      }\n      return mergeUniquePostsById(posts, actualChildren);\n    })\n    .catch((err) => {\n      console.warn('[Threadify] Failed to load child posts:', err);\n      return posts;\n    });\n}\n\n/**\n * \n * - \n */\nexport function needsThreadContext(posts) {\n  const arr = (posts || []).filter(Boolean);\n  if (arr.length === 0) return false;\n\n  const idSet = new Set(arr.map((p) => toStrId(p.id())));\n  return arr.some((p) => {\n    const pid = toStrId(p?.attribute?.('parent_id'));\n    return pid && !idSet.has(pid);\n  });\n}\n","// js/src/forum/utils/ThreadOrderPrefetch.js\n/**\n * /discussions/:id/threads-order\n * \n *  - prefetchThreadOrder(did) -> Promise<void>\n *  - getOrderIndex(did, postId) -> number|undefined\n *  - getDepthPrefetched(did, postId) / getParentPrefetched(did, postId)\n *  - isPrefetched(did) -> boolean\n *\n * \n *  - window.dispatchEvent(new CustomEvent('threadify:orderReady', { detail:Number(did) }))\n *  -  ready\n */\n\nimport app from 'flarum/forum/app';\n\nconst _cache = new Map(); // did -> { map: Map<postId, {order, depth, parentId}>, ready: Promise|true }\n\nexport function prefetchThreadOrder(discussionId) {\n  const did = String(discussionId);\n  const existing = _cache.get(did);\n  if (existing?.ready === true) return Promise.resolve();\n  if (existing?.ready && typeof existing.ready.then === 'function') return existing.ready;\n\n  const entry = { map: new Map(), ready: null };\n  _cache.set(did, entry);\n\n  entry.ready = app\n    .request({\n      method: 'GET',\n      url: `${app.forum.attribute('apiUrl')}/discussions/${encodeURIComponent(did)}/threads-order`,\n    })\n    .then((res) => {\n      const map = new Map();\n      const list = Array.isArray(res?.order) ? res.order : [];\n      for (const item of list) {\n        if (!item) continue;\n        const pid = Number(item.postId);\n        const ord = Number(item.order);\n        const dep = Number(item.depth);\n        const parent = item.parentPostId != null ? Number(item.parentPostId) : null;\n        if (!Number.isNaN(pid) && !Number.isNaN(ord)) {\n          map.set(pid, {\n            order: ord,\n            depth: Number.isNaN(dep) ? 0 : dep,\n            parentId: parent,\n          });\n        }\n      }\n      entry.map = map;\n      entry.ready = true;\n\n      //  PostStream \n      try { window.dispatchEvent(new CustomEvent('threadify:orderReady', { detail: Number(did) })); } catch {}\n\n      //  anchorScroll \n      try { setTimeout(() => m.redraw(), 0); } catch {}\n    })\n    .catch((e) => {\n      console.warn('[Threadify] order prefetch failed:', e);\n      entry.ready = true; // \n    });\n\n  return entry.ready;\n}\n\nexport function getOrderIndex(discussionId, postId) {\n  const entry = _cache.get(String(discussionId));\n  if (!entry?.map) return undefined;\n  const rec = entry.map.get(Number(postId));\n  return rec ? rec.order : undefined;\n}\n\nexport function getDepthPrefetched(discussionId, postId) {\n  const entry = _cache.get(String(discussionId));\n  if (!entry?.map) return undefined;\n  const rec = entry.map.get(Number(postId));\n  return rec ? rec.depth : undefined;\n}\n\nexport function getParentPrefetched(discussionId, postId) {\n  const entry = _cache.get(String(discussionId));\n  if (!entry?.map) return undefined;\n  const rec = entry.map.get(Number(postId));\n  return rec ? rec.parentId : undefined;\n}\n\nexport function isPrefetched(discussionId) {\n  const entry = _cache.get(String(discussionId));\n  return !!(entry && entry.ready === true);\n}\n","// js/src/forum/components/ThreadedPostStream.js\n/**\n * Threaded PostStream + \n *\n * -  visiblePosts/ this.stream.posts() \n * -  null \n * -  order >  orderMap > \n * -  PostStream  orderMap\n * -  20 \n */\n\nimport app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\nimport PostStream from 'flarum/forum/components/PostStream';\n\nimport { createThreadedPosts } from '../utils/ThreadTree';\nimport { clearThreadDepthCache } from '../utils/ThreadDepth';\nimport { loadMissingParentPosts } from '../utils/PostLoader';\nimport {\n  getOrderIndex,\n  prefetchThreadOrder,\n  getParentPrefetched,\n} from '../utils/ThreadOrderPrefetch';\n\n// ----  ----------------------------------------------------\nlet currentDiscussionId = null;\nlet originalPostsMethod = null;\nlet building = false;\nlet orderMap = null;          // Map<postId, order>\nlet lastLoadedIdsSig = '';    // \nlet cacheSig = '';            //  posts() \nlet cachedReturn = null;\n\n//  / \nfunction streamBusy(state) {\n  if (!state) return false;\n  return !!(\n    state.loading ||\n    state.loadingPrevious ||\n    state.loadingNext ||\n    state.loadingNear ||\n    state._loadingPrevious ||\n    state._loadingNext\n  );\n}\n\n//  id\nfunction getDid(ps) {\n  const stream = ps && ps.stream;\n  const disc = stream && stream.discussion;\n  return disc && disc.id && disc.id();\n}\n\n//  2s\nfunction waitForIdle(postStream, fn, tries = 40) {\n  const state = postStream && postStream.stream;\n  if (!state) return fn();\n  if (!streamBusy(state)) {\n    try { return requestAnimationFrame(() => fn()); } catch (e) { return setTimeout(fn, 0); }\n  }\n  if (tries <= 0) return;\n  setTimeout(() => waitForIdle(postStream, fn, tries - 1), 50);\n}\n\n// \nfunction idsSignature(arr) {\n  return (arr || [])\n    .map((x) => (x && typeof x.id === 'function' ? String(x.id()) : '#'))\n    .join(',');\n}\n\n// ----------  +  ----------\nfunction sortPostsOnly(did, postsOnly) {\n  const list = postsOnly.slice();\n  list.sort((a, b) => {\n    const aid = a.id();\n    const bid = b.id();\n\n    const ao = getOrderIndex(did, aid);\n    const bo = getOrderIndex(did, bid);\n    if (ao != null || bo != null) {\n      if (ao == null) return 1;\n      if (bo == null) return -1;\n      if (ao !== bo) return ao - bo;\n    }\n\n    const toA = orderMap && orderMap.get && orderMap.get(aid);\n    const toB = orderMap && orderMap.get && orderMap.get(bid);\n    if (toA != null || toB != null) {\n      if (toA == null) return 1;\n      if (toB == null) return -1;\n      if (toA !== toB) return toA - toB;\n    }\n\n    return 0;\n  });\n  return list;\n}\n\n// ----------  null  ----------\nfunction mergeBackIntoPostCapableSlots(originalArray, orderedPostsOnly) {\n  const out = new Array(originalArray.length);\n  let idx = 0;\n  for (let i = 0; i < originalArray.length; i++) {\n    const item = originalArray[i];\n    const isPost = !!(item && typeof item.id === 'function');\n    const isPostCapable = isPost || item == null; //  Post  null\n    out[i] = isPostCapable ? (idx < orderedPostsOnly.length ? orderedPostsOnly[idx++] : null) : item;\n  }\n  return out;\n}\n\n// ----------  ----------\nasync function ensurePrefetchedChildren(postStream, did, posts) {\n  const discussion = postStream?.stream?.discussion;\n  if (!discussion || typeof discussion.postIds !== 'function') return posts;\n\n  const idSet = new Set(posts.filter(Boolean).map((p) => String(p.id())));\n  const allIds = (discussion.postIds() || []).map((x) => String(x));\n  const missing = [];\n\n  //  20 \n  for (let i = 0; i < allIds.length && missing.length < 20; i++) {\n    const id = allIds[i];\n    if (!id || idSet.has(id)) continue;\n    const parent = getParentPrefetched(did, Number(id));\n    if (parent != null && idSet.has(String(parent))) {\n      missing.push(id);\n    }\n  }\n\n  if (missing.length === 0) return posts;\n\n  try {\n    const loaded = await app.store.find('posts', { filter: { id: missing.join(',') } });\n    // \n    const map = new Map();\n    posts.filter(Boolean).forEach((p) => map.set(String(p.id()), p));\n    (loaded || []).filter(Boolean).forEach((p) => map.set(String(p.id()), p));\n    return Array.from(map.values());\n  } catch (e) {\n    console.warn('[Threadify] ensurePrefetchedChildren failed', e);\n    return posts;\n  }\n}\n\n// ---------- / ----------\nfunction buildOrderMap(postStream) {\n  if (building) return;\n  building = true;\n\n  const finish = (map) => {\n    orderMap = map || null;\n    building = false;\n    try { m.redraw(); } catch (e) {}\n  };\n\n  (async () => {\n    try {\n      const original = originalPostsMethod ? (originalPostsMethod.call(postStream.stream) || []) : [];\n      const posts = original.filter((x) => x && typeof x.id === 'function');\n      if (posts.length === 0) return finish(null);\n\n      const ctx = postStream.discussion ? postStream : { discussion: postStream.stream.discussion };\n      const did = getDid(postStream);\n\n      // \n      let ready = await loadMissingParentPosts(ctx, posts).catch(() => posts);\n      ready = await ensurePrefetchedChildren(postStream, did, ready).catch(() => ready);\n\n      const threaded = createThreadedPosts(ready);\n      const map = new Map();\n      let i = 0;\n      threaded.forEach((p) => { if (p && typeof p.id === 'function') map.set(p.id(), i++); });\n      finish(map);\n    } catch (e) {\n      console.error('[Threadify] buildOrderMap failed:', e);\n      finish(null);\n    }\n  })();\n}\n\n// ===================================================================\n//  stream.posts()\n// ===================================================================\nexport function initThreadedPostStream() {\n  extend(PostStream.prototype, 'oninit', function () {\n    const did = getDid(this);\n    if (currentDiscussionId !== did) resetState(did);\n\n    if (!originalPostsMethod) originalPostsMethod = this.stream.posts;\n\n    // \n    if (did) prefetchThreadOrder(did);\n\n    //   \n    this._threadifyOrderHandler = (ev) => {\n      const readyDid = ev && ev.detail;\n      if (String(did) !== String(readyDid)) return;\n      waitForIdle(this, () => buildOrderMap(this));\n    };\n    try { window.addEventListener('threadify:orderReady', this._threadifyOrderHandler); } catch (e) {}\n\n    // \n    waitForIdle(this, () => buildOrderMap(this));\n\n    //   null   //\n    this.stream.posts = () => {\n      const original = originalPostsMethod ? (originalPostsMethod.call(this.stream) || []) : [];\n\n      // \n      if (streamBusy(this.stream)) {\n        return original;\n      }\n\n      const did2 = getDid(this);\n      if (!did2 || original.length <= 1) {\n        return original;\n      }\n\n      // \n      const postsOnly = original.filter((x) => x && typeof x.id === 'function');\n      if (postsOnly.length <= 1) {\n        return original;\n      }\n\n      //  + orderMap.size + did \n      const sig =\n        idsSignature(original) +\n        '|' +\n        (orderMap ? orderMap.size : 0) +\n        '|' +\n        String(did2);\n      if (sig === cacheSig && cachedReturn) {\n        return cachedReturn;\n      }\n\n      const ordered = sortPostsOnly(did2, postsOnly);\n      const merged = mergeBackIntoPostCapableSlots(original, ordered);\n\n      cacheSig = sig;\n      cachedReturn = merged;\n      return merged;\n    };\n  });\n\n  //   \n  extend(PostStream.prototype, 'onupdate', function () {\n    const cur = originalPostsMethod ? (originalPostsMethod.call(this.stream) || []) : [];\n    const sig = idsSignature(cur);\n    if (sig !== lastLoadedIdsSig) {\n      lastLoadedIdsSig = sig;\n      cacheSig = '';\n      cachedReturn = null;\n      clearThreadDepthCache();\n      waitForIdle(this, () => buildOrderMap(this));\n    }\n  });\n\n  // \n  extend(PostStream.prototype, 'onremove', function () {\n    try {\n      if (this._threadifyOrderHandler) {\n        window.removeEventListener('threadify:orderReady', this._threadifyOrderHandler);\n        this._threadifyOrderHandler = null;\n      }\n    } catch (e) {}\n  });\n}\n\n// ----  ----------------------------------------------\nexport function isThreadingActive() { return !!orderMap; }\nexport function getThreadingStats() {\n  return { hasOrderMap: !!orderMap, building, discussionId: currentDiscussionId };\n}\n\nfunction resetState(discussionId) {\n  currentDiscussionId = discussionId || null;\n  originalPostsMethod = null;\n  orderMap = null;\n  building = false;\n  lastLoadedIdsSig = '';\n  cacheSig = '';\n  cachedReturn = null;\n  clearThreadDepthCache();\n}\n","import app from 'flarum/forum/app';\nimport { extend } from 'flarum/common/extend';\n\nimport DiscussionPage from 'flarum/forum/components/DiscussionPage';\nimport DiscussionListItem from 'flarum/forum/components/DiscussionListItem';\n\nimport { initThreadedPost } from './components/ThreadedPost';\nimport { initThreadedReplyComposer } from './components/ThreadedReplyComposer';\nimport { initThreadedPostStream } from './components/ThreadedPostStream';\nimport { prefetchThreadOrder } from './utils/ThreadOrderPrefetch';\n\napp.initializers.add('syntaxoutlaw-threadify', () => {\n  initThreadedPost();\n  initThreadedReplyComposer();\n  initThreadedPostStream();\n\n  // \n  extend(DiscussionPage.prototype, 'oninit', function () {\n    const did = this.discussion && this.discussion.id && this.discussion.id();\n    if (did) prefetchThreadOrder(did);\n  });\n\n  //  / \n  extend(DiscussionListItem.prototype, 'oncreate', function () {\n    const discussion = this.attrs.discussion;\n    if (!discussion) return;\n    const did = discussion.id();\n    const handler = () => prefetchThreadOrder(did);\n    // \n    this.element && this.element.addEventListener('mouseenter', handler, { once: true });\n    this.element && this.element.addEventListener('touchstart', handler, { once: true, passive: true });\n  });\n});\n","/**\n * Threaded Post Component Extensions\n * \n * Handles Post component extensions for threading functionality.\n * This module is responsible for:\n * - Adding threading CSS classes to posts based on their depth\n * - Managing post-specific threading visual elements\n * - Integrating with the ThreadDepth utility for depth calculations\n * \n * @author Threadify Extension\n */\n\nimport { extend } from 'flarum/common/extend';\nimport Post from 'flarum/forum/components/Post';\nimport { getThreadCssClasses } from '../utils/SimplifiedThreadDepth';\n\n/**\n * Initialize Post component extensions for threading\n * \n * Sets up all the necessary hooks and extensions for the Post component\n * to display threading information properly.\n */\nexport function initThreadedPost() {\n  // Hook into Post component to add threading CSS classes\n  extend(Post.prototype, 'classes', function(classes) {\n    const post = this.attrs.post;\n    \n    // Skip processing if we don't have a valid post\n    if (!post) {\n      console.warn('[Threadify] No post in ThreadedPost.classes');\n      return classes;\n    }\n    \n    // Get threading CSS classes from simplified utility\n    const threadClasses = getThreadCssClasses(post);\n    console.log(`[Threadify] Adding classes to post ${post.id()}: ${threadClasses.join(', ')}`);\n    \n    threadClasses.forEach(className => {\n      classes.push(className);\n    });\n    \n    return classes;\n  });\n}\n\n/**\n * Get thread metadata for a post\n * \n * Extracts useful threading metadata from a post that can be used\n * by other components or for debugging purposes.\n * \n * @param {Post} post - The post to extract metadata from\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {Object} - Thread metadata object\n */\nexport function getPostThreadMetadata(post, allPosts) {\n  if (!post) return null;\n  \n  const parentId = post.attribute('parent_id');\n  const parentPost = parentId ? allPosts.find(p => p && p.id() == parentId) : null;\n  \n  // Find direct children of this post\n  const children = allPosts.filter(p => \n    p && p.attribute('parent_id') == post.id()\n  );\n  \n  // Calculate some thread statistics\n  const descendants = getDescendantCount(post, allPosts);\n  \n  return {\n    postId: post.id(),\n    parentId: parentId,\n    hasParent: !!parentPost,\n    parentPost: parentPost,\n    directChildren: children,\n    childrenCount: children.length,\n    descendantCount: descendants,\n    isRootPost: !parentId,\n    threadClasses: getThreadCssClasses(post, allPosts)\n  };\n}\n\n/**\n * Count all descendants (children, grandchildren, etc.) of a post\n * \n * @param {Post} post - The post to count descendants for\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {number} - Total number of descendants\n */\nfunction getDescendantCount(post, allPosts) {\n  const directChildren = allPosts.filter(p => \n    p && p.attribute('parent_id') == post.id()\n  );\n  \n  let count = directChildren.length;\n  \n  // Recursively count descendants of each child\n  directChildren.forEach(child => {\n    count += getDescendantCount(child, allPosts);\n  });\n  \n  return count;\n}\n\n/**\n * Check if a post is part of a specific thread branch\n * \n * Determines if a post is either a descendant or ancestor of another post.\n * Useful for highlighting related posts or collapsing thread branches.\n * \n * @param {Post} post1 - First post\n * @param {Post} post2 - Second post  \n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {boolean} - True if posts are in the same thread branch\n */\nexport function arePostsInSameBranch(post1, post2, allPosts) {\n  if (!post1 || !post2 || post1.id() === post2.id()) {\n    return false;\n  }\n  \n  // Check if post1 is an ancestor of post2\n  let currentPost = post2;\n  while (currentPost) {\n    const parentId = currentPost.attribute('parent_id');\n    if (!parentId) break;\n    \n    if (parentId == post1.id()) {\n      return true; // post1 is an ancestor of post2\n    }\n    \n    currentPost = allPosts.find(p => p && p.id() == parentId);\n  }\n  \n  // Check if post2 is an ancestor of post1\n  currentPost = post1;\n  while (currentPost) {\n    const parentId = currentPost.attribute('parent_id');\n    if (!parentId) break;\n    \n    if (parentId == post2.id()) {\n      return true; // post2 is an ancestor of post1\n    }\n    \n    currentPost = allPosts.find(p => p && p.id() == parentId);\n  }\n  \n  return false;\n}\n\n/**\n * Get the root post of a thread branch\n * \n * Traces back through parent relationships to find the root post\n * of the thread branch that contains the given post.\n * \n * @param {Post} post - The post to find the root for\n * @param {Post[]} allPosts - All posts in the discussion\n * @returns {Post|null} - The root post of the thread branch\n */\nexport function getThreadRoot(post, allPosts) {\n  if (!post) return null;\n  \n  let currentPost = post;\n  let rootPost = post;\n  \n  // Trace back through parents until we find a post with no parent\n  while (currentPost) {\n    const parentId = currentPost.attribute('parent_id');\n    if (!parentId) {\n      rootPost = currentPost;\n      break;\n    }\n    \n    const parentPost = allPosts.find(p => p && p.id() == parentId);\n    if (!parentPost) {\n      // Parent not found, current post becomes the effective root\n      rootPost = currentPost;\n      break;\n    }\n    \n    rootPost = parentPost;\n    currentPost = parentPost;\n  }\n  \n  return rootPost;\n} \n","/**\n * Simplified Thread Depth Utilities\n * \n * This replaces the complex ThreadDepth calculation logic with simple\n * utilities that use pre-computed thread depths from the threads API.\n * \n * Benefits:\n * - No expensive depth calculations on frontend\n * - No caching needed - depth is already computed\n * - More reliable since depth is calculated once on backend\n * - Simpler code with fewer edge cases\n * \n * @author Threadify Extension\n */\n\nimport { getPostThreadMetadata } from './ThreadsApi';\n\n// Maximum allowed thread depth for UI display\nconst MAX_DISPLAY_DEPTH = 10;\n\n/**\n * Get thread depth for a post\n * \n * Uses pre-computed depth from threads API metadata instead of calculating.\n * \n * @param {Post} post - The post to get depth for\n * @returns {number} - The thread depth (0 = root, 1 = reply, etc.)\n */\nexport function getThreadDepth(post) {\n  if (!post) {\n    return 0;\n  }\n  \n  // Check if post has threading metadata from threads API\n  const metadata = getPostThreadMetadata(post);\n  if (metadata) {\n    return Math.min(metadata.depth, MAX_DISPLAY_DEPTH);\n  }\n  \n  // Fallback: use old parent_id attribute if available\n  const parentId = post.attribute('parent_id');\n  if (parentId) {\n    // Simple fallback - assume depth 1 for any post with parent\n    // This is not as accurate but prevents complete failure\n    return 1;\n  }\n  \n  // No threading information available, treat as root\n  return 0;\n}\n\n/**\n * Get CSS classes for a post based on its thread depth\n * \n * @param {Post} post - The post to get CSS classes for\n * @returns {string[]} - Array of CSS class names\n */\nexport function getThreadCssClasses(post) {\n  const depth = getThreadDepth(post);\n  const classes = [];\n  \n  if (depth > 0) {\n    classes.push('threaded-post');\n    classes.push(`thread-depth-${depth}`);\n    \n    // Add general depth classes for easier styling\n    if (depth >= 3) {\n      classes.push('thread-deep');\n    }\n    if (depth >= 5) {\n      classes.push('thread-very-deep');\n    }\n  } else {\n    classes.push('thread-root');\n  }\n  \n  // Add metadata-based classes if available\n  const metadata = getPostThreadMetadata(post);\n  if (metadata) {\n    if (metadata.isRoot) {\n      classes.push('thread-root-confirmed');\n    }\n    if (metadata.childCount > 0) {\n      classes.push('has-children');\n      classes.push(`child-count-${Math.min(metadata.childCount, 10)}`);\n    }\n    if (metadata.descendantCount > 0) {\n      classes.push('has-descendants');\n    }\n  }\n  \n  return classes;\n}\n\n/**\n * Check if a post is a root post (no parent)\n * \n * @param {Post} post - The post to check\n * @returns {boolean} - True if post is a root post\n */\nexport function isRootPost(post) {\n  const metadata = getPostThreadMetadata(post);\n  if (metadata) {\n    return metadata.isRoot;\n  }\n  \n  // Fallback: check if post has no parent_id\n  return !post.attribute('parent_id');\n}\n\n/**\n * Get thread root ID for a post\n * \n * @param {Post} post - The post to get root for\n * @returns {string|null} - Root post ID or null if not available\n */\nexport function getThreadRootId(post) {\n  const metadata = getPostThreadMetadata(post);\n  if (metadata) {\n    return metadata.rootPostId;\n  }\n  \n  // Fallback: if no metadata, assume the post itself is root if no parent\n  if (!post.attribute('parent_id')) {\n    return post.id();\n  }\n  \n  return null;\n}\n\n/**\n * Get child count for a post\n * \n * @param {Post} post - The post to get child count for\n * @returns {number} - Number of direct children\n */\nexport function getChildCount(post) {\n  const metadata = getPostThreadMetadata(post);\n  return metadata ? metadata.childCount : 0;\n}\n\n/**\n * Get descendant count for a post\n * \n * @param {Post} post - The post to get descendant count for\n * @returns {number} - Total number of descendants (children + grandchildren + ...)\n */\nexport function getDescendantCount(post) {\n  const metadata = getPostThreadMetadata(post);\n  return metadata ? metadata.descendantCount : 0;\n}\n\n/**\n * Get thread path for a post\n * \n * @param {Post} post - The post to get thread path for\n * @returns {string|null} - Thread path (e.g., \"1/5/12\") or null if not available\n */\nexport function getThreadPath(post) {\n  const metadata = getPostThreadMetadata(post);\n  return metadata ? metadata.threadPath : null;\n} ","/**\n * Threaded Reply Composer Extensions\n * \n * Handles ReplyComposer component extensions for threading functionality.\n * This module is responsible for:\n * - Extracting parent_id from post mentions in reply content\n * - Adding parent_id to the reply data before submission\n * - Integrating with Flarum's mentions extension for seamless threading\n * \n * The threading system works by detecting post mentions in the format:\n * @\"Display Name\"#p123 where 123 is the post ID that becomes the parent_id\n * \n * @author Threadify Extension\n */\n\nimport { extend } from 'flarum/common/extend';\nimport ReplyComposer from 'flarum/forum/components/ReplyComposer';\n\n/**\n * Initialize ReplyComposer component extensions for threading\n * \n * Sets up hooks to automatically detect and add parent_id relationships\n * when users reply to specific posts using the mentions system.\n */\nexport function initThreadedReplyComposer() {\n  // Hook into reply submission to add parent_id\n  extend(ReplyComposer.prototype, 'data', function(data) {\n    const parentId = extractParentIdFromContent(data.content);\n    \n    if (parentId) {\n      // Add parent_id directly to the data object\n      data.parent_id = parentId;\n      console.log('[Threadify] Reply threading to post', parentId);\n    }\n    \n    return data;\n  });\n}\n\n/**\n * Extract parent post ID from reply content\n * \n * Parses the reply content for post mentions from the mentions extension\n * and extracts the post ID to use as parent_id for threading.\n * \n * Supported mention formats:\n * - @\"Display Name\"#p123 (standard post mention)\n * - Multiple mentions (uses the first one found)\n * \n * @param {string} content - The reply content to parse\n * @returns {number|null} - The parent post ID or null if none found\n */\nexport function extractParentIdFromContent(content) {\n  if (!content || typeof content !== 'string') {\n    return null;\n  }\n  \n  // Parse the content for post mentions from the mentions extension\n  // Format: @\"Display Name\"#p123 where 123 is the post ID\n  const postMentionMatch = content.match(/@\"[^\"]*\"#p(\\d+)/);\n  \n  if (postMentionMatch && postMentionMatch[1]) {\n    const parentId = parseInt(postMentionMatch[1], 10);\n    \n    // Validate that it's a valid number\n    if (!isNaN(parentId) && parentId > 0) {\n      return parentId;\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Extract all mentioned post IDs from content\n * \n * Gets all post mentions from the content, not just the first one.\n * Useful for analytics or advanced threading features.\n * \n * @param {string} content - The reply content to parse\n * @returns {number[]} - Array of mentioned post IDs\n */\nexport function extractAllMentionedPostIds(content) {\n  if (!content || typeof content !== 'string') {\n    return [];\n  }\n  \n  const postMentionRegex = /@\"[^\"]*\"#p(\\d+)/g;\n  const matches = [];\n  let match;\n  \n  while ((match = postMentionRegex.exec(content)) !== null) {\n    const postId = parseInt(match[1], 10);\n    if (!isNaN(postId) && postId > 0) {\n      matches.push(postId);\n    }\n  }\n  \n  return matches;\n}\n\n/**\n * Check if content contains post mentions\n * \n * @param {string} content - The content to check\n * @returns {boolean} - True if content contains post mentions\n */\nexport function hasPostMentions(content) {\n  return extractParentIdFromContent(content) !== null;\n}\n\n/**\n * Get threading context from reply content\n * \n * Extracts comprehensive threading information from reply content,\n * including the primary parent and any additional mentioned posts.\n * \n * @param {string} content - The reply content to analyze\n * @returns {Object} - Threading context object\n */\nexport function getThreadingContext(content) {\n  const primaryParentId = extractParentIdFromContent(content);\n  const allMentionedIds = extractAllMentionedPostIds(content);\n  \n  return {\n    primaryParentId: primaryParentId,\n    allMentionedPostIds: allMentionedIds,\n    hasMentions: allMentionedIds.length > 0,\n    mentionCount: allMentionedIds.length,\n    isThreadedReply: primaryParentId !== null\n  };\n}\n\n/**\n * Validate threading data before submission\n * \n * Performs validation on the threading data to ensure it's valid\n * before the reply is submitted to the server.\n * \n * @param {Object} data - The reply data object\n * @returns {Object} - Validation result with isValid boolean and any error messages\n */\nexport function validateThreadingData(data) {\n  const result = {\n    isValid: true,\n    errors: [],\n    warnings: []\n  };\n  \n  // Check if parent_id is present and valid\n  if (data.parent_id !== undefined) {\n    if (typeof data.parent_id !== 'number' || data.parent_id <= 0) {\n      result.isValid = false;\n      result.errors.push('Invalid parent_id: must be a positive number');\n    }\n  }\n  \n  // Check for potential threading issues\n  if (data.content && hasPostMentions(data.content)) {\n    const context = getThreadingContext(data.content);\n    \n    if (!data.parent_id && context.isThreadedReply) {\n      result.warnings.push('Content contains post mentions but no parent_id was set');\n    }\n    \n    if (context.mentionCount > 1) {\n      result.warnings.push(`Multiple post mentions found (${context.mentionCount}), only first will be used for threading`);\n    }\n  }\n  \n  return result;\n}\n\n/**\n * Clean threading data for submission\n * \n * Ensures threading data is properly formatted and cleaned before\n * being sent to the server.\n * \n * @param {Object} data - The reply data object\n * @returns {Object} - Cleaned data object\n */\nexport function cleanThreadingData(data) {\n  const cleanedData = { ...data };\n  \n  // Ensure parent_id is a proper integer or remove it\n  if (cleanedData.parent_id !== undefined) {\n    const parentId = parseInt(cleanedData.parent_id, 10);\n    if (!isNaN(parentId) && parentId > 0) {\n      cleanedData.parent_id = parentId;\n    } else {\n      delete cleanedData.parent_id;\n    }\n  }\n  \n  return cleanedData;\n} "],"names":["OverloadYield","require","regenerator","regeneratorAsync","regeneratorAsyncGen","regeneratorAsyncIterator","regeneratorKeys","regeneratorValues","_regeneratorRuntime","r","e","m","t","Object","getPrototypeOf","__proto__","constructor","n","displayName","name","o","a","stop","v","abrupt","delegateYield","resultName","d","finish","f","_t","p","prev","next","sent","call","this","module","exports","wrap","w","reverse","isGeneratorFunction","mark","awrap","AsyncIterator","async","u","keys","values","__esModule","regeneratorDefine","_regenerator","Symbol","iterator","toStringTag","i","c","prototype","Generator","create","y","G","bind","length","l","TypeError","done","value","GeneratorFunction","GeneratorFunctionPrototype","setPrototypeOf","k","resolve","then","asyncIterator","runtime","regeneratorRuntime","accidentalStrictMode","globalThis","Function","Promise","_regeneratorDefine","defineProperty","_invoke","enumerable","configurable","writable","_typeof","isNaN","unshift","pop","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","__webpack_modules__","getter","definition","key","get","obj","prop","hasOwnProperty","flarum","core","compat","getPostThreadMetadata","post","_threadDepth","depth","threadPath","_threadPath","isRoot","_isRoot","childCount","_childCount","descendantCount","_descendantCount","rootPostId","_rootPostId","asyncGeneratorStep","_asyncToGenerator","arguments","apply","_next","_throw","flattenThreadTree","rootPosts","result","addPostAndChildren","push","children","_threadChildren","sort","b","createdAt","getTime","forEach","child","rootPost","createThreadedPosts","posts","threadTree","tree","postMap","Map","childrenMap","postId","id","set","parentId","attribute","has","String","buildThreadTree","threadDepthCache","clearThreadDepthCache","clear","toStrId","x","loadMissingParentPosts","postStream","currentPosts","filter","Boolean","currentIdSet","Set","map","missingParentIds","pid","postIds","ids","uniqueMissing","Array","from","app","find","join","loadedParents","basePosts","extraPosts","merged","err","console","warn","_cache","prefetchThreadOrder","discussionId","did","existing","ready","entry","method","url","encodeURIComponent","res","_step","_iterator","_createForOfIteratorHelperLoose","isArray","order","item","Number","ord","dep","parent","parentPostId","window","dispatchEvent","CustomEvent","detail","_unused","setTimeout","redraw","_unused2","getOrderIndex","rec","getParentPrefetched","currentDiscussionId","originalPostsMethod","building","orderMap","lastLoadedIdsSig","cacheSig","cachedReturn","streamBusy","state","loading","loadingPrevious","loadingNext","loadingNear","_loadingPrevious","_loadingNext","getDid","ps","stream","disc","discussion","waitForIdle","fn","tries","requestAnimationFrame","idsSignature","arr","ensurePrefetchedChildren","_x","_x2","_x3","_ensurePrefetchedChildren","_callee2","_postStream$stream","idSet","allIds","missing","loaded","_t2","_context2","buildOrderMap","_callee","original","ctx","threaded","_context","error","add","extend","Post","classes","attrs","threadClasses","metadata","Math","min","getThreadDepth","getThreadCssClasses","log","className","ReplyComposer","data","content","postMentionMatch","match","parseInt","extractParentIdFromContent","parent_id","PostStream","_this","_threadifyOrderHandler","ev","readyDid","addEventListener","did2","postsOnly","sig","size","ordered","list","slice","aid","bid","ao","bo","toA","toB","sortPostsOnly","originalArray","orderedPostsOnly","out","idx","isPostCapable","mergeBackIntoPostCapableSlots","_this2","removeEventListener","DiscussionPage","DiscussionListItem","handler","element","once","passive"],"sourceRoot":""}
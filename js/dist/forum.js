/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),i=r(996),u=r(312),a=r(166),s=r(766),c=r(760);function f(){"use strict";var e=o(),r=e.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function d(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===l||"GeneratorFunction"===(e.displayName||e.name))}var p={throw:1,return:2,break:3,continue:3};function h(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,p[t],e)},delegateYield:function(t,o,i){return e.resultName=o,r(n.d,c(t),i)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=f=function(){return{wrap:function(t,r,n,o){return e.w(h(t),r,n,o&&o.reverse())},isGeneratorFunction:d,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:a,async:function(t,e,r,n,o){return(d(e)?u:i)(h(t),e,r,n,o)},keys:s,values:c}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=f,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function s(t,o,i,u){var a=o&&o.prototype instanceof f?o:f,s=Object.create(a.prototype);return n(s,"_invoke",function(t,n,o){var i,u,a,s=0,f=o||[],l=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,u=0,a=e,d.n=r,c}};function p(t,n){for(u=t,a=n,r=0;!l&&s&&!o&&r<f.length;r++){var o,i=f[r],p=d.p,h=i[2];t>3?(o=h===n)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=t<2&&p<i[1])?(u=0,d.v=n,d.n=i[1]):p<h&&(o=t<3||i[0]>n||n>h)&&(i[4]=t,i[5]=n,d.n=h,u=0))}if(o||t>1)return c;throw l=!0,n}return function(o,f,h){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,h),u=f,a=h;(r=u<2?e:a)||!l;){i||(u?u<3?(u>1&&(d.n=-1),p(u,a)):d.n=a:d.v=a);try{if(s=2,i){if(u||(o="next"),r=i[o]){if(!(r=r.call(i,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,u<2&&(u=0)}else 1===u&&(r=i.return)&&r.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((r=(l=d.n<0)?a:t.call(n,d))!==c)break}catch(t){i=e,u=1,a=t}finally{s=1}}return{value:r,done:l}}}(t,i,u),!0),s}var c={};function f(){}function l(){}function d(){}r=Object.getPrototypeOf;var p=[][u]?r(r([][u]())):(n(r={},u,function(){return this}),r),h=d.prototype=f.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,a,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=d,n(h,"constructor",d),n(d,"constructor",l),l.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(h),n(h,a,"Generator"),n(h,u,function(){return this}),n(h,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m:v}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function i(t,o,u,a){try{var s=e[t](o),c=s.value;return c instanceof n?r.resolve(c.v).then(function(t){i("next",t,u,a)},function(t){i("throw",t,u,a)}):r.resolve(c).then(function(t){s.value=t,u(s)},function(t){return i("throw",t,u,a)})}catch(t){a(t)}}var u;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){i(t,n,e,r)})}return u=u?u.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,i,u){return new o(n().w(t,e,r,i),u||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,i){var u=Object.defineProperty;try{u({},"",{})}catch(r){u=0}t.exports=e=function(t,r,n,o){function i(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?u?u(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(i("next",0),i("throw",1),i("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,i){var u=n(t,e,r,o,i);return u.next().then(function(t){return t.done?t.value:u.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var e=r.n(t);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionPage"];var i=r.n(o);const u=flarum.core.compat["forum/components/DiscussionListItem"];var a=r.n(u);const s=flarum.core.compat["forum/components/Post"];var c=r.n(s),f=new Map;function l(t){if(!t)return null;var e=t.discussion&&t.discussion(),r=e&&e.id&&e.id();if(!r)return null;var n=function(t,e){var r=f.get(Number(t));if(r)return r.map.get(Number(e))}(r,t.id());return n?{depth:n.depth,threadPath:null,isRoot:!n.parentId,childCount:0,descendantCount:0,rootPostId:null}:null}var d=new Map;function p(t,e){void 0===e&&(e={});var r=v(t);if(!r)return Promise.resolve();var n=Date.now(),o=d.get(r)||{map:new Map,inflight:null,ts:0};if(d.set(r,o),!e.force&&n-o.ts<1e4)return o.inflight||Promise.resolve();if(o.inflight&&!e.force)return o.inflight;var i=n;return o.inflight=app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/discussions/"+r+"/threads-order?bust="+i}).then(function(t){var e=new Map;(t&&t.order?t.order:[]).forEach(function(t){var r=t.postId,n=t.order,o=t.depth,i=t.parentPostId;r=Number(r),e.set(r,{order:Number(n),depth:Number.isFinite(o)?Number(o):0,parentId:i?Number(i):null})}),o.map=e,o.ts=Date.now();try{window.dispatchEvent(new CustomEvent("threadify:order-ready",{detail:{discussionId:Number(r)}}))}catch(t){}}).catch(function(t){console.warn("[Threadify] order prefetch failed",t)}).finally(function(){o.inflight=null}),o.inflight}function h(t){var e=v(t);if(e){var r=d.get(e);return r?r.map:void 0}}function v(t){if(null==t)return null;var e=Number(t);return Number.isFinite(e)&&e>0?String(e):null}function m(t){var e=Number(t);return Number.isFinite(e)?Math.max(0,Math.min(10,e)):0}function y(t){var e,r,n,o,i=function(t){if(!t||"function"!=typeof t.id)return 0;try{var e=t.discussion&&"function"==typeof t.discussion&&t.discussion()&&t.discussion().id&&t.discussion().id()||null;if(null!=e){var r=(n=e,o=t.id(),(u=(i=h(n))&&i.get(Number(o)))?u.depth:void 0);if(Number.isInteger(r))return m(r)}}catch(t){}var n,o,i,u;try{var a=l(t);if(a&&Number.isInteger(a.depth))return m(a.depth)}catch(t){}return function(t){for(var e=0,r=0,n=new Set,o=t;o&&r<100;){var i=o.attribute?o.attribute("parent_id"):null;if(!i)break;if(n.has(i)){console.warn("[Threadify] cycle detected while walking parents of",t&&t.id&&t.id()),e=0;break}n.add(i),e+=1;var u=app.store.getById("posts",String(i));if(!u)break;if(o=u,r++,e>=10)break}return m(e)}(t)}(t),u=[];i>0?(u.push("threaded-post"),u.push("thread-depth-"+i),i>=3&&u.push("thread-deep"),i>=5&&u.push("thread-very-deep")):u.push("thread-root");try{var a=t.discussion&&"function"==typeof t.discussion&&t.discussion()&&t.discussion().id&&t.discussion().id()||null,s=null!=a?(e=a,r=t.id(),(o=(n=h(e))&&n.get(Number(r)))?o.parentId:void 0):void 0,c=l(t);(null==s?!t.attribute||!t.attribute("parent_id"):null==s)&&u.push("thread-root-confirmed"),c&&Number.isInteger(c.childCount)&&c.childCount>0&&u.push("has-children","child-count-"+Math.min(c.childCount,10)),c&&Number.isInteger(c.descendantCount)&&c.descendantCount>0&&u.push("has-descendants")}catch(t){}return u}const b=flarum.core.compat["forum/components/ReplyComposer"];var x=r.n(b);function g(t,e,r,n,o,i,u){try{var a=t[i](u),s=a.value}catch(t){return void r(t)}a.done?e(s):Promise.resolve(s).then(n,o)}var w=r(183),_=r.n(w);const N=flarum.core.compat["forum/components/PostStream"];var S=r.n(N);function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var I=1e7;function M(t){try{var e,r;return null!=(e=null==t||null==(r=t.stream)||null==(r=r.discussion)||null==r.id?void 0:r.id())?e:null}catch(t){return null}}function P(t){var e;return null!=t&&t.element&&t.element.classList&&t.element.classList.contains("PostStream")?t.element:(null==t||null==(e=t.element)||null==e.querySelector?void 0:e.querySelector(".PostStream"))||document.querySelector(".PostStream")||null}function T(t){return t&&1===t.nodeType&&t.matches(".PostStream-item[data-id]")}var j=new Map;function k(t,e){var r=(void 0===e?{}:e).force,n=void 0!==r&&r,o=String(t),i=Date.now(),u=j.get(o);if(!n&&u){if(u.map&&i-(u.ts||0)<1e4)return Promise.resolve(u.map);if(u.promise)return u.promise.then(function(t){return t.map})}var a=u||{ts:0,map:null,promise:null};return j.set(o,a),a.promise=app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/discussions/"+t+"/threads-order?bust="+i}).then(function(t){var e=new Map;return(t.order||[]).forEach(function(t){var r=t.postId,n=t.order,o=t.depth,i=t.parentPostId;e.set(Number(r),{order:Number(n),depth:Number.isFinite(o)?Number(o):0,parentId:i?Number(i):null})}),a.map=e,a.ts=Date.now(),a}).catch(function(t){return console.warn("[Threadify] threads-order fetch failed",t),a.map=a.map||new Map,a.ts=Date.now(),a}),a.promise.then(function(t){return t.map})}function E(t){var e=function(t){return Array.from((null==t?void 0:t.children)||[])}(t);if(!e.length)return{posts:[],left:-1,right:-1,anchor:null};var r=e.findIndex(T);if(r<0)return{posts:[],left:-1,right:-1,anchor:e[0]||null};var n=e.length-1-[].concat(e).reverse().findIndex(T);return n<r&&(n=r),{posts:e.slice(r,n+1).filter(T),left:r,right:n,anchor:e[n+1]||null}}function F(t,e,r){return C.apply(this,arguments)}function C(){var t;return t=_().mark(function t(e,r,n){var o,i,u,a;return _().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(o=E(e),i=o.posts,u=o.anchor,i.length){t.next=1;break}return t.abrupt("return");case 1:if(!i.some(function(t){return!n.has(Number(t.dataset.id))})){t.next=3;break}return t.next=2,k(r,{force:!0});case 2:return a=t.sent,t.abrupt("return",A(e,i,u,a));case 3:return t.abrupt("return",A(e,i,u,n));case 4:case"end":return t.stop()}},t)}),C=function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){g(i,n,o,u,a,"next",t)}function a(t){g(i,n,o,u,a,"throw",t)}u(void 0)})},C.apply(this,arguments)}function A(t,e,r,n){var o=function(t,e,r){var n=e.slice();return n.sort(function(t,e){var n=Number(t.dataset.id),o=Number(e.dataset.id),i=r.get(n),u=r.get(o),a=i?i.order:I+n,s=u?u.order:I+o;return a===s?n-o:a-s}),n}(0,e,n);if(!function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}(e,o))for(var i,u=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return O(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(o);!(i=u()).done;){var a=i.value;t.insertBefore(a,r)}}!function(){var t="threadify:logs",e=["log","info","warn","debug","error"];window.__threadifyConsoleOriginal||(window.__threadifyConsoleOriginal={},e.forEach(function(t){window.__threadifyConsoleOriginal[t]=console[t]?console[t].bind(console):function(){}}));var r="1"===("undefined"!=typeof localStorage?localStorage.getItem(t):null);function n(e){r=!!e,"undefined"!=typeof localStorage&&localStorage.setItem(t,r?"1":"0")}window.threadifyLogs={enable:function(){return n(!0),"Threadify logs: ON"},disable:function(){return n(!1),"Threadify logs: OFF"},toggle:function(){return n(!r),"Threadify logs: "+(r?"ON":"OFF")},status:function(){return r}},e.forEach(function(t){var e=window.__threadifyConsoleOriginal[t];console[t]=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=n&&n[0];if("string"!=typeof i||0!==i.indexOf("[Threadify]")||r)return e.apply(void 0,n)}})}(),e().initializers.add("syntaxoutlaw-threadify",function(){(0,n.extend)(x().prototype,"data",function(t){var e=function(t){if(!t||"string"!=typeof t)return null;var e=t.match(/@"[^"]*"#p(\d+)/);if(e&&e[1]){var r=parseInt(e[1],10);if(!isNaN(r)&&r>0)return r}return null}(t.content);return e&&(t.parent_id=e,console.log("[Threadify] Reply threading to post",e)),t}),(0,n.extend)(c().prototype,"classes",function(t){var e=this.attrs.post;if(!e)return console.warn("[Threadify] No post in ThreadedPost.classes"),t;var r=y(e);return console.log("[Threadify] Adding classes to post "+e.id()+": "+r.join(", ")),r.forEach(function(e){t.push(e)}),t}),(0,n.extend)(S().prototype,"oncreate",function(){var t=M(this),e=P(this);if(t&&e){k(t).then(function(r){return F(e,t,r)});var r=!1,n=new MutationObserver(function(n){n.some(function(t){return"childList"===t.type})&&(r||(r=!0,requestAnimationFrame(function(){r=!1,k(t).then(function(r){return F(e,t,r)})})))});n.observe(e,{childList:!0}),this.__threadifyDomObserver=n}}),(0,n.extend)(S().prototype,"onupdate",function(){var t=M(this),e=P(this);t&&e&&k(t).then(function(r){return F(e,t,r)})}),(0,n.extend)(S().prototype,"onremove",function(){if(this.__threadifyDomObserver){try{this.__threadifyDomObserver.disconnect()}catch(t){}this.__threadifyDomObserver=null}}),(0,n.extend)(i().prototype,"oninit",function(){var t=this.discussion&&"function"==typeof this.discussion.id&&this.discussion.id()||this.discussion&&this.discussion.id||null;t&&p(t)}),(0,n.extend)(a().prototype,"oncreate",function(){var t=this.attrs.discussion;if(t){var e=t.id(),r=function(){return p(e)};this.element&&(this.element.addEventListener("mouseenter",r,{once:!0}),this.element.addEventListener("touchstart",r,{once:!0,passive:!0}))}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map
/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,r,e)=>{var n=e(163),o=e(110),i=e(996),u=e(312),a=e(166),s=e(766),c=e(760);function f(){"use strict";var r=o(),e=r.m(f),l=(Object.getPrototypeOf?Object.getPrototypeOf(e):e.__proto__).constructor;function d(t){var r="function"==typeof t&&t.constructor;return!!r&&(r===l||"GeneratorFunction"===(r.displayName||r.name))}var p={throw:1,return:2,break:3,continue:3};function h(t){var r,e;return function(n){r||(r={stop:function(){return e(n.a,2)},catch:function(){return n.v},abrupt:function(t,r){return e(n.a,p[t],r)},delegateYield:function(t,o,i){return r.resultName=o,e(n.d,c(t),i)},finish:function(t){return e(n.f,t)}},e=function(t,e,o){n.p=r.prev,n.n=r.next;try{return t(e,o)}finally{r.next=n.n}}),r.resultName&&(r[r.resultName]=n.v,r.resultName=void 0),r.sent=n.v,r.next=n.n;try{return t.call(this,r)}finally{n.p=r.prev,n.n=r.next}}}return(t.exports=f=function(){return{wrap:function(t,e,n,o){return r.w(h(t),e,n,o&&o.reverse())},isGeneratorFunction:d,mark:r.m,awrap:function(t,r){return new n(t,r)},AsyncIterator:a,async:function(t,r,e,n,o){return(d(r)?u:i)(h(t),r,e,n,o)},keys:s,values:c}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=f,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,r,e)=>{var n=e(397);function o(){var r,e,i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function s(t,o,i,u){var a=o&&o.prototype instanceof f?o:f,s=Object.create(a.prototype);return n(s,"_invoke",function(t,n,o){var i,u,a,s=0,f=o||[],l=!1,d={p:0,n:0,v:r,a:p,f:p.bind(r,4),d:function(t,e){return i=t,u=0,a=r,d.n=e,c}};function p(t,n){for(u=t,a=n,e=0;!l&&s&&!o&&e<f.length;e++){var o,i=f[e],p=d.p,h=i[2];t>3?(o=h===n)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=r):i[0]<=p&&((o=t<2&&p<i[1])?(u=0,d.v=n,d.n=i[1]):p<h&&(o=t<3||i[0]>n||n>h)&&(i[4]=t,i[5]=n,d.n=h,u=0))}if(o||t>1)return c;throw l=!0,n}return function(o,f,h){if(s>1)throw TypeError("Generator is already running");for(l&&1===f&&p(f,h),u=f,a=h;(e=u<2?r:a)||!l;){i||(u?u<3?(u>1&&(d.n=-1),p(u,a)):d.n=a:d.v=a);try{if(s=2,i){if(u||(o="next"),e=i[o]){if(!(e=e.call(i,a)))throw TypeError("iterator result is not an object");if(!e.done)return e;a=e.value,u<2&&(u=0)}else 1===u&&(e=i.return)&&e.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=r}else if((e=(l=d.n<0)?a:t.call(n,d))!==c)break}catch(t){i=r,u=1,a=t}finally{s=1}}return{value:e,done:l}}}(t,i,u),!0),s}var c={};function f(){}function l(){}function d(){}e=Object.getPrototypeOf;var p=[][u]?e(e([][u]())):(n(e={},u,function(){return this}),e),h=d.prototype=f.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,a,"GeneratorFunction")),t.prototype=Object.create(h),t}return l.prototype=d,n(h,"constructor",d),n(d,"constructor",l),l.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(h),n(h,a,"Generator"),n(h,u,function(){return this}),n(h,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m:v}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,r){this.v=t,this.k=r},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,r,e)=>{var n=e(163),o=e(397);t.exports=function t(r,e){function i(t,o,u,a){try{var s=r[t](o),c=s.value;return c instanceof n?e.resolve(c.v).then(function(t){i("next",t,u,a)},function(t){i("throw",t,u,a)}):e.resolve(c).then(function(t){s.value=t,u(s)},function(t){return i("throw",t,u,a)})}catch(t){a(t)}}var u;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,r,n){function o(){return new e(function(r,e){i(t,n,r,e)})}return u=u?u.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,r,e)=>{var n=e(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,r,e)=>{var n=e(110),o=e(166);t.exports=function(t,r,e,i,u){return new o(n().w(t,r,e,i),u||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function r(e,n,o,i){var u=Object.defineProperty;try{u({},"",{})}catch(e){u=0}t.exports=r=function(t,e,n,o){function i(e,n){r(t,e,function(t){return this._invoke(e,n,t)})}e?u?u(t,e,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[e]=n:(i("next",0),i("throw",1),i("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,r(e,n,o,i)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function r(e){return t.exports=r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,r(e)}t.exports=r,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,r,e)=>{var n=e(735).default;t.exports=function(t){if(null!=t){var r=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],e=0;if(r)return r.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&e>=t.length&&(t=void 0),{value:t&&t[e++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var r=Object(t),e=[];for(var n in r)e.unshift(n);return function t(){for(;e.length;)if((n=e.pop())in r)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,r,e)=>{var n=e(312);t.exports=function(t,r,e,o,i){var u=n(t,r,e,o,i);return u.next().then(function(t){return t.done?t.value:u.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},r={};function e(n){var o=r[n];if(void 0!==o)return o.exports;var i=r[n]={exports:{}};return t[n](i,i.exports,e),i.exports}e.n=t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},e.d=(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},e.o=(t,r)=>Object.prototype.hasOwnProperty.call(t,r),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var r=e.n(t);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionPage"];var i=e.n(o);const u=flarum.core.compat["forum/components/DiscussionListItem"];var a=e.n(u);const s=flarum.core.compat["forum/components/Post"];var c=e.n(s);function f(t){return t&&void 0!==t._threadDepth?{depth:t._threadDepth,threadPath:t._threadPath,isRoot:t._isRoot,childCount:t._childCount,descendantCount:t._descendantCount,rootPostId:t._rootPostId}:null}const l=flarum.core.compat["forum/components/ReplyComposer"];var d=e.n(l);function p(t,r,e,n,o,i,u){try{var a=t[i](u),s=a.value}catch(t){return void e(t)}a.done?r(s):Promise.resolve(s).then(n,o)}function h(t){return function(){var r=this,e=arguments;return new Promise(function(n,o){var i=t.apply(r,e);function u(t){p(i,n,o,u,a,"next",t)}function a(t){p(i,n,o,u,a,"throw",t)}u(void 0)})}}var v=e(183),y=e.n(v);const x=flarum.core.compat["forum/components/PostStream"];var g=e.n(x);function b(t){var r=[];function e(t,n){if(void 0===n&&(n=0),t){r.push(t);var o=t._threadChildren||[];o.sort(function(t,r){return(t.createdAt?t.createdAt().getTime():0)-(r.createdAt?r.createdAt().getTime():0)}),o.forEach(function(t){e(t,n+1)})}}return t.sort(function(t,r){return(t.createdAt?t.createdAt().getTime():0)-(r.createdAt?r.createdAt().getTime():0)}),t.forEach(function(t){e(t)}),r}function _(t){var r=function(t){var r=[],e=new Map,n=new Map;return t.forEach(function(t){if(t){var r=t.id();e.set(r,t),n.set(r,[])}}),t.forEach(function(t){if(t){t.id();var o=t.attribute("parent_id");o&&e.has(String(o))?n.get(String(o)).push(t):r.push(t)}}),t.forEach(function(t){t&&(t._threadChildren=n.get(t.id())||[])}),r}(t);return b(r)}var w=new Map;function S(){w.clear()}function N(t){return null==t?"":String(t)}function M(t,e){var n=(e||[]).filter(Boolean),o=new Set(n.map(function(t){return N(t.id())})),i=[];n.forEach(function(t){var r=N(null==t||null==t.attribute?void 0:t.attribute("parent_id"));r&&!o.has(r)&&i.push(r)});var u,a,s=Array.from(new Set(i));return 0===s.length?Promise.resolve(n):(u=s,a=(u||[]).map(N).filter(Boolean),0===a.length?Promise.resolve([]):r().store.find("posts",{filter:{id:a.join(",")}})).then(function(r){var e,o,i,u=(e=n,o=r,i=new Map,e.filter(Boolean).forEach(function(t){return i.set(N(t.id()),t)}),o.filter(Boolean).forEach(function(t){return i.set(N(t.id()),t)}),Array.from(i.values()));return M(t,u)}).catch(function(t){return console.warn("[Threadify] Failed to load parent posts:",t),n})}function P(t,r){(null==r||r>t.length)&&(r=t.length);for(var e=0,n=Array(r);e<r;e++)n[e]=t[e];return n}var T=new Map;function O(t){var e=String(t),n=T.get(e);if(!0===(null==n?void 0:n.ready))return Promise.resolve();if(null!=n&&n.ready&&"function"==typeof n.ready.then)return n.ready;var o={map:new Map,ready:null};return T.set(e,o),o.ready=r().request({method:"GET",url:r().forum.attribute("apiUrl")+"/discussions/"+encodeURIComponent(e)+"/threads-order"}).then(function(t){for(var r,n=new Map,i=function(t,r){var e="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(e)return(e=e.call(t)).next.bind(e);if(Array.isArray(t)||(e=function(t,r){if(t){if("string"==typeof t)return P(t,r);var e={}.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?P(t,r):void 0}}(t))||r&&t&&"number"==typeof t.length){e&&(t=e);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(Array.isArray(null==t?void 0:t.order)?t.order:[]);!(r=i()).done;){var u=r.value;if(u){var a=Number(u.postId),s=Number(u.order),c=Number(u.depth),f=null!=u.parentPostId?Number(u.parentPostId):null;Number.isNaN(a)||Number.isNaN(s)||n.set(a,{order:s,depth:Number.isNaN(c)?0:c,parentId:f})}}o.map=n,o.ready=!0;try{window.dispatchEvent(new CustomEvent("threadify:orderReady",{detail:Number(e)}))}catch(t){}try{setTimeout(function(){return m.redraw()},0)}catch(t){}}).catch(function(t){console.warn("[Threadify] order prefetch failed:",t),o.ready=!0}),o.ready}function E(t,r){var e=T.get(String(t));if(null!=e&&e.map){var n=e.map.get(Number(r));return n?n.order:void 0}}function A(t,r){var e=T.get(String(t));if(null!=e&&e.map){var n=e.map.get(Number(r));return n?n.parentId:void 0}}var j=null,I=null,k=!1,C=null,R="",G="",F=null;function B(t){return!!t&&!!(t.loading||t.loadingPrevious||t.loadingNext||t.loadingNear||t._loadingPrevious||t._loadingNext)}function H(t){var r=t&&t.stream,e=r&&r.discussion;return e&&e.id&&e.id()}function L(t,r,e){void 0===e&&(e=40);var n=t&&t.stream;if(!n)return r();if(!B(n))try{return requestAnimationFrame(function(){return r()})}catch(t){return setTimeout(r,0)}e<=0||setTimeout(function(){return L(t,r,e-1)},50)}function D(t){return(t||[]).map(function(t){return t&&"function"==typeof t.id?String(t.id()):"#"}).join(",")}function U(t,r,e){return q.apply(this,arguments)}function q(){return(q=h(y().mark(function t(e,n,o){var i,u,a,s,c,f,l,d,p,h,v;return y().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if((u=null==e||null==(i=e.stream)?void 0:i.discussion)&&"function"==typeof u.postIds){t.next=1;break}return t.abrupt("return",o);case 1:a=new Set(o.filter(Boolean).map(function(t){return String(t.id())})),s=(u.postIds()||[]).map(function(t){return String(t)}),c=[],f=0;case 2:if(!(f<s.length&&c.length<20)){t.next=5;break}if((l=s[f])&&!a.has(l)){t.next=3;break}return t.abrupt("continue",4);case 3:null!=(d=A(n,Number(l)))&&a.has(String(d))&&c.push(l);case 4:f++,t.next=2;break;case 5:if(0!==c.length){t.next=6;break}return t.abrupt("return",o);case 6:return t.prev=6,t.next=7,r().store.find("posts",{filter:{id:c.join(",")}});case 7:return p=t.sent,h=new Map,o.filter(Boolean).forEach(function(t){return h.set(String(t.id()),t)}),(p||[]).filter(Boolean).forEach(function(t){return h.set(String(t.id()),t)}),t.abrupt("return",Array.from(h.values()));case 8:return t.prev=8,v=t.catch(6),console.warn("[Threadify] ensurePrefetchedChildren failed",v),t.abrupt("return",o);case 9:case"end":return t.stop()}},t,null,[[6,8]])}))).apply(this,arguments)}function z(t){if(!k){k=!0;var r=function(t){C=t||null,k=!1;try{m.redraw()}catch(t){}};h(y().mark(function e(){var n,o,i,u,a,s,c,f,l;return y().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,n=I&&I.call(t.stream)||[],0!==(o=n.filter(function(t){return t&&"function"==typeof t.id})).length){e.next=1;break}return e.abrupt("return",r(null));case 1:return i=t.discussion?t:{discussion:t.stream.discussion},u=H(t),e.next=2,M(i,o).catch(function(){return o});case 2:return a=e.sent,e.next=3,U(t,u,a).catch(function(){return a});case 3:a=e.sent,s=_(a),c=new Map,f=0,s.forEach(function(t){t&&"function"==typeof t.id&&c.set(t.id(),f++)}),r(c),e.next=5;break;case 4:e.prev=4,l=e.catch(0),console.error("[Threadify] buildOrderMap failed:",l),r(null);case 5:case"end":return e.stop()}},e,null,[[0,4]])}))()}}r().initializers.add("syntaxoutlaw-threadify",function(){(0,n.extend)(c().prototype,"classes",function(t){var r=this.attrs.post;if(!r)return console.warn("[Threadify] No post in ThreadedPost.classes"),t;var e=function(t){var r=function(t){if(!t)return 0;var r=f(t);return r?Math.min(r.depth,10):t.attribute("parent_id")?1:0}(t),e=[];r>0?(e.push("threaded-post"),e.push("thread-depth-"+r),r>=3&&e.push("thread-deep"),r>=5&&e.push("thread-very-deep")):e.push("thread-root");var n=f(t);return n&&(n.isRoot&&e.push("thread-root-confirmed"),n.childCount>0&&(e.push("has-children"),e.push("child-count-"+Math.min(n.childCount,10))),n.descendantCount>0&&e.push("has-descendants")),e}(r);return console.log("[Threadify] Adding classes to post "+r.id()+": "+e.join(", ")),e.forEach(function(r){t.push(r)}),t}),(0,n.extend)(d().prototype,"data",function(t){var r=function(t){if(!t||"string"!=typeof t)return null;var r=t.match(/@"[^"]*"#p(\d+)/);if(r&&r[1]){var e=parseInt(r[1],10);if(!isNaN(e)&&e>0)return e}return null}(t.content);return r&&(t.parent_id=r,console.log("[Threadify] Reply threading to post",r)),t}),(0,n.extend)(g().prototype,"oninit",function(){var t=this,r=H(this);j!==r&&(j=r||null,I=null,C=null,k=!1,R="",G="",F=null,S()),I||(I=this.stream.posts),r&&O(r),this._threadifyOrderHandler=function(e){var n=e&&e.detail;String(r)===String(n)&&L(t,function(){return z(t)})};try{window.addEventListener("threadify:orderReady",this._threadifyOrderHandler)}catch(t){}L(this,function(){return z(t)}),this.stream.posts=function(){var r=I&&I.call(t.stream)||[];if(B(t.stream))return r;var e=H(t);if(!e||r.length<=1)return r;var n=r.filter(function(t){return t&&"function"==typeof t.id});if(n.length<=1)return r;var o=D(r)+"|"+(C?C.size:0)+"|"+String(e);if(o===G&&F)return F;var i=function(t,r){var e=r.slice();return e.sort(function(r,e){var n=r.id(),o=e.id(),i=E(t,n),u=E(t,o);if(null!=i||null!=u){if(null==i)return 1;if(null==u)return-1;if(i!==u)return i-u}var a=C&&C.get&&C.get(n),s=C&&C.get&&C.get(o);if(null!=a||null!=s){if(null==a)return 1;if(null==s)return-1;if(a!==s)return a-s}return 0}),e}(e,n),u=function(t,r){for(var e=new Array(t.length),n=0,o=0;o<t.length;o++){var i=t[o],u=!(!i||"function"!=typeof i.id)||null==i;e[o]=u?n<r.length?r[n++]:null:i}return e}(r,i);return G=o,F=u,u}}),(0,n.extend)(g().prototype,"onupdate",function(){var t=this,r=D(I&&I.call(this.stream)||[]);r!==R&&(R=r,G="",F=null,S(),L(this,function(){return z(t)}))}),(0,n.extend)(g().prototype,"onremove",function(){try{this._threadifyOrderHandler&&(window.removeEventListener("threadify:orderReady",this._threadifyOrderHandler),this._threadifyOrderHandler=null)}catch(t){}}),(0,n.extend)(i().prototype,"oninit",function(){var t=this.discussion&&this.discussion.id&&this.discussion.id();t&&O(t)}),(0,n.extend)(a().prototype,"oncreate",function(){var t=this.attrs.discussion;if(t){var r=t.id(),e=function(){return O(r)};this.element&&this.element.addEventListener("mouseenter",e,{once:!0}),this.element&&this.element.addEventListener("touchstart",e,{once:!0,passive:!0})}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map
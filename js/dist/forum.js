/*! For license information please see forum.js.LICENSE.txt */
(()=>{var e={24:(e,t,r)=>{var n=r(163),o=r(110),a=r(996),i=r(312),u=r(166),s=r(766),c=r(760);function l(){"use strict";var t=o(),r=t.m(l),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function d(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))}var p={throw:1,return:2,break:3,continue:3};function v(e){var t,r;return function(n){t||(t={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(e,t){return r(n.a,p[e],t)},delegateYield:function(e,o,a){return t.resultName=o,r(n.d,c(e),a)},finish:function(e){return r(n.f,e)}},r=function(e,r,o){n.p=t.prev,n.n=t.next;try{return e(r,o)}finally{t.next=n.n}}),t.resultName&&(t[t.resultName]=n.v,t.resultName=void 0),t.sent=n.v,t.next=n.n;try{return e.call(this,t)}finally{n.p=t.prev,n.n=t.next}}}return(e.exports=l=function(){return{wrap:function(e,r,n,o){return t.w(v(e),r,n,o&&o.reverse())},isGeneratorFunction:d,mark:t.m,awrap:function(e,t){return new n(e,t)},AsyncIterator:u,async:function(e,t,r,n,o){return(d(t)?i:a)(v(e),t,r,n,o)},keys:s,values:c}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=l,e.exports.__esModule=!0,e.exports.default=e.exports},110:(e,t,r)=>{var n=r(397);function o(){var t,r,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",u=a.toStringTag||"@@toStringTag";function s(e,o,a,i){var u=o&&o.prototype instanceof l?o:l,s=Object.create(u.prototype);return n(s,"_invoke",function(e,n,o){var a,i,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return a=e,i=0,u=t,d.n=r,c}};function p(e,n){for(i=e,u=n,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],p=d.p,v=a[2];e>3?(o=v===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=t):a[0]<=p&&((o=e<2&&p<a[1])?(i=0,d.v=n,d.n=a[1]):p<v&&(o=e<3||a[0]>n||n>v)&&(a[4]=e,a[5]=n,d.n=v,i=0))}if(o||e>1)return c;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),i=l,u=v;(r=i<2?t:u)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,u)):d.n=u:d.v=u);try{if(s=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=t}else if((r=(f=d.n<0)?u:e.call(n,d))!==c)break}catch(e){a=t,i=1,u=e}finally{s=1}}return{value:r,done:f}}}(e,a,i),!0),s}var c={};function l(){}function f(){}function d(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),v=d.prototype=l.prototype=Object.create(p);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,n(e,u,"GeneratorFunction")),e.prototype=Object.create(v),e}return f.prototype=d,n(v,"constructor",d),n(d,"constructor",f),f.displayName="GeneratorFunction",n(d,u,"GeneratorFunction"),n(v),n(v,u,"Generator"),n(v,i,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(e.exports=o=function(){return{w:s,m}},e.exports.__esModule=!0,e.exports.default=e.exports)()}e.exports=o,e.exports.__esModule=!0,e.exports.default=e.exports},163:e=>{e.exports=function(e,t){this.v=e,this.k=t},e.exports.__esModule=!0,e.exports.default=e.exports},166:(e,t,r)=>{var n=r(163),o=r(397);e.exports=function e(t,r){function a(e,o,i,u){try{var s=t[e](o),c=s.value;return c instanceof n?r.resolve(c.v).then(function(e){a("next",e,i,u)},function(e){a("throw",e,i,u)}):r.resolve(c).then(function(e){s.value=e,i(s)},function(e){return a("throw",e,i,u)})}catch(e){u(e)}}var i;this.next||(o(e.prototype),o(e.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(e,t,n){function o(){return new r(function(t,r){a(e,n,t,r)})}return i=i?i.then(o,o):o()},!0)},e.exports.__esModule=!0,e.exports.default=e.exports},183:(e,t,r)=>{var n=r(24)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(e,t,r)=>{var n=r(110),o=r(166);e.exports=function(e,t,r,a,i){return new o(n().w(e,t,r,a),i||Promise)},e.exports.__esModule=!0,e.exports.default=e.exports},397:e=>{function t(r,n,o,a){var i=Object.defineProperty;try{i({},"",{})}catch(r){i=0}e.exports=t=function(e,r,n,o){function a(r,n){t(e,r,function(e){return this._invoke(r,n,e)})}r?i?i(e,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[r]=n:(a("next",0),a("throw",1),a("return",2))},e.exports.__esModule=!0,e.exports.default=e.exports,t(r,n,o,a)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},735:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},760:(e,t,r)=>{var n=r(735).default;e.exports=function(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}}}throw new TypeError(n(e)+" is not iterable")},e.exports.__esModule=!0,e.exports.default=e.exports},766:e=>{e.exports=function(e){var t=Object(e),r=[];for(var n in t)r.unshift(n);return function e(){for(;r.length;)if((n=r.pop())in t)return e.value=n,e.done=!1,e;return e.done=!0,e}},e.exports.__esModule=!0,e.exports.default=e.exports},996:(e,t,r)=>{var n=r(312);e.exports=function(e,t,r,o,a){var i=n(e,t,r,o,a);return i.next().then(function(e){return e.done?e.value:i.next()})},e.exports.__esModule=!0,e.exports.default=e.exports}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n](a,a.exports,r),a.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";const e=flarum.core.compat["forum/app"];var t=r.n(e);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionPage"];var a=r.n(o);const i=flarum.core.compat["forum/components/DiscussionListItem"];var u=r.n(i);const s=flarum.core.compat["forum/components/Post"];var c=r.n(s),l=new Map;function f(e){if(!e)return null;var t=e.discussion&&e.discussion(),r=t&&t.id&&t.id();if(!r)return null;var n=function(e,t){var r=l.get(Number(e));if(r)return r.map.get(Number(t))}(r,e.id());return n?{depth:n.depth,threadPath:null,isRoot:!n.parentId,childCount:0,descendantCount:0,rootPostId:null}:null}var d=new Map;function p(e,t){void 0===t&&(t={});var r=b(e);if(!r)return Promise.resolve();var n=Date.now(),o=d.get(r)||{map:new Map,inflight:null,ts:0};if(d.set(r,o),!t.force&&n-o.ts<1e4)return o.inflight||Promise.resolve();if(o.inflight&&!t.force)return o.inflight;var a=n;return o.inflight=app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/discussions/"+r+"/threads-order?bust="+a}).then(function(e){var t=new Map;(e&&e.order?e.order:[]).forEach(function(e){var r=e.postId,n=e.order,o=e.depth,a=e.parentPostId;r=Number(r),t.set(r,{order:Number(n),depth:Number.isFinite(o)?Number(o):0,parentId:a?Number(a):null})}),o.map=t,o.ts=Date.now();try{window.dispatchEvent(new CustomEvent("threadify:order-ready",{detail:{discussionId:Number(r)}}))}catch(e){}}).catch(function(e){console.warn("[Threadify] order prefetch failed",e)}).finally(function(){o.inflight=null}),o.inflight}function v(e){var t=b(e);if(t){var r=d.get(t);return r?r.map:void 0}}function h(e){var t=b(e);if(!t)return Promise.resolve(new Map);var r=Date.now(),n=d.get(t)||{map:new Map,inflight:null,ts:0};return d.set(t,n),r-n.ts<1e4&&n.map&&n.map.size>=0?Promise.resolve(n.map):(n.inflight||p(t)).then(function(){return v(t)||new Map})}function y(e){var t=b(e);if(t){var r=d.get(t);r&&(r.ts=0)}}function b(e){if(null==e)return null;var t=Number(e);return Number.isFinite(t)&&t>0?String(t):null}function g(e){var t=Number(e);return Number.isFinite(t)?Math.max(0,Math.min(10,t)):0}function x(e){var t,r,n,o,a=function(e){if(!e||"function"!=typeof e.id)return 0;try{var t=e.discussion&&"function"==typeof e.discussion&&e.discussion()&&e.discussion().id&&e.discussion().id()||null;if(null!=t){var r=(n=t,o=e.id(),(i=(a=v(n))&&a.get(Number(o)))?i.depth:void 0);if(Number.isInteger(r))return g(r)}}catch(e){}var n,o,a,i;try{var u=f(e);if(u&&Number.isInteger(u.depth))return g(u.depth)}catch(e){}return function(e){for(var t=0,r=0,n=new Set,o=e;o&&r<100;){var a=o.attribute?o.attribute("parent_id"):null;if(!a)break;if(n.has(a)){console.warn("[Threadify] cycle detected while walking parents of",e&&e.id&&e.id()),t=0;break}n.add(a),t+=1;var i=app.store.getById("posts",String(a));if(!i)break;if(o=i,r++,t>=10)break}return g(t)}(e)}(e),i=[];a>0?(i.push("threaded-post"),i.push("thread-depth-"+a),a>=3&&i.push("thread-deep"),a>=5&&i.push("thread-very-deep")):i.push("thread-root");try{var u=e.discussion&&"function"==typeof e.discussion&&e.discussion()&&e.discussion().id&&e.discussion().id()||null,s=null!=u?(t=u,r=e.id(),(o=(n=v(t))&&n.get(Number(r)))?o.parentId:void 0):void 0,c=f(e);(null==s?!e.attribute||!e.attribute("parent_id"):null==s)&&i.push("thread-root-confirmed"),c&&Number.isInteger(c.childCount)&&c.childCount>0&&i.push("has-children","child-count-"+Math.min(c.childCount,10)),c&&Number.isInteger(c.descendantCount)&&c.descendantCount>0&&i.push("has-descendants")}catch(e){}return i}const w=flarum.core.compat["forum/components/ReplyComposer"];var N=r.n(w);function _(e,t,r,n,o,a,i){try{var u=e[a](i),s=u.value}catch(e){return void r(e)}u.done?t(s):Promise.resolve(s).then(n,o)}function T(e){return function(){var t=this,r=arguments;return new Promise(function(n,o){var a=e.apply(t,r);function i(e){_(a,n,o,i,u,"next",e)}function u(e){_(a,n,o,i,u,"throw",e)}i(void 0)})}}var S=r(183),P=r.n(S);const M=flarum.core.compat["forum/components/PostStream"];var I=r.n(M);function k(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(r)return(r=r.call(e)).next.bind(r);if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return O(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?O(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function O(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var A=1e7,E=!1;function F(){if(!E){E=!0;try{requestAnimationFrame(function(){E=!1,"function"==typeof m&&"function"==typeof m.redraw&&m.redraw()})}catch(e){E=!1}}}function L(e){try{var t,r;return null!=(t=null==e||null==(r=e.stream)||null==(r=r.discussion)||null==r.id?void 0:r.id())?t:null}catch(e){return null}}function C(e){var t,r;return null!=e&&null!=(t=e.element)&&null!=(t=t.classList)&&t.contains("PostStream")?e.element:(null==e||null==(r=e.element)||null==r.querySelector?void 0:r.querySelector(".PostStream"))||document.querySelector(".PostStream")||null}function j(e){return e&&1===e.nodeType&&e.matches(".PostStream-item[data-id]")}function R(e){var t=Array.from((null==e?void 0:e.children)||[]);if(!t.length)return{posts:[],anchor:null};var r=t.findIndex(j);if(r<0)return{posts:[],anchor:t[0]||null};var n=t.length-1-[].concat(t).reverse().findIndex(j);return n<r&&(n=r),{posts:t.slice(r,n+1).filter(j),anchor:t[n+1]||null}}function q(e,t){if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}function D(e){try{return t().store.getById("posts",String(e))}catch(e){return null}}function B(e){try{var t=null==e||null==e.number?void 0:e.number();return Number.isFinite(t)?t:null}catch(e){return null}}function G(e){try{var t=null==e||null==e.createdAt?void 0:e.createdAt();return t instanceof Date?+t:null}catch(e){return null}}function U(e,t){var r,n,o=function(e){try{var t;if(!e)return null;if("function"==typeof e.contentType)return e.contentType();if("function"==typeof e.attribute)return null!=(t=e.attribute("contentType"))?t:null}catch(e){}return null}(t);return!(!o||"comment"===o)||!!(null!=e&&null!=(r=e.classList)&&r.contains("EventPost")||null!=e&&null!=(n=e.classList)&&n.contains("Post-event"))||!(null==e||null==e.querySelector||!e.querySelector(".EventPost, .Post-event, .EventPost-icon"))}function z(e,t,r){if(e&&Number.isFinite(e.order))return Number(e.order);var n=B(t);if(null!=n)return n;var o=G(t);return null!=o?A/2+o:A+Number(r)}function V(e,t){var r=G(e);if(null!=r)return r;var n=B(e);return null!=n?A/2+n:A+Number(t)}function $(e,t){for(var r,n=new Set(e.map(function(e){return Number(e.dataset.id)})),o=new Map(e.map(function(e){return[Number(e.dataset.id),D(Number(e.dataset.id))]})),a=new Map,i=k(e);!(r=i()).done;){var u=r.value,s=Number(u.dataset.id),c=t.get(s),l=o.get(s),f=c?c.parentId:null!=l&&l.attribute?l.attribute("parent_id"):null;a.set(s,null==f?null:Number(f))}for(var d,p=new Set,v=k(e);!(d=v()).done;){var m=d.value,h=Number(m.dataset.id);U(m,o.get(h))&&p.add(h)}for(var y,b=new Set,g=k(e);!(y=g()).done;){var x=y.value,w=Number(x.dataset.id);p.has(w)||null==a.get(w)&&b.add(w)}for(var N=!0;N;){N=!1;for(var _,T=k(e);!(_=T()).done;){var S=_.value,P=Number(S.dataset.id);if(!b.has(P)&&!p.has(P)){var M=a.get(P);null!=M&&n.has(M)&&b.has(M)&&(b.add(P),N=!0)}}}return{eligible:b,events:p,models:o,parentOf:a,present:n}}function Y(e,t,r,n,o){for(var a,i=e.filter(function(e){return t.has(Number(e.dataset.id))}),u=i.slice().sort(function(e,t){var r=Number(e.dataset.id),a=Number(t.dataset.id),i=z(n.get(r),o.get(r),r),u=z(n.get(a),o.get(a),a);return i===u?r-a:i-u}),s=[],c=0,l=k(e);!(a=l()).done;){var f=a.value,d=Number(f.dataset.id);s.push(t.has(d)?u[c++]:f)}for(var p,v=s.filter(function(e){return!r.has(Number(e.dataset.id))}),m=e.filter(function(e){return r.has(Number(e.dataset.id))}).sort(function(e,t){var r=Number(e.dataset.id),n=Number(t.dataset.id),a=V(o.get(r),r),i=V(o.get(n),n);return a===i?r-n:a-i}),h=v.slice(),y=function(e){return V(o.get(Number(e.dataset.id)),Number(e.dataset.id))},b=k(m);!(p=b()).done;){for(var g=p.value,x=Number(g.dataset.id),w=V(o.get(x),x),N=-1,_=0;_<h.length;_++)if(y(h[_])>w){N=_;break}-1===N?h.push(g):h.splice(N,0,g)}return h}function H(e,t,r,n,o){var a=e.map(function(e){return Number(e.dataset.id)}),i=new Set(a),u=new Set(a.filter(function(e){return!r.has(e)&&!t.has(e)}));if(!u.size)return e;function s(e){for(var t=e,r=0;r<100;r++){var n=o.get(t);if(null==n)return null;if(!i.has(n))return null;if(u.has(n))return n;t=n}return null}for(var c,l=new Map,f=k(u);!(c=f()).done;){var d=c.value,p=s(d);null!=p&&p!==d&&(l.has(p)||l.set(p,new Set),l.get(p).add(d))}if(!l.size)return e;for(var v,m=e.slice(),h=new Map(m.map(function(e,t){return[Number(e.dataset.id),t]})),y=function(){var e=v.value,t=m.findIndex(function(t){return Number(t.dataset.id)===e});if(t<0)return 1;var r=function(e){for(var t=new Set(e),r=[],n=0;n<m.length;n++){var o=Number(m[n].dataset.id);t.has(o)&&(r.push(m[n]),m.splice(n,1),n--)}return r}(Array.from(l.get(e)).sort(function(e,t){var r=V(n.get(e),e),o=V(n.get(t),t);return r===o?e-t:r-o}));m.splice.apply(m,[t+1,0].concat(r))},b=k(Array.from(l.keys()).sort(function(e,t){return h.get(e)-h.get(t)}));!(v=b()).done;)y();return m}function J(e,t){var r=Array.from(e.querySelectorAll(".PostStream-item[data-id]"));if(!r.length)return!1;var n=new Map(r.map(function(e){return[Number(e.dataset.id),D(Number(e.dataset.id))]})),o=new Map(r.map(function(e){var r=Number(e.dataset.id),o=t.get(r),a=n.get(r),i=o?o.parentId:null!=a&&a.attribute?a.attribute("parent_id"):null;return[r,null==i?null:Number(i)]})),a=function(e){return Number.isFinite(e)?Math.max(0,Math.min(10,e)):0};function i(e){var r=t.get(e);if(r&&Number.isInteger(r.depth))return a(r.depth);for(var n=0,i=0,u=e,s=new Set([e]);i++<100;){var c=o.get(u);if(!c)break;if(s.has(c)){n=0;break}if(s.add(c),u=c,++n>=10)break}return a(n)}function u(e,t,r){var n=e.querySelector(".Post")||e,o=[];return n.classList.forEach(function(e){/^(thread-(root|ed-post|depth-\d+|deep|very-deep))$/.test(e)&&o.push(e)}),o.forEach(function(e){return n.classList.remove(e)}),r?(n.classList.add("thread-root"),!0):(t>0?(n.classList.add("threaded-post","thread-depth-"+t),t>=3&&n.classList.add("thread-deep"),t>=5&&n.classList.add("thread-very-deep")):n.classList.add("thread-root"),!0)}for(var s=!1,c=0,l=r;c<l.length;c++){var f=l[c],d=Number(f.dataset.id),p=U(f,n.get(d));s=u(f,p?0:i(d),p)||s}return s}function K(e,t){return Q.apply(this,arguments)}function Q(){return(Q=T(P().mark(function e(t,r){var n,o,a,i,u,s,c,l,f,d,p,v,m,y,b,g;return P().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,h(r);case 1:if(g=e.sent){e.next=2;break}g=new Map;case 2:if(n=g,o=R(t),(a=o.posts).length){e.next=3;break}return e.abrupt("return");case 3:if(i=$(a,n),u=i.eligible,s=i.events,c=i.models,l=i.parentOf,f=Y(a,u,s,n,c),d=H(f,u,s,c,l),!q(a,d)){p=R(t),v=p.anchor&&p.anchor.parentNode===t?p.anchor:null;try{for(m=k(d);!(y=m()).done;)b=y.value,v&&v.parentNode===t?t.insertBefore(b,v):t.appendChild(b)}catch(e){console.warn("[Threadify] reorder failed (will retry)",e)}}J(t,n),F();case 4:case"end":return e.stop()}},e)}))).apply(this,arguments)}!function(){var e="threadify:logs",t=["log","info","warn","debug","error"];window.__threadifyConsoleOriginal||(window.__threadifyConsoleOriginal={},t.forEach(function(e){window.__threadifyConsoleOriginal[e]=console[e]?console[e].bind(console):function(){}}));var r="1"===("undefined"!=typeof localStorage?localStorage.getItem(e):null);function n(t){r=!!t,"undefined"!=typeof localStorage&&localStorage.setItem(e,r?"1":"0")}window.threadifyLogs={enable:function(){return n(!0),"Threadify logs: ON"},disable:function(){return n(!1),"Threadify logs: OFF"},toggle:function(){return n(!r),"Threadify logs: "+(r?"ON":"OFF")},status:function(){return r}},t.forEach(function(e){var t=window.__threadifyConsoleOriginal[e];console[e]=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];var a=n&&n[0];if("string"!=typeof a||0!==a.indexOf("[Threadify]")||r)return t.apply(void 0,n)}})}(),t().initializers.add("syntaxoutlaw-threadify",function(){(0,n.extend)(N().prototype,"data",function(e){var t=function(e){if(!e||"string"!=typeof e)return null;var t=e.match(/@"[^"]*"#p(\d+)/);if(t&&t[1]){var r=parseInt(t[1],10);if(!isNaN(r)&&r>0)return r}return null}(e.content);return t&&(e.parent_id=t,console.log("[Threadify] Reply threading to post",t)),e}),(0,n.extend)(c().prototype,"classes",function(e){var t=this.attrs.post;if(!t)return console.warn("[Threadify] No post in ThreadedPost.classes"),e;var r=x(t);return console.log("[Threadify] Adding classes to post "+t.id()+": "+r.join(", ")),r.forEach(function(t){e.push(t)}),e}),function(){(0,n.extend)(I().prototype,"oncreate",function(){var e=L(this),t=C(this);if(e&&t){var r={isReordering:!1,coalesceTimer:null,repairTimer:null,removalTimer:null,pauseUntil:0,scrollBusy:!1,scrollIdleTimer:null};this.__threadify=r;var n=function(){r.scrollBusy=!0,clearTimeout(r.scrollIdleTimer),r.scrollIdleTimer=setTimeout(function(){r.scrollBusy=!1},120)};try{window.addEventListener("scroll",n,{passive:!0})}catch(e){}var o=function(){var n=T(P().mark(function n(){return P().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.isReordering){n.next=1;break}return n.abrupt("return");case 1:if(!(Date.now()<r.pauseUntil)){n.next=2;break}return n.abrupt("return");case 2:if(!r.scrollBusy){n.next=3;break}return n.abrupt("return");case 3:return r.isReordering=!0,n.prev=4,n.next=5,K(t,e);case 5:return n.prev=5,r.isReordering=!1,n.finish(5);case 6:case"end":return n.stop()}},n,null,[[4,,5,6]])}));return function(){return n.apply(this,arguments)}}();K(t,e);var a=new MutationObserver(function(n){var a=n.filter(function(e){return"childList"===e.type}),i=a.flatMap(function(e){return Array.from(e.addedNodes||[])}).filter(function(e){return e&&1===e.nodeType&&e.matches&&e.matches(".PostStream-item[data-id]")});if(i.length)return clearTimeout(r.coalesceTimer),void(r.coalesceTimer=setTimeout(T(P().mark(function n(){var o,a,u;return P().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.isReordering){n.next=1;break}return n.abrupt("return");case 1:return r.isReordering=!0,n.prev=2,n.next=3,h(e);case 3:if(a=n.sent){n.next=4;break}a=new Map;case 4:if(o=a,!i.some(function(e){return!o.has(Number(e.dataset.id))})){n.next=5;break}return y(e),n.next=5,p(e,{force:!0});case 5:return n.next=6,K(t,e);case 6:n.next=8;break;case 7:n.prev=7,u=n.catch(2),console.warn("[Threadify] realtime reorder failed",u);case 8:return n.prev=8,r.isReordering=!1,n.finish(8);case 9:case"end":return n.stop()}},n,null,[[2,7,8,9]])})),16));if(n.some(function(e){if("attributes"!==e.type)return!1;var t=e.target;if(null==t||null==t.matches||!t.matches(".PostStream-item"))return!1;if("data-id"===e.attributeName)return!!t.getAttribute("data-id");if("class"===e.attributeName){var r=e.oldValue||"",n=t.className||"";return/PostStream-item/.test(n)&&/Post--saving/.test(r)&&!/Post--saving/.test(n)}return!1}))return clearTimeout(r.coalesceTimer),void(r.coalesceTimer=setTimeout(T(P().mark(function n(){var o,a;return P().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(!r.isReordering){n.next=1;break}return n.abrupt("return");case 1:return r.isReordering=!0,n.prev=2,y(e),n.next=3,p(e,{force:!0});case 3:return n.next=4,K(t,e);case 4:o=0,clearInterval(r.repairTimer),r.repairTimer=setInterval(T(P().mark(function n(){var a;return P().wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o++,n.next=1,h(e);case 1:if(a=n.sent){n.next=2;break}a=new Map;case 2:(J(t,a)||o>=10)&&(clearInterval(r.repairTimer),F());case 3:case"end":return n.stop()}},n)})),150),n.next=6;break;case 5:n.prev=5,a=n.catch(2),console.warn("[Threadify] hydration reorder failed",a);case 6:return n.prev=6,r.isReordering=!1,n.finish(6);case 7:case"end":return n.stop()}},n,null,[[2,5,6,7]])})),16));if(a.flatMap(function(e){return Array.from(e.removedNodes||[])}).filter(function(e){return e&&1===e.nodeType&&e.matches&&e.matches(".PostStream-item, .EventPost, .Post")}).length){var u=t.querySelector(".LoadingIndicator, .PostStream-loading, .Post--loading")?160:96;r.pauseUntil=Date.now()+u+100,clearTimeout(r.removalTimer);var s=function(){r.scrollBusy||Date.now()<r.pauseUntil?r.removalTimer=setTimeout(s,48):requestAnimationFrame(function(){requestAnimationFrame(T(P().mark(function e(){return P().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=1,o();case 1:case"end":return e.stop()}},e)})))})};r.removalTimer=setTimeout(s,u)}else requestAnimationFrame(function(){return o()})});a.observe(t,{childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["data-id","class"],subtree:!0}),this.__threadifyDomObserver=a,this.__threadifyCleanup=function(){try{a.disconnect()}catch(e){}try{window.removeEventListener("scroll",n,{passive:!0})}catch(e){}clearTimeout(r.coalesceTimer),clearTimeout(r.removalTimer),clearInterval(r.repairTimer)}}}),(0,n.extend)(I().prototype,"onupdate",function(){var e=L(this),t=C(this);if(e&&t){var r=this.__threadify;r&&(Date.now()<r.pauseUntil||r.scrollBusy||r.isReordering)||K(t,e)}}),(0,n.extend)(I().prototype,"onremove",function(){if(this.__threadifyCleanup){try{this.__threadifyCleanup()}catch(e){}this.__threadifyCleanup=null}this.__threadify&&(this.__threadify=null)});try{window.addEventListener("threadify:order-ready",function(){return F()})}catch(e){}}(),(0,n.extend)(a().prototype,"oninit",function(){var e=this.discussion&&"function"==typeof this.discussion.id&&this.discussion.id()||this.discussion&&this.discussion.id||null;e&&p(e)}),(0,n.extend)(u().prototype,"oncreate",function(){var e=this.attrs.discussion;if(e){var t=e.id(),r=function(){return p(t)};this.element&&(this.element.addEventListener("mouseenter",r,{once:!0}),this.element.addEventListener("touchstart",r,{once:!0,passive:!0}))}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map
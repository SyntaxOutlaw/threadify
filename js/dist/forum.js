/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),i=r(996),u=r(312),a=r(166),s=r(766),l=r(760);function c(){"use strict";var e=o(),r=e.m(c),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function d(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var p={throw:1,return:2,break:3,continue:3};function v(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,p[t],e)},delegateYield:function(t,o,i){return e.resultName=o,r(n.d,l(t),i)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=c=function(){return{wrap:function(t,r,n,o){return e.w(v(t),r,n,o&&o.reverse())},isGeneratorFunction:d,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:a,async:function(t,e,r,n,o){return(d(e)?u:i)(v(t),e,r,n,o)},keys:s,values:l}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=c,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,i="function"==typeof Symbol?Symbol:{},u=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function s(t,o,i,u){var a=o&&o.prototype instanceof c?o:c,s=Object.create(a.prototype);return n(s,"_invoke",function(t,n,o){var i,u,a,s=0,c=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return i=t,u=0,a=e,d.n=r,l}};function p(t,n){for(u=t,a=n,r=0;!f&&s&&!o&&r<c.length;r++){var o,i=c[r],p=d.p,v=i[2];t>3?(o=v===n)&&(a=i[(u=i[4])?5:(u=3,3)],i[4]=i[5]=e):i[0]<=p&&((o=t<2&&p<i[1])?(u=0,d.v=n,d.n=i[1]):p<v&&(o=t<3||i[0]>n||n>v)&&(i[4]=t,i[5]=n,d.n=v,u=0))}if(o||t>1)return l;throw f=!0,n}return function(o,c,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===c&&p(c,v),u=c,a=v;(r=u<2?e:a)||!f;){i||(u?u<3?(u>1&&(d.n=-1),p(u,a)):d.n=a:d.v=a);try{if(s=2,i){if(u||(o="next"),r=i[o]){if(!(r=r.call(i,a)))throw TypeError("iterator result is not an object");if(!r.done)return r;a=r.value,u<2&&(u=0)}else 1===u&&(r=i.return)&&r.call(i),u<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),u=1);i=e}else if((r=(f=d.n<0)?a:t.call(n,d))!==l)break}catch(t){i=e,u=1,a=t}finally{s=1}}return{value:r,done:f}}}(t,i,u),!0),s}var l={};function c(){}function f(){}function d(){}r=Object.getPrototypeOf;var p=[][u]?r(r([][u]())):(n(r={},u,function(){return this}),r),v=d.prototype=c.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,a,"GeneratorFunction")),t.prototype=Object.create(v),t}return f.prototype=d,n(v,"constructor",d),n(d,"constructor",f),f.displayName="GeneratorFunction",n(d,a,"GeneratorFunction"),n(v),n(v,a,"Generator"),n(v,u,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function i(t,o,u,a){try{var s=e[t](o),l=s.value;return l instanceof n?r.resolve(l.v).then(function(t){i("next",t,u,a)},function(t){i("throw",t,u,a)}):r.resolve(l).then(function(t){s.value=t,u(s)},function(t){return i("throw",t,u,a)})}catch(t){a(t)}}var u;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){i(t,n,e,r)})}return u=u?u.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,i,u){return new o(n().w(t,e,r,i),u||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,i){var u=Object.defineProperty;try{u({},"",{})}catch(r){u=0}t.exports=e=function(t,r,n,o){function i(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?u?u(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(i("next",0),i("throw",1),i("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,i)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,i){var u=n(t,e,r,o,i);return u.next().then(function(t){return t.done?t.value:u.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var i=e[n]={exports:{}};return t[n](i,i.exports,r),i.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var e=r.n(t);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionPage"];var i=r.n(o);const u=flarum.core.compat["forum/components/DiscussionListItem"];var a=r.n(u);const s=flarum.core.compat["forum/components/Post"];var l=r.n(s),c=new Map;function f(t){if(!t)return null;var e=t.discussion&&t.discussion(),r=e&&e.id&&e.id();if(!r)return null;var n=function(t,e){var r=c.get(Number(t));if(r)return r.map.get(Number(e))}(r,t.id());return n?{depth:n.depth,threadPath:null,isRoot:!n.parentId,childCount:0,descendantCount:0,rootPostId:null}:null}var d=new Map;function p(t,e){void 0===e&&(e={});var r=y(t);if(!r)return Promise.resolve();var n=Date.now(),o=d.get(r)||{map:new Map,inflight:null,ts:0};if(d.set(r,o),!e.force&&n-o.ts<1e4)return o.inflight||Promise.resolve();if(o.inflight&&!e.force)return o.inflight;var i=n;return o.inflight=app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/discussions/"+r+"/threads-order?bust="+i}).then(function(t){var e=new Map;(t&&t.order?t.order:[]).forEach(function(t){var r=t.postId,n=t.order,o=t.depth,i=t.parentPostId;r=Number(r),e.set(r,{order:Number(n),depth:Number.isFinite(o)?Number(o):0,parentId:i?Number(i):null})}),o.map=e,o.ts=Date.now();try{window.dispatchEvent(new CustomEvent("threadify:order-ready",{detail:{discussionId:Number(r)}}))}catch(t){}}).catch(function(t){console.warn("[Threadify] order prefetch failed",t)}).finally(function(){o.inflight=null}),o.inflight}function v(t){var e=y(t);if(e){var r=d.get(e);return r?r.map:void 0}}function h(t){var e=y(t);if(!e)return Promise.resolve(new Map);var r=Date.now(),n=d.get(e)||{map:new Map,inflight:null,ts:0};return d.set(e,n),r-n.ts<1e4&&n.map&&n.map.size>=0?Promise.resolve(n.map):(n.inflight||p(e)).then(function(){return v(e)||new Map})}function m(t){var e=y(t);if(e){var r=d.get(e);r&&(r.ts=0)}}function y(t){if(null==t)return null;var e=Number(t);return Number.isFinite(e)&&e>0?String(e):null}function b(t){var e=Number(t);return Number.isFinite(e)?Math.max(0,Math.min(10,e)):0}function g(t){var e,r,n,o,i=function(t){if(!t||"function"!=typeof t.id)return 0;try{var e=t.discussion&&"function"==typeof t.discussion&&t.discussion()&&t.discussion().id&&t.discussion().id()||null;if(null!=e){var r=(n=e,o=t.id(),(u=(i=v(n))&&i.get(Number(o)))?u.depth:void 0);if(Number.isInteger(r))return b(r)}}catch(t){}var n,o,i,u;try{var a=f(t);if(a&&Number.isInteger(a.depth))return b(a.depth)}catch(t){}return function(t){for(var e=0,r=0,n=new Set,o=t;o&&r<100;){var i=o.attribute?o.attribute("parent_id"):null;if(!i)break;if(n.has(i)){console.warn("[Threadify] cycle detected while walking parents of",t&&t.id&&t.id()),e=0;break}n.add(i),e+=1;var u=app.store.getById("posts",String(i));if(!u)break;if(o=u,r++,e>=10)break}return b(e)}(t)}(t),u=[];i>0?(u.push("threaded-post"),u.push("thread-depth-"+i),i>=3&&u.push("thread-deep"),i>=5&&u.push("thread-very-deep")):u.push("thread-root");try{var a=t.discussion&&"function"==typeof t.discussion&&t.discussion()&&t.discussion().id&&t.discussion().id()||null,s=null!=a?(e=a,r=t.id(),(o=(n=v(e))&&n.get(Number(r)))?o.parentId:void 0):void 0,l=f(t);(null==s?!t.attribute||!t.attribute("parent_id"):null==s)&&u.push("thread-root-confirmed"),l&&Number.isInteger(l.childCount)&&l.childCount>0&&u.push("has-children","child-count-"+Math.min(l.childCount,10)),l&&Number.isInteger(l.descendantCount)&&l.descendantCount>0&&u.push("has-descendants")}catch(t){}return u}const x=flarum.core.compat["forum/components/ReplyComposer"];var w=r.n(x);function _(t,e,r,n,o,i,u){try{var a=t[i](u),s=a.value}catch(t){return void r(t)}a.done?e(s):Promise.resolve(s).then(n,o)}function N(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function u(t){_(i,n,o,u,a,"next",t)}function a(t){_(i,n,o,u,a,"throw",t)}u(void 0)})}}var S=r(183),M=r.n(S);const O=flarum.core.compat["forum/components/PostStream"];var P=r.n(O);function T(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return I(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?I(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function I(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var k=1e7;function j(t){try{var e,r;return null!=(e=null==t||null==(r=t.stream)||null==(r=r.discussion)||null==r.id?void 0:r.id())?e:null}catch(t){return null}}function E(t){var e,r;return null!=t&&null!=(e=t.element)&&null!=(e=e.classList)&&e.contains("PostStream")?t.element:(null==t||null==(r=t.element)||null==r.querySelector?void 0:r.querySelector(".PostStream"))||document.querySelector(".PostStream")||null}function F(t){return t&&1===t.nodeType&&t.matches(".PostStream-item[data-id]")}function C(t){var e=Array.from((null==t?void 0:t.children)||[]);if(!e.length)return{posts:[],anchor:null};var r=e.findIndex(F);if(r<0)return{posts:[],anchor:e[0]||null};var n=e.length-1-[].concat(e).reverse().findIndex(F);return n<r&&(n=r),{posts:e.slice(r,n+1).filter(F),anchor:e[n+1]||null}}function A(t){try{return e().store.getById("posts",String(t))}catch(t){return null}}function D(t){try{var e=t&&"function"==typeof t.number?t.number():null;return Number.isFinite(e)?e:null}catch(t){return null}}function G(t){try{var e=t&&"function"==typeof t.createdAt?t.createdAt():null;return e instanceof Date?e.getTime():null}catch(t){return null}}function L(t,e){var r,n,o=function(t){try{var e;if(!t)return null;if("function"==typeof t.contentType)return t.contentType();if("function"==typeof t.attribute)return null!=(e=t.attribute("contentType"))?e:null}catch(t){}return null}(e);return!(!o||"comment"===o)||!!(null!=t&&null!=(r=t.classList)&&r.contains("EventPost")||null!=t&&null!=(n=t.classList)&&n.contains("Post-event"))||!(null==t||null==t.querySelector||!t.querySelector(".EventPost, .Post-event, .EventPost-icon"))}function q(t,e,r){if(t&&Number.isFinite(t.order))return Number(t.order);var n=D(e);if(null!=n)return n;var o=G(e);return null!=o?k/2+o:k+Number(r)}function R(t,e){var r=G(t);if(null!=r)return r;var n=D(t);return null!=n?k/2+n:k+Number(e)}function B(t,e){return h(e).then(function(e){var r=C(t).posts;if(r.length){var n=function(t,e,r){for(var n,o=new Set(e.map(function(t){return Number(t.dataset.id)})),i=new Map(e.map(function(t){return[Number(t.dataset.id),A(Number(t.dataset.id))]})),u=new Map,a=T(e);!(n=a()).done;){var s=n.value,l=Number(s.dataset.id),c=r.get(l),f=i.get(l),d=c?c.parentId:null!=f&&f.attribute?f.attribute("parent_id"):null;u.set(l,null==d?null:Number(d))}for(var p,v=new Set,h=T(e);!(p=h()).done;){var m=p.value,y=Number(m.dataset.id);L(m,i.get(y))&&v.add(y)}for(var b,g=new Set,x=T(e);!(b=x()).done;){var w=b.value,_=Number(w.dataset.id);v.has(_)||null==u.get(_)&&g.add(_)}for(var N=!0;N;){N=!1;for(var S,M=T(e);!(S=M()).done;){var O=S.value,P=Number(O.dataset.id);if(!g.has(P)&&!v.has(P)){var I=u.get(P);null!=I&&o.has(I)&&g.has(I)&&(g.add(P),N=!0)}}}return{eligible:g,events:v,models:i}}(0,r,e||new Map),o=n.eligible,i=n.events,u=n.models,a=function(t,e,r,n,o){for(var i,u=t.filter(function(t){return e.has(Number(t.dataset.id))}),a=u.slice().sort(function(t,e){var r=Number(t.dataset.id),i=Number(e.dataset.id),u=q(n.get(r),o.get(r),r),a=q(n.get(i),o.get(i),i);return u===a?r-i:u-a}),s=[],l=0,c=T(t);!(i=c()).done;){var f=i.value,d=Number(f.dataset.id);e.has(d)?s.push(a[l++]):s.push(f)}var p=s.filter(function(t){return!r.has(Number(t.dataset.id))}),v=t.filter(function(t){return r.has(Number(t.dataset.id))});function h(t){var e=Number(t.dataset.id);return R(o.get(e),e)}v.sort(function(t,e){var r=Number(t.dataset.id),n=Number(e.dataset.id),i=R(o.get(r),r),u=R(o.get(n),n);return i===u?r-n:i-u});for(var m,y=p.slice(),b=T(v);!(m=b()).done;){for(var g=m.value,x=Number(g.dataset.id),w=R(o.get(x),x),_=-1,N=0;N<y.length;N++)if(h(y[N])>w){_=N;break}-1===_?y.push(g):y.splice(_,0,g)}return y}(r,o,i,e||new Map,u);if(!function(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}(r,a)){var s=C(t),l=s.anchor&&s.anchor.parentNode===t?s.anchor:null;try{for(var c,f=T(a);!(c=f()).done;){var d=c.value;l&&l.parentNode===t?t.insertBefore(d,l):t.appendChild(d)}}catch(t){console.warn("[Threadify] reorder failed (retry next tick)",t)}}}}).catch(function(t){console.warn("[Threadify] order map unavailable",t)})}!function(){var t="threadify:logs",e=["log","info","warn","debug","error"];window.__threadifyConsoleOriginal||(window.__threadifyConsoleOriginal={},e.forEach(function(t){window.__threadifyConsoleOriginal[t]=console[t]?console[t].bind(console):function(){}}));var r="1"===("undefined"!=typeof localStorage?localStorage.getItem(t):null);function n(e){r=!!e,"undefined"!=typeof localStorage&&localStorage.setItem(t,r?"1":"0")}window.threadifyLogs={enable:function(){return n(!0),"Threadify logs: ON"},disable:function(){return n(!1),"Threadify logs: OFF"},toggle:function(){return n(!r),"Threadify logs: "+(r?"ON":"OFF")},status:function(){return r}},e.forEach(function(t){var e=window.__threadifyConsoleOriginal[t];console[t]=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var i=n&&n[0];if("string"!=typeof i||0!==i.indexOf("[Threadify]")||r)return e.apply(void 0,n)}})}(),e().initializers.add("syntaxoutlaw-threadify",function(){(0,n.extend)(w().prototype,"data",function(t){var e=function(t){if(!t||"string"!=typeof t)return null;var e=t.match(/@"[^"]*"#p(\d+)/);if(e&&e[1]){var r=parseInt(e[1],10);if(!isNaN(r)&&r>0)return r}return null}(t.content);return e&&(t.parent_id=e,console.log("[Threadify] Reply threading to post",e)),t}),(0,n.extend)(l().prototype,"classes",function(t){var e=this.attrs.post;if(!e)return console.warn("[Threadify] No post in ThreadedPost.classes"),t;var r=g(e);return console.log("[Threadify] Adding classes to post "+e.id()+": "+r.join(", ")),r.forEach(function(e){t.push(e)}),t}),(0,n.extend)(P().prototype,"oncreate",function(){var t=j(this),e=E(this);if(t&&e){B(e,t);var r=!1,n=!1,o=null,i=new MutationObserver(function(i){var u=i.filter(function(t){return"childList"===t.type}).flatMap(function(t){return Array.from(t.addedNodes||[])}).filter(function(t){return t&&1===t.nodeType&&t.matches&&t.matches(".PostStream-item[data-id]")});if(u.length){if(n)return;return clearTimeout(o),void(o=setTimeout(N(M().mark(function r(){var o,i,a;return M().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=!0,r.prev=1,r.next=2,h(t);case 2:if(i=r.sent){r.next=3;break}i=new Map;case 3:if(o=i,!u.some(function(t){return!o.has(Number(t.dataset.id))})){r.next=4;break}return m(t),r.next=4,p(t,{force:!0});case 4:return r.next=5,B(e,t);case 5:r.next=7;break;case 6:r.prev=6,a=r.catch(1),console.warn("[Threadify] realtime reorder failed",a);case 7:return r.prev=7,n=!1,r.finish(7);case 8:case"end":return r.stop()}},r,null,[[1,6,7,8]])})),16))}r||(r=!0,requestAnimationFrame(function(){r=!1,B(e,t)}))});i.observe(e,{childList:!0}),this.__threadifyDomObserver=i}}),(0,n.extend)(P().prototype,"onupdate",function(){var t=j(this),e=E(this);t&&e&&B(e,t)}),(0,n.extend)(P().prototype,"onremove",function(){if(this.__threadifyDomObserver){try{this.__threadifyDomObserver.disconnect()}catch(t){}this.__threadifyDomObserver=null}}),(0,n.extend)(i().prototype,"oninit",function(){var t=this.discussion&&"function"==typeof this.discussion.id&&this.discussion.id()||this.discussion&&this.discussion.id||null;t&&p(t)}),(0,n.extend)(a().prototype,"oncreate",function(){var t=this.attrs.discussion;if(t){var e=t.id(),r=function(){return p(e)};this.element&&(this.element.addEventListener("mouseenter",r,{once:!0}),this.element.addEventListener("touchstart",r,{once:!0,passive:!0}))}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map
/*! For license information please see forum.js.LICENSE.txt */
(()=>{var t={24:(t,e,r)=>{var n=r(163),o=r(110),a=r(996),i=r(312),u=r(166),s=r(766),c=r(760);function l(){"use strict";var e=o(),r=e.m(l),f=(Object.getPrototypeOf?Object.getPrototypeOf(r):r.__proto__).constructor;function d(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))}var p={throw:1,return:2,break:3,continue:3};function v(t){var e,r;return function(n){e||(e={stop:function(){return r(n.a,2)},catch:function(){return n.v},abrupt:function(t,e){return r(n.a,p[t],e)},delegateYield:function(t,o,a){return e.resultName=o,r(n.d,c(t),a)},finish:function(t){return r(n.f,t)}},r=function(t,r,o){n.p=e.prev,n.n=e.next;try{return t(r,o)}finally{e.next=n.n}}),e.resultName&&(e[e.resultName]=n.v,e.resultName=void 0),e.sent=n.v,e.next=n.n;try{return t.call(this,e)}finally{n.p=e.prev,n.n=e.next}}}return(t.exports=l=function(){return{wrap:function(t,r,n,o){return e.w(v(t),r,n,o&&o.reverse())},isGeneratorFunction:d,mark:e.m,awrap:function(t,e){return new n(t,e)},AsyncIterator:u,async:function(t,e,r,n,o){return(d(e)?i:a)(v(t),e,r,n,o)},keys:s,values:c}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports},110:(t,e,r)=>{var n=r(397);function o(){var e,r,a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",u=a.toStringTag||"@@toStringTag";function s(t,o,a,i){var u=o&&o.prototype instanceof l?o:l,s=Object.create(u.prototype);return n(s,"_invoke",function(t,n,o){var a,i,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,r){return a=t,i=0,u=e,d.n=r,c}};function p(t,n){for(i=t,u=n,r=0;!f&&s&&!o&&r<l.length;r++){var o,a=l[r],p=d.p,v=a[2];t>3?(o=v===n)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=p&&((o=t<2&&p<a[1])?(i=0,d.v=n,d.n=a[1]):p<v&&(o=t<3||a[0]>n||n>v)&&(a[4]=t,a[5]=n,d.n=v,i=0))}if(o||t>1)return c;throw f=!0,n}return function(o,l,v){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,v),i=l,u=v;(r=i<2?e:u)||!f;){a||(i?i<3?(i>1&&(d.n=-1),p(i,u)):d.n=u:d.v=u);try{if(s=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((r=(f=d.n<0)?u:t.call(n,d))!==c)break}catch(t){a=e,i=1,u=t}finally{s=1}}return{value:r,done:f}}}(t,a,i),!0),s}var c={};function l(){}function f(){}function d(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(n(r={},i,function(){return this}),r),v=d.prototype=l.prototype=Object.create(p);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,n(t,u,"GeneratorFunction")),t.prototype=Object.create(v),t}return f.prototype=d,n(v,"constructor",d),n(d,"constructor",f),f.displayName="GeneratorFunction",n(d,u,"GeneratorFunction"),n(v),n(v,u,"Generator"),n(v,i,function(){return this}),n(v,"toString",function(){return"[object Generator]"}),(t.exports=o=function(){return{w:s,m:h}},t.exports.__esModule=!0,t.exports.default=t.exports)()}t.exports=o,t.exports.__esModule=!0,t.exports.default=t.exports},163:t=>{t.exports=function(t,e){this.v=t,this.k=e},t.exports.__esModule=!0,t.exports.default=t.exports},166:(t,e,r)=>{var n=r(163),o=r(397);t.exports=function t(e,r){function a(t,o,i,u){try{var s=e[t](o),c=s.value;return c instanceof n?r.resolve(c.v).then(function(t){a("next",t,i,u)},function(t){a("throw",t,i,u)}):r.resolve(c).then(function(t){s.value=t,i(s)},function(t){return a("throw",t,i,u)})}catch(t){u(t)}}var i;this.next||(o(t.prototype),o(t.prototype,"function"==typeof Symbol&&Symbol.asyncIterator||"@asyncIterator",function(){return this})),o(this,"_invoke",function(t,e,n){function o(){return new r(function(e,r){a(t,n,e,r)})}return i=i?i.then(o,o):o()},!0)},t.exports.__esModule=!0,t.exports.default=t.exports},183:(t,e,r)=>{var n=r(24)();t.exports=n;try{regeneratorRuntime=n}catch(t){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},312:(t,e,r)=>{var n=r(110),o=r(166);t.exports=function(t,e,r,a,i){return new o(n().w(t,e,r,a),i||Promise)},t.exports.__esModule=!0,t.exports.default=t.exports},397:t=>{function e(r,n,o,a){var i=Object.defineProperty;try{i({},"",{})}catch(r){i=0}t.exports=e=function(t,r,n,o){function a(r,n){e(t,r,function(t){return this._invoke(r,n,t)})}r?i?i(t,r,{value:n,enumerable:!o,configurable:!o,writable:!o}):t[r]=n:(a("next",0),a("throw",1),a("return",2))},t.exports.__esModule=!0,t.exports.default=t.exports,e(r,n,o,a)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},735:t=>{function e(r){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports.default=t.exports,e(r)}t.exports=e,t.exports.__esModule=!0,t.exports.default=t.exports},760:(t,e,r)=>{var n=r(735).default;t.exports=function(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(n(t)+" is not iterable")},t.exports.__esModule=!0,t.exports.default=t.exports},766:t=>{t.exports=function(t){var e=Object(t),r=[];for(var n in e)r.unshift(n);return function t(){for(;r.length;)if((n=r.pop())in e)return t.value=n,t.done=!1,t;return t.done=!0,t}},t.exports.__esModule=!0,t.exports.default=t.exports},996:(t,e,r)=>{var n=r(312);t.exports=function(t,e,r,o,a){var i=n(t,e,r,o,a);return i.next().then(function(t){return t.done?t.value:i.next()})},t.exports.__esModule=!0,t.exports.default=t.exports}},e={};function r(n){var o=e[n];if(void 0!==o)return o.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";const t=flarum.core.compat["forum/app"];var e=r.n(t);const n=flarum.core.compat["common/extend"],o=flarum.core.compat["forum/components/DiscussionPage"];var a=r.n(o);const i=flarum.core.compat["forum/components/DiscussionListItem"];var u=r.n(i);const s=flarum.core.compat["forum/components/Post"];var c=r.n(s),l=new Map;function f(t){if(!t)return null;var e=t.discussion&&t.discussion(),r=e&&e.id&&e.id();if(!r)return null;var n=function(t,e){var r=l.get(Number(t));if(r)return r.map.get(Number(e))}(r,t.id());return n?{depth:n.depth,threadPath:null,isRoot:!n.parentId,childCount:0,descendantCount:0,rootPostId:null}:null}var d=new Map;function p(t,e){void 0===e&&(e={});var r=b(t);if(!r)return Promise.resolve();var n=Date.now(),o=d.get(r)||{map:new Map,inflight:null,ts:0};if(d.set(r,o),!e.force&&n-o.ts<1e4)return o.inflight||Promise.resolve();if(o.inflight&&!e.force)return o.inflight;var a=n;return o.inflight=app.request({method:"GET",url:app.forum.attribute("apiUrl")+"/discussions/"+r+"/threads-order?bust="+a}).then(function(t){var e=new Map;(t&&t.order?t.order:[]).forEach(function(t){var r=t.postId,n=t.order,o=t.depth,a=t.parentPostId;r=Number(r),e.set(r,{order:Number(n),depth:Number.isFinite(o)?Number(o):0,parentId:a?Number(a):null})}),o.map=e,o.ts=Date.now();try{window.dispatchEvent(new CustomEvent("threadify:order-ready",{detail:{discussionId:Number(r)}}))}catch(t){}}).catch(function(t){console.warn("[Threadify] order prefetch failed",t)}).finally(function(){o.inflight=null}),o.inflight}function v(t){var e=b(t);if(e){var r=d.get(e);return r?r.map:void 0}}function h(t){var e=b(t);if(!e)return Promise.resolve(new Map);var r=Date.now(),n=d.get(e)||{map:new Map,inflight:null,ts:0};return d.set(e,n),r-n.ts<1e4&&n.map&&n.map.size>=0?Promise.resolve(n.map):(n.inflight||p(e)).then(function(){return v(e)||new Map})}function y(t){var e=b(t);if(e){var r=d.get(e);r&&(r.ts=0)}}function b(t){if(null==t)return null;var e=Number(t);return Number.isFinite(e)&&e>0?String(e):null}function g(t){var e=Number(t);return Number.isFinite(e)?Math.max(0,Math.min(10,e)):0}function x(t){var e,r,n,o,a=function(t){if(!t||"function"!=typeof t.id)return 0;try{var e=t.discussion&&"function"==typeof t.discussion&&t.discussion()&&t.discussion().id&&t.discussion().id()||null;if(null!=e){var r=(n=e,o=t.id(),(i=(a=v(n))&&a.get(Number(o)))?i.depth:void 0);if(Number.isInteger(r))return g(r)}}catch(t){}var n,o,a,i;try{var u=f(t);if(u&&Number.isInteger(u.depth))return g(u.depth)}catch(t){}return function(t){for(var e=0,r=0,n=new Set,o=t;o&&r<100;){var a=o.attribute?o.attribute("parent_id"):null;if(!a)break;if(n.has(a)){console.warn("[Threadify] cycle detected while walking parents of",t&&t.id&&t.id()),e=0;break}n.add(a),e+=1;var i=app.store.getById("posts",String(a));if(!i)break;if(o=i,r++,e>=10)break}return g(e)}(t)}(t),i=[];a>0?(i.push("threaded-post"),i.push("thread-depth-"+a),a>=3&&i.push("thread-deep"),a>=5&&i.push("thread-very-deep")):i.push("thread-root");try{var u=t.discussion&&"function"==typeof t.discussion&&t.discussion()&&t.discussion().id&&t.discussion().id()||null,s=null!=u?(e=u,r=t.id(),(o=(n=v(e))&&n.get(Number(r)))?o.parentId:void 0):void 0,c=f(t);(null==s?!t.attribute||!t.attribute("parent_id"):null==s)&&i.push("thread-root-confirmed"),c&&Number.isInteger(c.childCount)&&c.childCount>0&&i.push("has-children","child-count-"+Math.min(c.childCount,10)),c&&Number.isInteger(c.descendantCount)&&c.descendantCount>0&&i.push("has-descendants")}catch(t){}return i}const w=flarum.core.compat["forum/components/ReplyComposer"];var N=r.n(w);function _(t,e,r,n,o,a,i){try{var u=t[a](i),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function S(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function i(t){_(a,n,o,i,u,"next",t)}function u(t){_(a,n,o,i,u,"throw",t)}i(void 0)})}}var M=r(183),P=r.n(M);const O=flarum.core.compat["forum/components/PostStream"];var T=r.n(O);function I(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(r)return(r=r.call(t)).next.bind(r);if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return k(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}var A=1e7,E=!1;function F(){if(!E){E=!0;try{requestAnimationFrame(function(){E=!1,"function"==typeof m&&"function"==typeof m.redraw&&m.redraw()})}catch(t){E=!1}}}function j(t){try{var e,r;return null!=(e=null==t||null==(r=t.stream)||null==(r=r.discussion)||null==r.id?void 0:r.id())?e:null}catch(t){return null}}function L(t){var e,r;return null!=t&&null!=(e=t.element)&&null!=(e=e.classList)&&e.contains("PostStream")?t.element:(null==t||null==(r=t.element)||null==r.querySelector?void 0:r.querySelector(".PostStream"))||document.querySelector(".PostStream")||null}function C(t){return t&&1===t.nodeType&&t.matches(".PostStream-item[data-id]")}function q(t){var e=Array.from((null==t?void 0:t.children)||[]);if(!e.length)return{posts:[],anchor:null};var r=e.findIndex(C);if(r<0)return{posts:[],anchor:e[0]||null};var n=e.length-1-[].concat(e).reverse().findIndex(C);return n<r&&(n=r),{posts:e.slice(r,n+1).filter(C),anchor:e[n+1]||null}}function D(t,e){if(t.length!==e.length)return!1;for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function G(t){try{return e().store.getById("posts",String(t))}catch(t){return null}}function R(t){try{var e=null==t||null==t.number?void 0:t.number();return Number.isFinite(e)?e:null}catch(t){return null}}function z(t){try{var e=null==t||null==t.createdAt?void 0:t.createdAt();return e instanceof Date?+e:null}catch(t){return null}}function B(t,e){var r,n,o=function(t){try{var e;if(!t)return null;if("function"==typeof t.contentType)return t.contentType();if("function"==typeof t.attribute)return null!=(e=t.attribute("contentType"))?e:null}catch(t){}return null}(e);return!(!o||"comment"===o)||!!(null!=t&&null!=(r=t.classList)&&r.contains("EventPost")||null!=t&&null!=(n=t.classList)&&n.contains("Post-event"))||!(null==t||null==t.querySelector||!t.querySelector(".EventPost, .Post-event, .EventPost-icon"))}function U(t,e,r){if(t&&Number.isFinite(t.order))return Number(t.order);var n=R(e);if(null!=n)return n;var o=z(e);return null!=o?A/2+o:A+Number(r)}function V(t,e){var r=z(t);if(null!=r)return r;var n=R(t);return null!=n?A/2+n:A+Number(e)}function $(t,e){for(var r,n=new Set(t.map(function(t){return Number(t.dataset.id)})),o=new Map(t.map(function(t){return[Number(t.dataset.id),G(Number(t.dataset.id))]})),a=new Map,i=I(t);!(r=i()).done;){var u=r.value,s=Number(u.dataset.id),c=e.get(s),l=o.get(s),f=c?c.parentId:null!=l&&l.attribute?l.attribute("parent_id"):null;a.set(s,null==f?null:Number(f))}for(var d,p=new Set,v=I(t);!(d=v()).done;){var h=d.value,m=Number(h.dataset.id);B(h,o.get(m))&&p.add(m)}for(var y,b=new Set,g=I(t);!(y=g()).done;){var x=y.value,w=Number(x.dataset.id);p.has(w)||null==a.get(w)&&b.add(w)}for(var N=!0;N;){N=!1;for(var _,S=I(t);!(_=S()).done;){var M=_.value,P=Number(M.dataset.id);if(!b.has(P)&&!p.has(P)){var O=a.get(P);null!=O&&n.has(O)&&b.has(O)&&(b.add(P),N=!0)}}}return{eligible:b,events:p,models:o,parentOf:a,present:n}}function Y(t,e,r,n,o){for(var a,i=t.filter(function(t){return e.has(Number(t.dataset.id))}),u=i.slice().sort(function(t,e){var r=Number(t.dataset.id),a=Number(e.dataset.id),i=U(n.get(r),o.get(r),r),u=U(n.get(a),o.get(a),a);return i===u?r-a:i-u}),s=[],c=0,l=I(t);!(a=l()).done;){var f=a.value,d=Number(f.dataset.id);s.push(e.has(d)?u[c++]:f)}for(var p,v=s.filter(function(t){return!r.has(Number(t.dataset.id))}),h=t.filter(function(t){return r.has(Number(t.dataset.id))}).sort(function(t,e){var r=Number(t.dataset.id),n=Number(e.dataset.id),a=V(o.get(r),r),i=V(o.get(n),n);return a===i?r-n:a-i}),m=v.slice(),y=function(t){return V(o.get(Number(t.dataset.id)),Number(t.dataset.id))},b=I(h);!(p=b()).done;){for(var g=p.value,x=Number(g.dataset.id),w=V(o.get(x),x),N=-1,_=0;_<m.length;_++)if(y(m[_])>w){N=_;break}-1===N?m.push(g):m.splice(N,0,g)}return m}function H(t,e,r,n,o){var a=t.map(function(t){return Number(t.dataset.id)}),i=new Set(a),u=new Set(a.filter(function(t){return!r.has(t)&&!e.has(t)}));if(!u.size)return t;function s(t){for(var e=t,r=0;r<100;r++){var n=o.get(e);if(null==n)return null;if(!i.has(n))return null;if(u.has(n))return n;e=n}return null}for(var c,l=new Map,f=I(u);!(c=f()).done;){var d=c.value,p=s(d);null!=p&&p!==d&&(l.has(p)||l.set(p,new Set),l.get(p).add(d))}if(!l.size)return t;for(var v,h=t.slice(),m=new Map(h.map(function(t,e){return[Number(t.dataset.id),e]})),y=function(){var t=v.value,e=h.findIndex(function(e){return Number(e.dataset.id)===t});if(e<0)return 1;var r=function(t){for(var e=new Set(t),r=[],n=0;n<h.length;n++){var o=Number(h[n].dataset.id);e.has(o)&&(r.push(h[n]),h.splice(n,1),n--)}return r}(Array.from(l.get(t)).sort(function(t,e){var r=V(n.get(t),t),o=V(n.get(e),e);return r===o?t-e:r-o}));h.splice.apply(h,[e+1,0].concat(r))},b=I(Array.from(l.keys()).sort(function(t,e){return m.get(t)-m.get(e)}));!(v=b()).done;)y();return h}function J(t,e){var r=Array.from(t.querySelectorAll(".PostStream-item[data-id]"));if(!r.length)return!1;var n=new Map(r.map(function(t){return[Number(t.dataset.id),G(Number(t.dataset.id))]})),o=new Map(r.map(function(t){var r=Number(t.dataset.id),o=e.get(r),a=n.get(r),i=o?o.parentId:null!=a&&a.attribute?a.attribute("parent_id"):null;return[r,null==i?null:Number(i)]})),a=function(t){return Number.isFinite(t)?Math.max(0,Math.min(10,t)):0};function i(t){var r=e.get(t);if(r&&Number.isInteger(r.depth))return a(r.depth);for(var n=0,i=0,u=t,s=new Set([t]);i++<100;){var c=o.get(u);if(!c)break;if(s.has(c)){n=0;break}if(s.add(c),u=c,++n>=10)break}return a(n)}function u(t,e,r){var n=t.querySelector(".Post")||t,o=[];return n.classList.forEach(function(t){/^(thread-(root|ed-post|depth-\d+|deep|very-deep))$/.test(t)&&o.push(t)}),o.forEach(function(t){return n.classList.remove(t)}),r?(n.classList.add("thread-root"),!0):(e>0?(n.classList.add("threaded-post","thread-depth-"+e),e>=3&&n.classList.add("thread-deep"),e>=5&&n.classList.add("thread-very-deep")):n.classList.add("thread-root"),!0)}for(var s=!1,c=0,l=r;c<l.length;c++){var f=l[c],d=Number(f.dataset.id),p=B(f,n.get(d));s=u(f,p?0:i(d),p)||s}return s}function K(t,e){return Q.apply(this,arguments)}function Q(){return(Q=S(P().mark(function t(e,r){var n,o,a,i,u,s,c,l,f,d,p,v,m,y,b,g;return P().wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=1,h(r);case 1:if(g=t.sent){t.next=2;break}g=new Map;case 2:if(n=g,o=q(e),(a=o.posts).length){t.next=3;break}return t.abrupt("return");case 3:if(i=$(a,n),u=i.eligible,s=i.events,c=i.models,l=i.parentOf,f=Y(a,u,s,n,c),d=H(f,u,s,c,l),!D(a,d)){p=q(e),v=p.anchor&&p.anchor.parentNode===e?p.anchor:null;try{for(m=I(d);!(y=m()).done;)b=y.value,v&&v.parentNode===e?e.insertBefore(b,v):e.appendChild(b)}catch(t){console.warn("[Threadify] reorder failed (will retry)",t)}}J(e,n),F();case 4:case"end":return t.stop()}},t)}))).apply(this,arguments)}!function(){var t="threadify:logs",e=["log","info","warn","debug","error"];window.__threadifyConsoleOriginal||(window.__threadifyConsoleOriginal={},e.forEach(function(t){window.__threadifyConsoleOriginal[t]=console[t]?console[t].bind(console):function(){}}));var r="1"===("undefined"!=typeof localStorage?localStorage.getItem(t):null);function n(e){r=!!e,"undefined"!=typeof localStorage&&localStorage.setItem(t,r?"1":"0")}window.threadifyLogs={enable:function(){return n(!0),"Threadify logs: ON"},disable:function(){return n(!1),"Threadify logs: OFF"},toggle:function(){return n(!r),"Threadify logs: "+(r?"ON":"OFF")},status:function(){return r}},e.forEach(function(t){var e=window.__threadifyConsoleOriginal[t];console[t]=function(){for(var t=arguments.length,n=new Array(t),o=0;o<t;o++)n[o]=arguments[o];var a=n&&n[0];if("string"!=typeof a||0!==a.indexOf("[Threadify]")||r)return e.apply(void 0,n)}})}(),e().initializers.add("syntaxoutlaw-threadify",function(){(0,n.extend)(N().prototype,"data",function(t){var e=function(t){if(!t||"string"!=typeof t)return null;var e=t.match(/@"[^"]*"#p(\d+)/);if(e&&e[1]){var r=parseInt(e[1],10);if(!isNaN(r)&&r>0)return r}return null}(t.content);return e&&(t.parent_id=e,console.log("[Threadify] Reply threading to post",e)),t}),(0,n.extend)(c().prototype,"classes",function(t){var e=this.attrs.post;if(!e)return console.warn("[Threadify] No post in ThreadedPost.classes"),t;var r=x(e);return console.log("[Threadify] Adding classes to post "+e.id()+": "+r.join(", ")),r.forEach(function(e){t.push(e)}),t}),function(){(0,n.extend)(T().prototype,"oncreate",function(){var t=j(this),e=L(this);if(t&&e){K(e,t);var r=!1,n=!1,o=null,a=null,i=new MutationObserver(function(i){var u=i.filter(function(t){return"childList"===t.type}).flatMap(function(t){return Array.from(t.addedNodes||[])}).filter(function(t){return t&&1===t.nodeType&&t.matches&&t.matches(".PostStream-item[data-id]")});if(u.length){if(n)return;return clearTimeout(o),void(o=setTimeout(S(P().mark(function r(){var o,a,i;return P().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=!0,r.prev=1,r.next=2,h(t);case 2:if(a=r.sent){r.next=3;break}a=new Map;case 3:if(o=a,!u.some(function(t){return!o.has(Number(t.dataset.id))})){r.next=4;break}return y(t),r.next=4,p(t,{force:!0});case 4:return r.next=5,K(e,t);case 5:r.next=7;break;case 6:r.prev=6,i=r.catch(1),console.warn("[Threadify] realtime reorder failed",i);case 7:return r.prev=7,n=!1,r.finish(7);case 8:case"end":return r.stop()}},r,null,[[1,6,7,8]])})),16))}if(i.some(function(t){if("attributes"!==t.type)return!1;var e=t.target;if(null==e||null==e.matches||!e.matches(".PostStream-item"))return!1;if("data-id"===t.attributeName)return!!e.getAttribute("data-id");if("class"===t.attributeName){var r=t.oldValue||"",n=e.className||"";return/PostStream-item/.test(n)&&/Post--saving/.test(r)&&!/Post--saving/.test(n)}return!1})){if(n)return;return clearTimeout(o),void(o=setTimeout(S(P().mark(function r(){var o,i;return P().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return n=!0,r.prev=1,y(t),r.next=2,p(t,{force:!0});case 2:return r.next=3,K(e,t);case 3:o=0,clearInterval(a),a=setInterval(S(P().mark(function r(){var n;return P().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return o++,r.next=1,h(t);case 1:if(n=r.sent){r.next=2;break}n=new Map;case 2:(J(e,n)||o>=10)&&(clearInterval(a),F());case 3:case"end":return r.stop()}},r)})),150),r.next=5;break;case 4:r.prev=4,i=r.catch(1),console.warn("[Threadify] hydration reorder failed",i);case 5:return r.prev=5,n=!1,r.finish(5);case 6:case"end":return r.stop()}},r,null,[[1,4,5,6]])})),16))}r||(r=!0,requestAnimationFrame(function(){r=!1,K(e,t)}))});i.observe(e,{childList:!0,attributes:!0,attributeOldValue:!0,attributeFilter:["data-id","class"],subtree:!0}),this.__threadifyDomObserver=i}}),(0,n.extend)(T().prototype,"onupdate",function(){var t=j(this),e=L(this);t&&e&&K(e,t)}),(0,n.extend)(T().prototype,"onremove",function(){if(this.__threadifyDomObserver){try{this.__threadifyDomObserver.disconnect()}catch(t){}this.__threadifyDomObserver=null}});try{window.addEventListener("threadify:order-ready",function(){return F()})}catch(t){}}(),(0,n.extend)(a().prototype,"oninit",function(){var t=this.discussion&&"function"==typeof this.discussion.id&&this.discussion.id()||this.discussion&&this.discussion.id||null;t&&p(t)}),(0,n.extend)(u().prototype,"oncreate",function(){var t=this.attrs.discussion;if(t){var e=t.id(),r=function(){return p(e)};this.element&&(this.element.addEventListener("mouseenter",r,{once:!0}),this.element.addEventListener("touchstart",r,{once:!0,passive:!0}))}})})})(),module.exports={}})();
//# sourceMappingURL=forum.js.map